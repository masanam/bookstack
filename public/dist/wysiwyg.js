// See the "/licenses" URI for full package license details
function $(o){return __DEV__?{type:o}:{}}var we=$("SELECTION_CHANGE_COMMAND"),er=$("SELECTION_INSERT_CLIPBOARD_NODES_COMMAND"),tr=$("CLICK_COMMAND"),Ye=$("DELETE_CHARACTER_COMMAND"),$t=$("INSERT_LINE_BREAK_COMMAND"),Pt=$("INSERT_PARAGRAPH_COMMAND"),rt=$("CONTROLLED_TEXT_INSERTION_COMMAND"),ro=$("PASTE_COMMAND"),cn=$("REMOVE_TEXT_COMMAND"),Ct=$("DELETE_WORD_COMMAND"),it=$("DELETE_LINE_COMMAND"),Ne=$("FORMAT_TEXT_COMMAND"),io=$("UNDO_COMMAND"),so=$("REDO_COMMAND"),Ds=$("KEYDOWN_COMMAND"),Mo=$("KEY_ARROW_RIGHT_COMMAND"),Os=$("MOVE_TO_END"),wo=$("KEY_ARROW_LEFT_COMMAND"),As=$("MOVE_TO_START"),Bt=$("KEY_ARROW_UP_COMMAND"),Ft=$("KEY_ARROW_DOWN_COMMAND"),Be=$("KEY_ENTER_COMMAND"),or=$("KEY_SPACE_COMMAND"),Ht=$("KEY_BACKSPACE_COMMAND"),vo=$("KEY_ESCAPE_COMMAND"),Kt=$("KEY_DELETE_COMMAND"),Do=$("KEY_TAB_COMMAND"),Rs=$("INSERT_TAB_COMMAND"),hh=$("INDENT_CONTENT_COMMAND"),Nh=$("OUTDENT_CONTENT_COMMAND"),Oo=$("DROP_COMMAND"),nr=$("DRAGSTART_COMMAND"),rr=$("DRAGOVER_COMMAND"),ks=$("DRAGEND_COMMAND"),lo=$("COPY_COMMAND"),ao=$("CUT_COMMAND"),un=$("SELECT_ALL_COMMAND"),Is=$("CLEAR_EDITOR_COMMAND"),$s=$("CLEAR_HISTORY_COMMAND"),co=$("CAN_REDO_COMMAND"),uo=$("CAN_UNDO_COMMAND"),ir=$("FOCUS_COMMAND"),Ps=$("BLUR_COMMAND"),Bs=$("KEY_MODIFIER_COMMAND");var fe=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";var xh=fe&&"documentMode"in document?document.documentMode:null,Fe=fe&&/Mac|iPod|iPhone|iPad/.test(navigator.platform),He=fe&&/^(?!.*Seamonkey)(?=.*Firefox).*/i.test(navigator.userAgent),fo=fe&&"InputEvent"in window&&!xh?"getTargetRanges"in new window.InputEvent("input"):!1,Ut=fe&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent),_t=fe&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,ld=fe&&/Android/.test(navigator.userAgent),Fs=fe&&/^(?=.*Chrome).*/i.test(navigator.userAgent),Hs=fe&&ld&&Fs,zt=fe&&/AppleWebKit\/[\d.]+/.test(navigator.userAgent)&&!Fs;var mo=1,Ke=3,bt=0,Ks=1,Wt=2,ad=0,Qr=1,ei=2,sr=1,lr=2,fn=4,mn=8,ar=16,dr=32,cr=64,ur=128,Us=sr|lr|fn|mn|ar|dr|cr|ur,ti=1,pn=2;var dd="\xA0",Eh="\u200B",gn=Ut||_t||zt?dd:Eh,Ze=`

`,cd=He?dd:gn,ud="\u0591-\u07FF\uFB1D-\uFDFD\uFE70-\uFEFC",fd="A-Za-z\xC0-\xD6\xD8-\xF6\xF8-\u02B8\u0300-\u0590\u0800-\u1FFF\u200E\u2C00-\uFB1C\uFE00-\uFE6F\uFEFD-\uFFFF",Th=new RegExp("^[^"+fd+"]*["+ud+"]"),Ch=new RegExp("^[^"+ud+"]*["+fd+"]"),Ve={bold:sr,code:ar,highlight:ur,italic:lr,strikethrough:fn,subscript:dr,superscript:cr,underline:mn},md={directionless:ti,unmergeable:pn},pd={normal:ad,segmented:ei,token:Qr},gd={[ad]:"normal",[ei]:"segmented",[Qr]:"token"};function x(o,e,...t){if(!o){for(let n of t)e=(e||"").replace("%s",n);throw new Error(e)}}function yt(...o){let e=[];for(let t of o)if(t&&typeof t=="string")for(let[n]of t.matchAll(/\S+/g))e.push(n);return e}var _h=100,Ws=!1,qs=0;function hd(){return Ws}function bh(o){qs=o.timeStamp}function yh(o){qs===0&&hn(o).addEventListener("textInput",bh,!0)}function zs(o,e,t){return e.__lexicalLineBreak===o||o[`__lexicalKey_${t._key}`]!==void 0}function Sh(o){return o.getEditorState().read(()=>{let e=T();return e!==null?e.clone():null})}function Lh(o,e,t){let n=be(t._window),r=null,i=null;n!==null&&n.anchorNode===o&&(r=n.anchorOffset,i=n.focusOffset);let s=o.nodeValue;s!==null&&fr(e,s,r,i,!1)}function Mh(o,e,t){return e.nodeType===Ke&&t.isAttached()}function Nd(o,e,t){Ws=!0;let n=performance.now()-qs>_h;try{xe(o,()=>{let r=T()||Sh(o),i=new Map,s=o.getRootElement(),l=o._editorState,a=o._blockCursorElement,d=!1,m="";for(let c=0;c<e.length;c++){let u=e[c],p=u.type,g=u.target,h=ee(g,l);if(!(h===null&&g!==s||B(h))){if(p==="characterData")n&&y(h)&&Mh(r,g,h)&&Lh(g,h,o);else if(p==="childList"){d=!0;let C=u.addedNodes;for(let M=0;M<C.length;M++){let S=C[M],A=Ys(S),O=S.parentNode;if(O!=null&&S!==a&&A===null&&(S.nodeName!=="BR"||!zs(S,O,o))){if(He){let R=S.innerText||S.nodeValue;R&&(m+=R)}O.removeChild(S)}}let N=u.removedNodes,L=N.length;if(L>0){let M=0;for(let S=0;S<L;S++){let A=N[S];(A.nodeName==="BR"&&zs(A,g,o)||a===A)&&(g.appendChild(A),M++)}L!==M&&(g===s&&(h=Zs(l)),i.set(g,h))}}}}if(i.size>0)for(let[c,u]of i)if(E(u)){let p=u.getChildrenKeys(),g=c.firstChild;for(let h=0;h<p.length;h++){let C=p[h],N=o.getElementByKey(C);N!==null&&(g==null?(c.appendChild(N),g=N):g!==N&&c.replaceChild(N,g),g=g.nextSibling)}}else y(u)&&u.markDirty();let f=t.takeRecords();if(f.length>0){for(let c=0;c<f.length;c++){let u=f[c],p=u.addedNodes,g=u.target;for(let h=0;h<p.length;h++){let C=p[h],N=C.parentNode;N!=null&&C.nodeName==="BR"&&!zs(C,g,o)&&N.removeChild(C)}}t.takeRecords()}r!==null&&(d&&(r.dirty=!0,Y(r)),He&&ri(o)&&r.insertRawText(m))})}finally{Ws=!1}}function oi(o){let e=o._observer;if(e!==null){let t=e.takeRecords();Nd(o,t,e)}}function ni(o){yh(o),o._observer=new MutationObserver((e,t)=>{Nd(o,e,t)})}function xd(o,e){let t=o.__mode,n=o.__format,r=o.__style,i=e.__mode,s=e.__format,l=e.__style;return(t===null||t===i)&&(n===null||n===s)&&(r===null||r===l)}function Ed(o,e){let t=o.mergeWithSibling(e),n=j()._normalizedNodes;return n.add(o.__key),n.add(e.__key),t}function Vs(o){let e=o;if(e.__text===""&&e.isSimpleText()&&!e.isUnmergeable()){e.remove();return}let t;for(;(t=e.getPreviousSibling())!==null&&y(t)&&t.isSimpleText()&&!t.isUnmergeable();)if(t.__text==="")t.remove();else if(xd(t,e)){e=Ed(t,e);break}else break;let n;for(;(n=e.getNextSibling())!==null&&y(n)&&n.isSimpleText()&&!n.isUnmergeable();)if(n.__text==="")n.remove();else if(xd(e,n)){e=Ed(e,n);break}else break}function Ao(o){return Td(o.anchor),Td(o.focus),o}function Td(o){for(;o.type==="element";){let e=o.getNode(),t=o.offset,n,r;if(t===e.getChildrenSize()?(n=e.getChildAtIndex(t-1),r=!0):(n=e.getChildAtIndex(t),r=!1),y(n)){o.set(n.__key,r?n.getTextContentSize():0,"text");break}else if(!E(n))break;o.set(n.__key,r?n.getChildrenSize():0,"element")}}var wh=1;function vh(){return""+wh++}function bd(o,e){let t=o._nodes.get(e);return t===void 0&&x(!1,"registeredNode: Type %s not found",e),t}var qT=Array.isArray,yd=typeof queueMicrotask=="function"?queueMicrotask:o=>{Promise.resolve().then(o)};function Sd(o){return B(ee(o))}function Tn(o){let e=document.activeElement;if(e===null)return!1;let t=e.nodeName;return B(ee(o))&&(t==="INPUT"||t==="TEXTAREA"||e.contentEditable==="true"&&Ro(e)==null)}function qt(o,e,t){let n=o.getRootElement();try{return n!==null&&n.contains(e)&&n.contains(t)&&e!==null&&!Tn(e)&&ii(e)===o}catch{return!1}}function Cn(o){return o instanceof ho}function ii(o){let e=o;for(;e!=null;){let t=Ro(e);if(Cn(t))return t;e=ci(e)}return null}function Ro(o){return o?o.__lexicalEditor:null}function Ue(o){return o.isToken()||o.isSegmented()}function Dh(o){return o.nodeType===Ke}function _n(o){let e=o;for(;e!=null;){if(Dh(e))return e;e=e.firstChild}return null}function pr(o,e,t){let n=Ve[e];if(t!==null&&(o&n)===(t&n))return o;let r=o^n;return e==="subscript"?r&=~Ve.superscript:e==="superscript"&&(r&=~Ve.subscript),r}function gr(o){return y(o)||ve(o)||B(o)}function Ld(o,e){if(e!=null){__DEV__&&Oh(o,e),o.__key=e;return}de(),rl();let t=j(),n=Ge(),r=vh();n._nodeMap.set(r,o),E(o)?t._dirtyElements.set(r,!0):t._dirtyLeaves.add(r),t._cloneNotNeeded.add(r),t._dirtyType=Ks,o.__key=r}function Oh(o,e){let t=uc();if(!t)return;let n=t._nodeMap.get(e);n&&n.constructor!==o.constructor&&(o.constructor.name!==n.constructor.name?x(!1,"Lexical node with constructor %s attempted to re-use key from node in active editor state with constructor %s. Keys must not be re-used when the type is changed.",o.constructor.name,n.constructor.name):x(!1,"Lexical node with constructor %s attempted to re-use key from node in active editor state with different constructor with the same name (possibly due to invalid Hot Module Replacement). Keys must not be re-used when the type is changed.",o.constructor.name))}function Ah(o,e,t){let n=o;for(;n!==null;){if(t.has(n))return;let r=e.get(n);if(r===void 0)break;t.set(n,!1),n=r.__parent}}function Yt(o){let e=o.getParent();if(e!==null){let t=o.getWritable(),n=e.getWritable(),r=o.getPreviousSibling(),i=o.getNextSibling();if(r===null)if(i!==null){let s=i.getWritable();n.__first=i.__key,s.__prev=null}else n.__first=null;else{let s=r.getWritable();if(i!==null){let l=i.getWritable();l.__prev=s.__key,s.__next=l.__key}else s.__next=null;t.__prev=null}if(i===null)if(r!==null){let s=r.getWritable();n.__last=r.__key,s.__next=null}else n.__last=null;else{let s=i.getWritable();if(r!==null){let l=r.getWritable();l.__next=s.__key,s.__prev=l.__key}else s.__prev=null;t.__next=null}n.__size--,t.__parent=null}}function mr(o){rl();let e=o.getLatest(),t=e.__parent,n=Ge(),r=j(),i=n._nodeMap,s=r._dirtyElements;t!==null&&Ah(t,i,s);let l=e.__key;r._dirtyType=Ks,E(o)?s.set(l,!0):r._dirtyLeaves.add(l)}function Md(o){let e=o.getPreviousSibling(),t=o.getNextSibling();e!==null&&mr(e),t!==null&&mr(t)}function se(o){de();let e=j(),t=e._compositionKey;if(o!==t){if(e._compositionKey=o,t!==null){let n=J(t);n!==null&&n.getWritable()}if(o!==null){let n=J(o);n!==null&&n.getWritable()}}}function Xe(){return st()?null:j()._compositionKey}function J(o,e){let n=(e||Ge())._nodeMap.get(o);return n===void 0?null:n}function Ys(o,e){let t=j(),n=o[`__lexicalKey_${t._key}`];return n!==void 0?J(n,e):null}function ee(o,e){let t=o;for(;t!=null;){let n=Ys(t,e);if(n!==null)return n;t=ci(t)}return null}function si(o){let e=o._decorators,t=Object.assign({},e);return o._pendingDecorators=t,t}function Gs(o){return o.read(()=>F().getTextContent())}function wd(o,e){xe(o,()=>{let t=Ge();if(t.isEmpty())return;if(e==="root"){F().markDirty();return}let n=t._nodeMap;for(let[,r]of n)r.markDirty()},o._pendingEditorState===null?{tag:"history-merge"}:void 0)}function F(){return Zs(Ge())}function Zs(o){return o._nodeMap.get("root")}function Y(o){de();let e=Ge();o!==null&&(__DEV__&&Object.isFrozen(o)&&x(!1,"$setSelection called on frozen selection object. Ensure selection is cloned before passing in."),o.dirty=!0,o.setCachedNodes(null)),e._selection=o}function vd(){de();let o=j();oi(o)}function ko(o){let e=j(),t=Rh(o,e);if(t===null){let n=e.getRootElement();return o===n?J("root"):null}return J(t)}function js(o,e){return e?o.getTextContentSize():0}function Rh(o,e){let t=o;for(;t!=null;){let n=t[`__lexicalKey_${e._key}`];if(n!==void 0)return n;t=ci(t)}return null}function li(o){return/[\uD800-\uDBFF][\uDC00-\uDFFF]/g.test(o)}function hr(o){let e=[],t=o;for(;t!==null;)e.push(t),t=t._parentEditor;return e}function Js(){return Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5)}function Qs(o){return o.nodeType===Ke?o.nodeValue:null}function ai(o,e,t){let n=be(e._window);if(n===null)return;let r=n.anchorNode,{anchorOffset:i,focusOffset:s}=n;if(r!==null){let l=Qs(r),a=ee(r);if(l!==null&&y(a)){if(l===gn&&t){let d=t.length;l=t,i=d,s=d}l!==null&&fr(a,l,i,s,o)}}}function fr(o,e,t,n,r){let i=o;if(i.isAttached()&&(r||!i.isDirty())){let s=i.isComposing(),l=e;(s||r)&&e[e.length-1]===gn&&(l=e.slice(0,-1));let a=i.getTextContent();if(r||l!==a){if(l===""){if(se(null),!Ut&&!_t&&!zt){let g=j();setTimeout(()=>{g.update(()=>{i.isAttached()&&i.remove()})},20)}else i.remove();return}let d=i.getParent(),m=ze(),f=i.getTextContentSize(),c=Xe(),u=i.getKey();if(i.isToken()||c!==null&&u===c&&!s||_(m)&&(d!==null&&!d.canInsertTextBefore()&&m.anchor.offset===0||m.anchor.key===o.__key&&m.anchor.offset===0&&!i.canInsertTextBefore()&&!s||m.focus.key===o.__key&&m.focus.offset===f&&!i.canInsertTextAfter()&&!s)){i.markDirty();return}let p=T();if(!_(p)||t===null||n===null){i.setTextContent(l);return}if(p.setTextNodeRange(i,t,i,n),i.isSegmented()){let g=i.getTextContent(),h=q(g);i.replace(h),i=h}i.setTextContent(l)}}}function kh(o){let e=o.getPreviousSibling();return(y(e)||E(e)&&e.isInline())&&!e.canInsertTextAfter()}function Dd(o,e){if(e.isSegmented())return!0;if(!o.isCollapsed())return!1;let t=o.anchor.offset,n=e.getParentOrThrow(),r=e.isToken();return t===0?!e.canInsertTextBefore()||!n.canInsertTextBefore()&&!e.isComposing()||r||kh(e):t===e.getTextContentSize()?!e.canInsertTextAfter()||!n.canInsertTextAfter()&&!e.isComposing()||r:!1}function Od(o,e,t,n){return o==="Tab"&&!e&&!t&&!n}function Ad(o,e,t,n){return o.toLowerCase()==="b"&&!e&&Nr(t,n)}function Rd(o,e,t,n){return o.toLowerCase()==="i"&&!e&&Nr(t,n)}function kd(o,e,t,n){return o.toLowerCase()==="u"&&!e&&Nr(t,n)}function Id(o,e){return rc(o)&&!e}function $d(o,e){return rc(o)&&e}function Pd(o,e){return Fe&&e&&o.toLowerCase()==="o"}function Bd(o,e,t){return Nn(o)&&(Fe?e:t)}function Fd(o,e,t){return xn(o)&&(Fe?e:t)}function Hd(o,e){return Fe&&e&&Nn(o)}function Kd(o,e){return Fe&&e&&xn(o)}function Ud(o,e,t,n){return Fe?e||t?!1:Nn(o)||o.toLowerCase()==="h"&&n:n||e||t?!1:Nn(o)}function zd(o,e,t,n,r){return Fe?t||n||r?!1:xn(o)||o.toLowerCase()==="d"&&e:e||n||r?!1:xn(o)}function Wd(o,e,t,n){return o.toLowerCase()==="z"&&!e&&Nr(t,n)}function qd(o,e,t,n){return Fe?o.toLowerCase()==="z"&&t&&e:o.toLowerCase()==="y"&&n||o.toLowerCase()==="z"&&n&&e}function Yd(o,e,t,n){return e?!1:o.toLowerCase()==="c"?Fe?t:n:!1}function Zd(o,e,t,n){return e?!1:o.toLowerCase()==="x"?Fe?t:n:!1}function Vd(o){return o==="ArrowLeft"}function Xd(o){return o==="ArrowRight"}function Ih(o){return o==="ArrowUp"}function $h(o){return o==="ArrowDown"}function Gd(o,e,t,n){return Vd(o)&&!e&&!n&&!t}function jd(o,e,t,n,r){return Vd(o)&&!n&&!t&&(e||r)}function Jd(o,e,t,n){return Xd(o)&&!e&&!n&&!t}function Qd(o,e,t,n,r){return Xd(o)&&!n&&!t&&(e||r)}function ec(o,e,t){return Ih(o)&&!e&&!t}function tc(o,e,t){return $h(o)&&!e&&!t}function oc(o,e,t,n){return o||e||t||n}function nc(o){return o===" "}function Nr(o,e){return Fe?o:e}function rc(o){return o==="Enter"}function Nn(o){return o==="Backspace"}function ic(o){return o==="Escape"}function xn(o){return o==="Delete"}function el(o,e,t){return o.toLowerCase()==="a"&&Nr(e,t)}function tl(){let o=F(),e=o.select(0,o.getChildrenSize());Y(Ao(e))}function po(o,e){o.__lexicalClassNameCache===void 0&&(o.__lexicalClassNameCache={});let t=o.__lexicalClassNameCache,n=t[e];if(n!==void 0)return n;let r=o[e];if(typeof r=="string"){let i=yt(r);return t[e]=i,i}return r}function di(o,e,t,n,r){if(t.size===0)return;let i=n.__type,s=n.__key,l=e.get(i);l===void 0&&x(!1,"Type %s not in registeredNodes",i);let a=l.klass,d=o.get(a);d===void 0&&(d=new Map,o.set(a,d));let m=d.get(s),f=m==="destroyed"&&r==="created";(m===void 0||f)&&d.set(s,f?"updated":r)}function Cd(o,e,t){let n=o.getParent(),r=t,i=o;return n!==null&&(e&&t===0?(r=i.getIndexWithinParent(),i=n):!e&&t===i.getChildrenSize()&&(r=i.getIndexWithinParent()+1,i=n)),i.getChildAtIndex(e?r-1:r)}function Zt(o,e){let t=o.offset;if(o.type==="element"){let n=o.getNode();return Cd(n,e,t)}else{let n=o.getNode();if(e&&t===0||!e&&t===n.getTextContentSize()){let r=e?n.getPreviousSibling():n.getNextSibling();return r===null?Cd(n.getParentOrThrow(),e,n.getIndexWithinParent()+(e?0:1)):r}}return null}function ri(o){let e=hn(o).event,t=e&&e.inputType;return t==="insertFromPaste"||t==="insertFromPasteAsQuotation"}function D(o,e,t){return il(o,e,t)}function xr(o){return!oe(o)&&!o.isLastChild()&&!o.isInline()}function bn(o,e){let t=o._keyToDOMMap.get(e);return t===void 0&&x(!1,"Reconciliation: could not find DOM element for node key %s",e),t}function ci(o){let e=o.assignedSlot||o.parentElement;return e!==null&&e.nodeType===11?e.host:e}function sc(o,e,t){let n=t.ownerDocument,r=n.defaultView;if(r===null)return;let{top:i,bottom:s}=e,l=0,a=0,d=t;for(;d!==null;){let m=d===n.body;if(m)l=0,a=hn(o).innerHeight;else{let c=d.getBoundingClientRect();l=c.top,a=c.bottom}let f=0;if(i<l?f=-(l-i):s>a&&(f=s-a),f!==0)if(m)r.scrollBy(0,f);else{let c=d.scrollTop;d.scrollTop+=f;let u=d.scrollTop-c;i-=u,s-=u}if(m)break;d=ci(d)}}function lc(o){let e=T();if(!_(e)||!E(o))return e;let{anchor:t,focus:n}=e,r=t.getNode(),i=n.getNode();return En(r,o)&&t.set(o.__key,0,"element"),En(i,o)&&n.set(o.__key,0,"element"),e}function En(o,e){let t=o.getParent();for(;t!==null;){if(t.is(e))return!0;t=t.getParent()}return!1}function ac(o){let e=o.ownerDocument;return e&&e.defaultView||null}function hn(o){let e=o._window;return e===null&&x(!1,"window object not found"),e}function ol(o){let e=o.getParentOrThrow();for(;e!==null;){if(me(e))return e;e=e.getParentOrThrow()}return e}var YT=Symbol.for("@lexical/ShadowRootNodeBrand");function me(o){return oe(o)||E(o)&&o.isShadowRoot()}function ne(o){let e=j(),t=o.constructor.getType(),n=e._nodes.get(t);n===void 0&&x(!1,'$initializeNode failed. Ensure node has been registered to the editor. You can do this by passing the node class via the "nodes" array in the editor config.');let r=n.replace;if(r!==null){let i=r(o);return i instanceof o.constructor||x(!1,"$initializeNode failed. Ensure replacement node is a subclass of the original node."),i}return o}function ui(o,e){let t=o.getParent();oe(t)&&!E(e)&&!B(e)&&x(!1,"Only element or decorator nodes can be inserted in to the root node")}function Ph(o){let e=o.theme,t=document.createElement("div");t.contentEditable="false",t.setAttribute("data-lexical-cursor","true");let n=e.blockCursor;if(n!==void 0){if(typeof n=="string"){let r=yt(n);n=e.blockCursor=r}n!==void 0&&t.classList.add(...n)}return t}function Xs(o){return(B(o)||E(o)&&!o.canBeEmpty())&&!o.isInline()}function Er(o,e,t){t.style.removeProperty("caret-color"),e._blockCursorElement=null;let n=o.parentElement;n!==null&&n.removeChild(o)}function dc(o,e,t){let n=o._blockCursorElement;if(_(t)&&t.isCollapsed()&&t.anchor.type==="element"&&e.contains(document.activeElement)){let r=t.anchor,i=r.getNode(),s=r.offset,l=i.getChildrenSize(),a=!1,d=null;if(s===l){let m=i.getChildAtIndex(s-1);Xs(m)&&(a=!0)}else{let m=i.getChildAtIndex(s);if(Xs(m)){let f=m.getPreviousSibling();(f===null||Xs(f))&&(a=!0,d=o.getElementByKey(m.__key))}}if(a){let m=o.getElementByKey(i.__key);n===null&&(o._blockCursorElement=n=Ph(o._config)),e.style.caretColor="transparent",d===null?m.appendChild(n):m.insertBefore(n,d);return}}n!==null&&Er(n,o,e)}function be(o){return fe?(o||window).getSelection():null}function fi(o){return pe(o)&&o.tagName==="A"}function pe(o){return o.nodeType===1}function Io(o){let e=new RegExp(/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var|#text)$/,"i");return o.nodeName.match(e)!==null}function go(o){let e=new RegExp(/^(address|article|aside|blockquote|canvas|dd|div|dl|dt|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hr|li|main|nav|noscript|ol|p|pre|section|table|td|tfoot|ul|video)$/,"i");return o.nodeName.match(e)!==null}function $o(o){if(oe(o)||B(o)&&!o.isInline())return!0;if(!E(o)||me(o))return!1;let e=o.getFirstChild(),t=e===null||ve(e)||y(e)||e.isInline();return!o.isInline()&&o.canBeEmpty()!==!1&&t}function mi(o,e){let t=o;for(;t!==null&&t.getParent()!==null&&!e(t);)t=t.getParentOrThrow();return e(t)?t:null}function nl(){return j()}var _d=new WeakMap,Bh=new Map;function cc(o){if(!o._readOnly&&o.isEmpty())return Bh;x(o._readOnly,"getCachedTypeToNodeMap called with a writable EditorState");let e=_d.get(o);if(!e){e=new Map,_d.set(o,e);for(let[t,n]of o._nodeMap){let r=n.__type,i=e.get(r);i||(i=new Map,e.set(r,i)),i.set(t,n)}}return e}function Vt(o){let e=o.constructor,t=e.clone(o);return t.afterCloneFrom(o),__DEV__&&(x(t.__key===o.__key,"$cloneWithProperties: %s.clone(node) (with type '%s') did not return a node with the same key, make sure to specify node.__key as the last argument to the constructor",e.name,e.getType()),x(t.__parent===o.__parent&&t.__next===o.__next&&t.__prev===o.__prev,"$cloneWithProperties: %s.clone(node) (with type '%s') overrided afterCloneFrom but did not call super.afterCloneFrom(prevNode)",e.name,e.getType())),t}function fc(o,e){let t=o._decorators,r=o._pendingDecorators||t,i=e._nodeMap,s;for(s in r)i.has(s)||(r===t&&(r=si(o)),delete r[s])}function mc(o,e,t,n,r,i){let s=o.getFirstChild();for(;s!==null;){let l=s.__key;s.__parent===e&&(E(s)&&mc(s,l,t,n,r,i),t.has(l)||i.delete(l),r.push(l)),s=s.getNextSibling()}}function pc(o,e,t,n){let r=o._nodeMap,i=e._nodeMap,s=[];for(let[l]of n){let a=i.get(l);a!==void 0&&(a.isAttached()||(E(a)&&mc(a,l,r,i,s,n),r.has(l)||n.delete(l),s.push(l)))}for(let l of s)i.delete(l);for(let l of t){let a=i.get(l);a!==void 0&&!a.isAttached()&&(r.has(l)||t.delete(l),i.delete(l))}}var ce="",No=null,lt="",Xt="",yn,ye,Cr,hc=!1,gi=!1,hi,ll,al,Po,at,dl,_r;function Ni(o,e){let t=Po.get(o);if(e!==null){let n=fl(o);n.parentNode===e&&e.removeChild(n)}if(at.has(o)||ye._keyToDOMMap.delete(o),E(t)){let n=pi(t,Po);cl(n,0,n.length-1,null)}t!==void 0&&di(_r,Cr,hi,t,"destroyed")}function cl(o,e,t,n){let r=e;for(;r<=t;++r){let i=o[r];i!==void 0&&Ni(i,n)}}function xi(o,e,t){let n=at.get(o);n===void 0&&x(!1,"createNode: node does not exist in nodeMap");let r=n.createDOM(yn,ye);if(qh(o,r,ye),y(n)?r.setAttribute("data-lexical-text","true"):B(n)&&r.setAttribute("data-lexical-decorator","true"),E(n)){let i=n.__size;if(i!==0){let s=i-1,l=pi(n,at);ul(l,n,0,s,r,null)}n.isInline()||Nc(null,n,r),xr(n)&&(ce+=Ze,Xt+=Ze)}else{let i=n.getTextContent();if(B(n)){let s=n.decorate(ye,yn);s!==null&&xc(o,s),r.contentEditable="false"}ce+=i,Xt+=i}if(e!==null&&!n?.insertDOMIntoParent(r,e))if(t!=null)e.insertBefore(r,t);else{let s=e.__lexicalLineBreak;s!=null?e.insertBefore(r,s):e.appendChild(r)}return __DEV__&&Object.freeze(n),di(_r,Cr,hi,n,"created"),r}function ul(o,e,t,n,r,i){let s=ce;ce="";let l=t;for(;l<=n;++l){xi(o[l],r,i);let a=at.get(o[l]);a!==null&&y(a)&&(No===null&&(No=a.getFormat()),lt===""&&(lt=a.getStyle()))}xr(e)&&(ce+=Ze),r.__lexicalTextContent=ce,ce=s+ce}function gc(o,e){let t=e.get(o);return ve(t)||B(t)&&t.isInline()}function Nc(o,e,t){let n=o!==null&&(o.__size===0||gc(o.__last,Po)),r=e.__size===0||gc(e.__last,at);if(n){if(!r){let i=t.__lexicalLineBreak;if(i!=null)try{t.removeChild(i)}catch(s){if(typeof s=="object"&&s!=null){let l=`${s.toString()} Parent: ${t.tagName}, child: ${i.tagName}.`;throw new Error(l)}else throw s}t.__lexicalLineBreak=null}}else if(r){let i=document.createElement("br");t.__lexicalLineBreak=i,t.appendChild(i)}}function Fh(o){dt(o)&&No!=null&&!gi&&o.setTextStyle(lt)}function Hh(o){dt(o)&&lt!==""&&lt!==o.__textStyle&&!gi&&o.setTextStyle(lt)}function Kh(o,e,t){No=null,lt="",Uh(o,e,t),Fh(e),Hh(e)}function pi(o,e){let t=[],n=o.__first;for(;n!==null;){let r=e.get(n);r===void 0&&x(!1,"createChildrenArray: node does not exist in nodeMap"),t.push(n),n=r.__next}return t}function Uh(o,e,t){let n=ce,r=o.__size,i=e.__size;if(ce="",r===1&&i===1){let s=o.__first,l=e.__first;if(s===l)Tr(s,t);else{let d=fl(s),m=xi(l,null,null);try{t.replaceChild(m,d)}catch(f){if(typeof f=="object"&&f!=null){let c=`${f.toString()} Parent: ${t.tagName}, new child: {tag: ${m.tagName} key: ${l}}, old child: {tag: ${d.tagName}, key: ${s}}.`;throw new Error(c)}else throw f}Ni(s,null)}let a=at.get(l);y(a)&&(No===null&&(No=a.getFormat()),lt===""&&(lt=a.getStyle()))}else{let s=pi(o,Po),l=pi(e,at);if(r===0)i!==0&&ul(l,e,0,i-1,t,null);else if(i===0){if(r!==0){let d=t.__lexicalLineBreak==null;cl(s,0,r-1,d?null:t),d&&(t.textContent="")}}else Wh(e,s,l,r,i,t)}xr(e)&&(ce+=Ze),t.__lexicalTextContent=ce,ce=n+ce}function Tr(o,e){let t=Po.get(o),n=at.get(o);(t===void 0||n===void 0)&&x(!1,"reconcileNode: prevNode or nextNode does not exist in nodeMap");let r=hc||al.has(o)||ll.has(o),i=bn(ye,o);if(t===n&&!r){if(E(t)){let s=i.__lexicalTextContent;s!==void 0&&(ce+=s,Xt+=s)}else{let s=t.getTextContent();Xt+=s,ce+=s}return i}if(t!==n&&r&&di(_r,Cr,hi,n,"updated"),n.updateDOM(t,i,yn)){let s=xi(o,null,null);return e===null&&x(!1,"reconcileNode: parentDOM is null"),e.replaceChild(s,i),Ni(o,null),s}if(E(t)&&E(n))r&&(Kh(t,n,i),!oe(n)&&!n.isInline()&&Nc(t,n,i)),xr(n)&&(ce+=Ze,Xt+=Ze);else{let s=n.getTextContent();if(B(n)){let l=n.decorate(ye,yn);l!==null&&xc(o,l)}ce+=s,Xt+=s}if(!gi&&oe(n)&&n.__cachedText!==Xt){let s=n.getWritable();s.__cachedText=Xt,n=s}return __DEV__&&Object.freeze(n),i}function xc(o,e){let t=ye._pendingDecorators,n=ye._decorators;if(t===null){if(n[o]===e)return;t=si(ye)}t[o]=e}function zh(o){return o.firstChild}function sl(o){let e=o.nextSibling;return e!==null&&e===ye._blockCursorElement&&(e=e.nextSibling),e}function Wh(o,e,t,n,r,i){let s=n-1,l=r-1,a,d,m=zh(i),f=0,c=0;for(;f<=s&&c<=l;){let g=e[f],h=t[c];if(g===h)m=sl(Tr(h,i)),f++,c++;else{a===void 0&&(a=new Set(e)),d===void 0&&(d=new Set(t));let N=d.has(g),L=a.has(h);if(!N)m=sl(fl(g)),Ni(g,i),f++;else if(!L)xi(h,i,m),c++;else{let M=bn(ye,h);M===m?m=sl(Tr(h,i)):(m!=null?i.insertBefore(M,m):i.appendChild(M),Tr(h,i)),f++,c++}}let C=at.get(h);C!==null&&y(C)&&(No===null&&(No=C.getFormat()),lt===""&&(lt=C.getStyle()))}let u=f>s,p=c>l;if(u&&!p){let g=t[l+1],h=g===void 0?null:ye.getElementByKey(g);ul(t,o,c,l,i,h)}else p&&!u&&cl(e,f,s,i)}function Ec(o,e,t,n,r,i){ce="",Xt="",hc=n===Wt,ye=t,yn=t._config,Cr=t._nodes,hi=ye._listeners.mutation,ll=r,al=i,Po=o._nodeMap,at=e._nodeMap,gi=e._readOnly,dl=new Map(t._keyToDOMMap);let s=new Map;return _r=s,Tr("root",null),ye=void 0,Cr=void 0,ll=void 0,al=void 0,Po=void 0,at=void 0,yn=void 0,dl=void 0,_r=void 0,s}function qh(o,e,t){let n=t._keyToDOMMap;e["__lexicalKey_"+t._key]=o,n.set(o,e)}function fl(o){let e=dl.get(o);return e===void 0&&x(!1,"Reconciliation: could not find DOM element for node key %s",o),e}var Gt=Object.freeze({}),Nl=30,ml=[["keydown",eN],["pointerdown",Zh],["compositionstart",Jh],["compositionend",Qh],["input",jh],["click",Yh],["cut",Gt],["copy",Gt],["dragstart",Gt],["dragover",Gt],["dragend",Gt],["paste",Gt],["focus",Gt],["blur",Gt],["drop",Gt]];fo&&ml.push(["beforeinput",(o,e)=>Gh(o,e)]);var Sr=0,yc=null,Sc=0,Sn=null,Ei=new WeakMap,pl=!1,gl=!1,yr=!1,br=!1,Lc=[0,"",0,"root",0];function Mc(o,e,t,n,r){let i=o.anchor,s=o.focus,l=i.getNode(),a=j(),d=be(a._window),m=d!==null?d.anchorNode:null,f=i.key,c=a.getElementByKey(f),u=t.length;return f!==s.key||!y(l)||(!r&&(!fo||Sc<n+50)||l.isDirty()&&u<2||li(t))&&i.offset!==s.offset&&!l.isComposing()||Ue(l)||l.isDirty()&&u>1||(r||!fo)&&c!==null&&!l.isComposing()&&m!==_n(c)||d!==null&&e!==null&&(!e.collapsed||e.startContainer!==d.anchorNode||e.startOffset!==d.anchorOffset)||l.getFormat()!==o.format||l.getStyle()!==o.style||Dd(o,l)}function Tc(o,e){return o!==null&&o.nodeValue!==null&&o.nodeType===Ke&&e!==0&&e!==o.nodeValue.length}function Cc(o,e,t){let{anchorNode:n,anchorOffset:r,focusNode:i,focusOffset:s}=o;pl&&(pl=!1,Tc(n,r)&&Tc(i,s))||xe(e,()=>{if(!t){Y(null);return}if(!qt(e,n,i))return;let l=T();if(_(l)){let a=l.anchor,d=a.getNode();if(l.isCollapsed()){o.type==="Range"&&o.anchorNode===o.focusNode&&(l.dirty=!0);let m=hn(e).event,f=m?m.timeStamp:performance.now(),[c,u,p,g,h]=Lc,C=F(),N=e.isComposing()===!1&&C.getTextContent()==="";if(f<h+200&&a.offset===p&&a.key===g)l.format=c,l.style=u;else if(a.type==="text")x(y(d),"Point.getNode() must return TextNode when type is text"),l.format=d.getFormat(),l.style=d.getStyle();else if(a.type==="element"&&!N){let L=a.getNode();l.style="",L instanceof ct&&L.getChildrenSize()===0?l.style=L.getTextStyle():l.format=0}}else{let m=a.key,c=l.focus.key,u=l.getNodes(),p=u.length,g=l.isBackward(),h=g?s:r,C=g?r:s,N=g?c:m,L=g?m:c,M=Us,S=!1;for(let A=0;A<p;A++){let O=u[A],R=O.getTextContentSize();if(y(O)&&R!==0&&!(A===0&&O.__key===N&&h===R||A===p-1&&O.__key===L&&C===0)&&(S=!0,M&=O.getFormat(),M===0))break}l.format=S?M:0}}D(e,we,void 0)})}function Yh(o,e){xe(e,()=>{let t=T(),n=be(e._window),r=ze();if(n){if(_(t)){let i=t.anchor,s=i.getNode();if(i.type==="element"&&i.offset===0&&t.isCollapsed()&&!oe(s)&&F().getChildrenSize()===1&&s.getTopLevelElementOrThrow().isEmpty()&&r!==null&&t.is(r))n.removeAllRanges(),t.dirty=!0;else if(o.detail===3&&!t.isCollapsed()){let a=t.focus.getNode();s!==a&&(E(s)?s.select(0):s.getParentOrThrow().select(0))}}else if(o.pointerType==="touch"){let i=n.anchorNode;if(i!==null){let s=i.nodeType;if(s===mo||s===Ke){let l=Lr(r,n,e,o);Y(l)}}}}D(e,tr,o)})}function Zh(o,e){let t=o.target,n=o.pointerType;t instanceof Node&&n!=="touch"&&xe(e,()=>{Sd(t)||(gl=!0)})}function wc(o){if(!o.getTargetRanges)return null;let e=o.getTargetRanges();return e.length===0?null:e[0]}function Vh(o,e){return o!==e||E(o)||E(e)||!o.isToken()||!e.isToken()}function Xh(o){return yc==="MediaLast"&&o<Sr+Nl}function Gh(o,e){let t=o.inputType,n=wc(o);t==="deleteCompositionText"||He&&ri(e)||t!=="insertCompositionText"&&xe(e,()=>{let r=T();if(t==="deleteContentBackward"){if(r===null){let m=ze();if(!_(m))return;Y(m.clone())}if(_(r)){let m=r.anchor.key===r.focus.key;if(Xh(o.timeStamp)&&e.isComposing()&&m){if(se(null),Sr=0,setTimeout(()=>{xe(e,()=>{se(null)})},Nl),_(r)){let f=r.anchor.getNode();f.markDirty(),x(y(f),"Anchor node must be a TextNode"),r.style=f.getStyle()}}else{se(null),o.preventDefault();let f=r.anchor.getNode().getTextContent(),c=r.anchor.offset===0&&r.focus.offset===f.length;Hs&&m&&!c||D(e,Ye,!0)}return}}if(!_(r))return;let i=o.data;Sn!==null&&ai(!1,e,Sn),(!r.dirty||Sn!==null)&&r.isCollapsed()&&!oe(r.anchor.getNode())&&n!==null&&r.applyDOMRange(n),Sn=null;let s=r.anchor,l=r.focus,a=s.getNode(),d=l.getNode();if(t==="insertText"||t==="insertTranspose"){if(i===`
`)o.preventDefault(),D(e,$t,!1);else if(i===Ze)o.preventDefault(),D(e,Pt,void 0);else if(i==null&&o.dataTransfer){let m=o.dataTransfer.getData("text/plain");o.preventDefault(),r.insertRawText(m)}else i!=null&&Mc(r,n,i,o.timeStamp,!0)?(o.preventDefault(),D(e,rt,i)):Sn=i;Sc=o.timeStamp;return}switch(o.preventDefault(),t){case"insertFromYank":case"insertFromDrop":case"insertReplacementText":{D(e,rt,o);break}case"insertFromComposition":{se(null),D(e,rt,o);break}case"insertLineBreak":{se(null),D(e,$t,!1);break}case"insertParagraph":{se(null),yr&&!_t?(yr=!1,D(e,$t,!1)):D(e,Pt,void 0);break}case"insertFromPaste":case"insertFromPasteAsQuotation":{D(e,ro,o);break}case"deleteByComposition":{Vh(a,d)&&D(e,cn,o);break}case"deleteByDrag":case"deleteByCut":{D(e,cn,o);break}case"deleteContent":{D(e,Ye,!1);break}case"deleteWordBackward":{D(e,Ct,!0);break}case"deleteWordForward":{D(e,Ct,!1);break}case"deleteHardLineBackward":case"deleteSoftLineBackward":{D(e,it,!0);break}case"deleteContentForward":case"deleteHardLineForward":case"deleteSoftLineForward":{D(e,it,!1);break}case"formatStrikeThrough":{D(e,Ne,"strikethrough");break}case"formatBold":{D(e,Ne,"bold");break}case"formatItalic":{D(e,Ne,"italic");break}case"formatUnderline":{D(e,Ne,"underline");break}case"historyUndo":{D(e,io,void 0);break}case"historyRedo":{D(e,so,void 0);break}default:}})}function jh(o,e){o.stopPropagation(),xe(e,()=>{let t=T(),n=o.data,r=wc(o);if(n!=null&&_(t)&&Mc(t,r,n,o.timeStamp,!1)){br&&(hl(e,n),br=!1);let s=t.anchor.getNode(),l=be(e._window);if(l===null)return;let a=t.isBackward(),d=a?t.anchor.offset:t.focus.offset,m=a?t.focus.offset:t.anchor.offset;(!fo||t.isCollapsed()||!y(s)||l.anchorNode===null||s.getTextContent().slice(0,d)+n+s.getTextContent().slice(d+m)!==Qs(l.anchorNode))&&D(e,rt,n);let f=n.length;He&&f>1&&o.inputType==="insertCompositionText"&&!e.isComposing()&&(t.anchor.offset-=f),!Ut&&!_t&&!zt&&e.isComposing()&&(Sr=0,se(null))}else ai(!1,e,n!==null?n:void 0),br&&(hl(e,n||void 0),br=!1);vd()}),Sn=null}function Jh(o,e){xe(e,()=>{let t=T();if(_(t)&&!e.isComposing()){let n=t.anchor,r=t.anchor.getNode();se(n.key),(o.timeStamp<Sr+Nl||n.type==="element"||!t.isCollapsed()||y(r)&&r.getStyle()!==t.style)&&D(e,rt,cd)}})}function hl(o,e){let t=o._compositionKey;if(se(null),t!==null&&e!=null){if(e===""){let n=J(t),r=_n(o.getElementByKey(t));r!==null&&r.nodeValue!==null&&y(n)&&fr(n,r.nodeValue,null,null,!0);return}if(e[e.length-1]===`
`){let n=T();if(_(n)){let r=n.focus;n.anchor.set(r.key,r.offset,r.type),D(o,Be,null);return}}}ai(!0,o,e)}function Qh(o,e){He?br=!0:xe(e,()=>{hl(e,o.data)})}function eN(o,e){if(Sr=o.timeStamp,yc=o.key,e.isComposing())return;let{key:t,shiftKey:n,ctrlKey:r,metaKey:i,altKey:s}=o;if(!D(e,Ds,o)&&t!=null){if(Jd(t,r,s,i))D(e,Mo,o);else if(Qd(t,r,n,s,i))D(e,Os,o);else if(Gd(t,r,s,i))D(e,wo,o);else if(jd(t,r,n,s,i))D(e,As,o);else if(ec(t,r,i))D(e,Bt,o);else if(tc(t,r,i))D(e,Ft,o);else if($d(t,n))yr=!0,D(e,Be,o);else if(nc(t))D(e,or,o);else if(Pd(t,r))o.preventDefault(),yr=!0,D(e,$t,!0);else if(Id(t,n))yr=!1,D(e,Be,o);else if(Ud(t,s,i,r))Nn(t)?D(e,Ht,o):(o.preventDefault(),D(e,Ye,!0));else if(ic(t))D(e,vo,o);else if(zd(t,r,n,s,i))xn(t)?D(e,Kt,o):(o.preventDefault(),D(e,Ye,!1));else if(Bd(t,s,r))o.preventDefault(),D(e,Ct,!0);else if(Fd(t,s,r))o.preventDefault(),D(e,Ct,!1);else if(Hd(t,i))o.preventDefault(),D(e,it,!0);else if(Kd(t,i))o.preventDefault(),D(e,it,!1);else if(Ad(t,s,i,r))o.preventDefault(),D(e,Ne,"bold");else if(kd(t,s,i,r))o.preventDefault(),D(e,Ne,"underline");else if(Rd(t,s,i,r))o.preventDefault(),D(e,Ne,"italic");else if(Od(t,s,r,i))D(e,Do,o);else if(Wd(t,n,i,r))o.preventDefault(),D(e,io,void 0);else if(qd(t,n,i,r))o.preventDefault(),D(e,so,void 0);else{let l=e._editorState._selection;Se(l)?Yd(t,n,i,r)?(o.preventDefault(),D(e,lo,o)):Zd(t,n,i,r)?(o.preventDefault(),D(e,ao,o)):el(t,i,r)&&(o.preventDefault(),D(e,un,o)):!He&&el(t,i,r)&&(o.preventDefault(),D(e,un,o))}oc(r,n,s,i)&&D(e,Bs,o)}}function vc(o){let e=o.__lexicalEventHandles;return e===void 0&&(e=[],o.__lexicalEventHandles=e),e}var Ln=new Map;function Dc(o){let e=o.target,t=e==null?null:e.nodeType===9?e.defaultView:e.ownerDocument.defaultView,n=be(t);if(n===null)return;let r=ii(n.anchorNode);if(r===null)return;gl&&(gl=!1,xe(r,()=>{let m=ze(),f=n.anchorNode;if(f===null)return;let c=f.nodeType;if(c!==mo&&c!==Ke)return;let u=Lr(m,n,r,o);Y(u)}));let i=hr(r),s=i[i.length-1],l=s._key,a=Ln.get(l),d=a||s;d!==r&&Cc(n,d,!1),Cc(n,r,!0),r!==s?Ln.set(l,r):a&&Ln.delete(l)}function _c(o){o._lexicalHandled=!0}function bc(o){return o._lexicalHandled===!0}function Oc(o,e){let t=o.ownerDocument,n=Ei.get(t);(n===void 0||n<1)&&t.addEventListener("selectionchange",Dc),Ei.set(t,(n||0)+1),o.__lexicalEditor=e;let r=vc(o);for(let i=0;i<ml.length;i++){let[s,l]=ml[i],a=typeof l=="function"?d=>{bc(d)||(_c(d),(e.isEditable()||s==="click")&&l(d,e))}:d=>{if(bc(d))return;_c(d);let m=e.isEditable();switch(s){case"cut":return m&&D(e,ao,d);case"copy":return D(e,lo,d);case"paste":return m&&D(e,ro,d);case"dragstart":return m&&D(e,nr,d);case"dragover":return m&&D(e,rr,d);case"dragend":return m&&D(e,ks,d);case"focus":return m&&D(e,ir,d);case"blur":return m&&D(e,Ps,d);case"drop":return m&&D(e,Oo,d)}};o.addEventListener(s,a),r.push(()=>{o.removeEventListener(s,a)})}}function Ac(o){let e=o.ownerDocument,t=Ei.get(e);x(t!==void 0,"Root element not registered");let n=t-1;x(n>=0,"Root element count less than 0"),Ei.set(e,n),n===0&&e.removeEventListener("selectionchange",Dc);let r=Ro(o);Cn(r)?(tN(r),o.__lexicalEditor=null):r&&x(!1,"Attempted to remove event handlers from a node that does not belong to this build of Lexical");let i=vc(o);for(let s=0;s<i.length;s++)i[s]();o.__lexicalEventHandles=[]}function tN(o){if(o._parentEditor!==null){let e=hr(o),n=e[e.length-1]._key;Ln.get(n)===o&&Ln.delete(n)}else Ln.delete(o._key)}function Rc(){pl=!0}function kc(o,e,t,n,r){Lc=[o,e,t,n,r]}function xl(o,e,t){de();let n=o.__key,r=o.getParent();if(r===null)return;let i=lc(o),s=!1;if(_(i)&&e){let l=i.anchor,a=i.focus;l.key===n&&(wn(l,o,r,o.getPreviousSibling(),o.getNextSibling()),s=!0),a.key===n&&(wn(a,o,r,o.getPreviousSibling(),o.getNextSibling()),s=!0)}else Se(i)&&e&&o.isSelected()&&o.selectPrevious();if(_(i)&&e&&!s){let l=o.getIndexWithinParent();Yt(o),Mn(i,r,l,-1)}else Yt(o);!t&&!me(r)&&!r.canBeEmpty()&&r.isEmpty()&&xl(r,e),e&&oe(r)&&r.isEmpty()&&r.selectEnd()}var St=class{static getType(){x(!1,"LexicalNode: Node %s does not implement .getType().",this.name)}static clone(e){x(!1,"LexicalNode: Node %s does not implement .clone().",this.name)}afterCloneFrom(e){this.__parent=e.__parent,this.__next=e.__next,this.__prev=e.__prev}constructor(e){this.__type=this.constructor.getType(),this.__parent=null,this.__prev=null,this.__next=null,Ld(this,e),__DEV__&&this.__type!=="root"&&(de(),oN(this.__type,this.constructor))}getType(){return this.__type}isInline(){x(!1,"LexicalNode: Node %s does not implement .isInline().",this.constructor.name)}isAttached(){let e=this.__key;for(;e!==null;){if(e==="root")return!0;let t=J(e);if(t===null)break;e=t.__parent}return!1}isSelected(e){let t=e||T();if(t==null)return!1;let n=t.getNodes().some(i=>i.__key===this.__key);if(y(this))return n;if(_(t)&&t.anchor.type==="element"&&t.focus.type==="element"){if(t.isCollapsed())return!1;let i=this.getParent();if(B(this)&&this.isInline()&&i){let s=t.isBackward()?t.focus:t.anchor,l=s.getNode();if(s.offset===l.getChildrenSize()&&l.is(i)&&l.getLastChildOrThrow().is(this))return!1}}return n}getKey(){return this.__key}getIndexWithinParent(){let e=this.getParent();if(e===null)return-1;let t=e.getFirstChild(),n=0;for(;t!==null;){if(this.is(t))return n;n++,t=t.getNextSibling()}return-1}getParent(){let e=this.getLatest().__parent;return e===null?null:J(e)}getParentOrThrow(){let e=this.getParent();return e===null&&x(!1,"Expected node %s to have a parent.",this.__key),e}getTopLevelElement(){let e=this;for(;e!==null;){let t=e.getParent();if(me(t))return x(E(e)||e===this&&B(e),"Children of root nodes must be elements or decorators"),e;e=t}return null}getTopLevelElementOrThrow(){let e=this.getTopLevelElement();return e===null&&x(!1,"Expected node %s to have a top parent element.",this.__key),e}getParents(){let e=[],t=this.getParent();for(;t!==null;)e.push(t),t=t.getParent();return e}getParentKeys(){let e=[],t=this.getParent();for(;t!==null;)e.push(t.__key),t=t.getParent();return e}getPreviousSibling(){let t=this.getLatest().__prev;return t===null?null:J(t)}getPreviousSiblings(){let e=[],t=this.getParent();if(t===null)return e;let n=t.getFirstChild();for(;n!==null&&!n.is(this);)e.push(n),n=n.getNextSibling();return e}getNextSibling(){let t=this.getLatest().__next;return t===null?null:J(t)}getNextSiblings(){let e=[],t=this.getNextSibling();for(;t!==null;)e.push(t),t=t.getNextSibling();return e}getCommonAncestor(e){let t=this.getParents(),n=e.getParents();E(this)&&t.unshift(this),E(e)&&n.unshift(e);let r=t.length,i=n.length;if(r===0||i===0||t[r-1]!==n[i-1])return null;let s=new Set(n);for(let l=0;l<r;l++){let a=t[l];if(s.has(a))return a}return null}is(e){return e==null?!1:this.__key===e.__key}isBefore(e){if(this===e)return!1;if(e.isParentOf(this))return!0;if(this.isParentOf(e))return!1;let t=this.getCommonAncestor(e),n=0,r=0,i=this;for(;;){let s=i.getParentOrThrow();if(s===t){n=i.getIndexWithinParent();break}i=s}for(i=e;;){let s=i.getParentOrThrow();if(s===t){r=i.getIndexWithinParent();break}i=s}return n<r}isParentOf(e){let t=this.__key;if(t===e.__key)return!1;let n=e;for(;n!==null;){if(n.__key===t)return!0;n=n.getParent()}return!1}getNodesBetween(e){let t=this.isBefore(e),n=[],r=new Set,i=this;for(;i!==null;){let s=i.__key;if(r.has(s)||(r.add(s),n.push(i)),i===e)break;let l=E(i)?t?i.getFirstChild():i.getLastChild():null;if(l!==null){i=l;continue}let a=t?i.getNextSibling():i.getPreviousSibling();if(a!==null){i=a;continue}let d=i.getParentOrThrow();if(r.has(d.__key)||n.push(d),d===e)break;let m=null,f=d;do if(f===null&&x(!1,"getNodesBetween: ancestor is null"),m=t?f.getNextSibling():f.getPreviousSibling(),f=f.getParent(),f!==null)m===null&&!r.has(f.__key)&&n.push(f);else break;while(m===null);i=m}return t||n.reverse(),n}isDirty(){let t=j()._dirtyLeaves;return t!==null&&t.has(this.__key)}getLatest(){let e=J(this.__key);return e===null&&x(!1,"Lexical node does not exist in active editor state. Avoid using the same node references between nested closures from editorState.read/editor.update."),e}getWritable(){de();let e=Ge(),t=j(),n=e._nodeMap,r=this.__key,i=this.getLatest(),s=t._cloneNotNeeded,l=T();if(l!==null&&l.setCachedNodes(null),s.has(r))return mr(i),i;let a=Vt(i);return s.add(r),mr(a),n.set(r,a),a}getTextContent(){return""}getTextContentSize(){return this.getTextContent().length}createDOM(e,t){x(!1,"createDOM: base method not extended")}updateDOM(e,t,n){x(!1,"updateDOM: base method not extended")}exportDOM(e){return{element:this.createDOM(e._config,e)}}exportJSON(){x(!1,"exportJSON: base method not extended")}static importJSON(e){x(!1,"LexicalNode: Node %s does not implement .importJSON().",this.name)}static transform(){return null}remove(e){xl(this,!0,e)}replace(e,t){de();let n=T();n!==null&&(n=n.clone()),ui(this,e);let r=this.getLatest(),i=this.__key,s=e.__key,l=e.getWritable(),a=this.getParentOrThrow().getWritable(),d=a.__size;Yt(l);let m=r.getPreviousSibling(),f=r.getNextSibling(),c=r.__prev,u=r.__next,p=r.__parent;if(xl(r,!1,!0),m===null)a.__first=s;else{let g=m.getWritable();g.__next=s}if(l.__prev=c,f===null)a.__last=s;else{let g=f.getWritable();g.__prev=s}if(l.__next=u,l.__parent=p,a.__size=d,t&&(x(E(this)&&E(l),"includeChildren should only be true for ElementNodes"),this.getChildren().forEach(g=>{l.append(g)})),_(n)){Y(n);let g=n.anchor,h=n.focus;g.key===i&&El(g,l),h.key===i&&El(h,l)}return Xe()===i&&se(s),l}insertAfter(e,t=!0){de(),ui(this,e);let n=this.getWritable(),r=e.getWritable(),i=r.getParent(),s=T(),l=!1,a=!1;if(i!==null){let u=e.getIndexWithinParent();if(Yt(r),_(s)){let p=i.__key,g=s.anchor,h=s.focus;l=g.type==="element"&&g.key===p&&g.offset===u+1,a=h.type==="element"&&h.key===p&&h.offset===u+1}}let d=this.getNextSibling(),m=this.getParentOrThrow().getWritable(),f=r.__key,c=n.__next;if(d===null)m.__last=f;else{let u=d.getWritable();u.__prev=f}if(m.__size++,n.__next=f,r.__next=c,r.__prev=n.__key,r.__parent=n.__parent,t&&_(s)){let u=this.getIndexWithinParent();Mn(s,m,u+1);let p=m.__key;l&&s.anchor.set(p,u+2,"element"),a&&s.focus.set(p,u+2,"element")}return e}insertBefore(e,t=!0){de(),ui(this,e);let n=this.getWritable(),r=e.getWritable(),i=r.__key;Yt(r);let s=this.getPreviousSibling(),l=this.getParentOrThrow().getWritable(),a=n.__prev,d=this.getIndexWithinParent();if(s===null)l.__first=i;else{let f=s.getWritable();f.__next=i}l.__size++,n.__prev=i,r.__prev=a,r.__next=n.__key,r.__parent=n.__parent;let m=T();if(t&&_(m)){let f=this.getParentOrThrow();Mn(m,f,d)}return e}isParentRequired(){return!1}createParentElementNode(){return I()}selectStart(){return this.selectPrevious()}selectEnd(){return this.selectNext(0,0)}selectPrevious(e,t){de();let n=this.getPreviousSibling(),r=this.getParentOrThrow();if(n===null)return r.select(0,0);if(E(n))return n.select();if(!y(n)){let i=n.getIndexWithinParent()+1;return r.select(i,i)}return n.select(e,t)}selectNext(e,t){de();let n=this.getNextSibling(),r=this.getParentOrThrow();if(n===null)return r.select();if(E(n))return n.select(0,0);if(!y(n)){let i=n.getIndexWithinParent();return r.select(i,i)}return n.select(e,t)}markDirty(){this.getWritable()}insertDOMIntoParent(e,t){return!1}};function oN(o,e){let t=j()._nodes.get(o);t===void 0&&x(!1,"Create node: Attempted to create node %s that was not configured to be used on the editor.",e.name);let n=t.klass;n!==e&&x(!1,"Create node: Type %s in node %s does not match registered node %s with the same type",o,e.name,n.name)}function Ic(o,e,t){let n=t||e.getParentOrThrow().getLastChild(),r=e,i=[e];for(;r!==n;)r.getNextSibling()||x(!1,"insertRangeAfter: lastToInsert must be a later sibling of firstToInsert"),r=r.getNextSibling(),i.push(r);let s=o;for(let l of i)s=s.insertAfter(l)}var Bo=class o extends St{static getType(){return"linebreak"}static clone(e){return new o(e.__key)}constructor(e){super(e)}getTextContent(){return`
`}createDOM(){return document.createElement("br")}updateDOM(){return!1}static importDOM(){return{br:e=>rN(e)||iN(e)?null:{conversion:nN,priority:0}}}static importJSON(e){return ut()}exportJSON(){return{type:"linebreak",version:1}}};function nN(o){return{node:ut()}}function ut(){return ne(new Bo)}function ve(o){return o instanceof Bo}function rN(o){let e=o.parentElement;if(e!==null&&go(e)){let t=e.firstChild;if(t===o||t.nextSibling===o&&Ti(t)){let n=e.lastChild;if(n===o||n.previousSibling===o&&Ti(n))return!0}}return!1}function iN(o){let e=o.parentElement;if(e!==null&&go(e)){let t=e.firstChild;if(t===o||t.nextSibling===o&&Ti(t))return!1;let n=e.lastChild;if(n===o||n.previousSibling===o&&Ti(n))return!0}return!1}function Ti(o){return o.nodeType===Ke&&/^( |\t|\r?\n)+$/.test(o.textContent||"")}function Tl(o,e){return e&ar?"code":e&ur?"mark":e&dr?"sub":e&cr?"sup":null}function Cl(o,e){return e&sr?"strong":e&lr?"em":"span"}function Fc(o,e,t,n,r){let i=n.classList,s=po(r,"base");s!==void 0&&i.add(...s),s=po(r,"underlineStrikethrough");let l=!1,a=e&mn&&e&fn,d=t&mn&&t&fn;s!==void 0&&(d?(l=!0,a||i.add(...s)):a&&i.remove(...s));for(let m in Ve){let c=Ve[m];if(s=po(r,m),s!==void 0)if(t&c){if(l&&(m==="underline"||m==="strikethrough")){e&c&&i.remove(...s);continue}((e&c)===0||a&&m==="underline"||m==="strikethrough")&&i.add(...s)}else e&c&&i.remove(...s)}}function sN(o,e){let t=o.length,n=e.length,r=0,i=0;for(;r<t&&r<n&&o[r]===e[r];)r++;for(;i+r<t&&i+r<n&&o[t-i-1]===e[n-i-1];)i++;return[r,t-r-i,e.slice(r,n-i)]}function Hc(o,e,t){let n=e.firstChild,r=t.isComposing(),s=o+(r?gn:"");if(n==null)e.textContent=s;else{let l=n.nodeValue;if(l!==s)if(r||He){let[a,d,m]=sN(l,s);d!==0&&n.deleteData(a,d),n.insertData(a,m)}else n.nodeValue=s}}function $c(o,e,t,n,r,i){Hc(r,o,e);let l=i.theme.text;l!==void 0&&Fc(t,0,n,o,l)}function Ci(o,e){let t=document.createElement(e);return t.appendChild(o),t}var je=class o extends St{static getType(){return"text"}static clone(e){return new o(e.__text,e.__key)}afterCloneFrom(e){super.afterCloneFrom(e),this.__format=e.__format,this.__style=e.__style,this.__mode=e.__mode,this.__detail=e.__detail}constructor(e,t){super(t),this.__text=e,this.__format=0,this.__style="",this.__mode=0,this.__detail=0}getFormat(){return this.getLatest().__format}getDetail(){return this.getLatest().__detail}getMode(){let e=this.getLatest();return gd[e.__mode]}getStyle(){return this.getLatest().__style}isToken(){return this.getLatest().__mode===Qr}isComposing(){return this.__key===Xe()}isSegmented(){return this.getLatest().__mode===ei}isDirectionless(){return(this.getLatest().__detail&ti)!==0}isUnmergeable(){return(this.getLatest().__detail&pn)!==0}hasFormat(e){let t=Ve[e];return(this.getFormat()&t)!==0}isSimpleText(){return this.__type==="text"&&this.__mode===0}getTextContent(){return this.getLatest().__text}getFormatFlags(e,t){let r=this.getLatest().__format;return pr(r,e,t)}canHaveFormat(){return!0}createDOM(e,t){let n=this.__format,r=Tl(this,n),i=Cl(this,n),s=r===null?i:r,l=document.createElement(s),a=l;this.hasFormat("code")&&l.setAttribute("spellcheck","false"),r!==null&&(a=document.createElement(i),l.appendChild(a));let d=this.__text;$c(a,this,i,n,d,e);let m=this.__style;return m!==""&&(l.style.cssText=m),l}updateDOM(e,t,n){let r=this.__text,i=e.__format,s=this.__format,l=Tl(this,i),a=Tl(this,s),d=Cl(this,i),m=Cl(this,s);if((l===null?d:l)!==(a===null?m:a))return!0;if(l===a&&d!==m){let N=t.firstChild;N==null&&x(!1,"updateDOM: prevInnerDOM is null or undefined");let L=document.createElement(m);return $c(L,this,m,s,r,n),t.replaceChild(L,N),!1}let u=t;a!==null&&l!==null&&(u=t.firstChild,u==null&&x(!1,"updateDOM: innerDOM is null or undefined")),Hc(r,u,this);let g=n.theme.text;g!==void 0&&i!==s&&Fc(m,i,s,u,g);let h=e.__style,C=this.__style;return h!==C&&(t.style.cssText=C),!1}static importDOM(){return{"#text":()=>({conversion:uN,priority:0}),b:()=>({conversion:aN,priority:0}),code:()=>({conversion:xo,priority:0}),em:()=>({conversion:xo,priority:0}),i:()=>({conversion:xo,priority:0}),s:()=>({conversion:xo,priority:0}),span:()=>({conversion:lN,priority:0}),strong:()=>({conversion:xo,priority:0}),sub:()=>({conversion:xo,priority:0}),sup:()=>({conversion:xo,priority:0}),u:()=>({conversion:xo,priority:0})}}static importJSON(e){let t=q(e.text);return t.setFormat(e.format),t.setDetail(e.detail),t.setMode(e.mode),t.setStyle(e.style),t}exportDOM(e){let{element:t}=super.exportDOM(e);x(t!==null&&pe(t),"Expected TextNode createDOM to always return a HTMLElement");let n=this.getTextContent();/^\s|\s$/.test(n)&&(t.style.whiteSpace="pre-wrap");for(let r of Array.from(t.classList.values()))r.startsWith("editor-theme-")&&t.classList.remove(r);return t.classList.length===0&&t.removeAttribute("class"),t.nodeName==="SPAN"&&!t.getAttribute("style")&&(t=document.createTextNode(n)),this.hasFormat("bold")&&(t=Ci(t,"b")),this.hasFormat("italic")&&(t=Ci(t,"em")),this.hasFormat("strikethrough")&&(t=Ci(t,"s")),this.hasFormat("underline")&&(t=Ci(t,"u")),{element:t}}exportJSON(){return{detail:this.getDetail(),format:this.getFormat(),mode:this.getMode(),style:this.getStyle(),text:this.getTextContent(),type:"text",version:1}}selectionTransform(e,t){}setFormat(e){let t=this.getWritable();return t.__format=typeof e=="string"?Ve[e]:e,t}setDetail(e){let t=this.getWritable();return t.__detail=typeof e=="string"?md[e]:e,t}setStyle(e){let t=this.getWritable();return t.__style=e,t}toggleFormat(e){let t=this.getFormat(),n=pr(t,e,null);return this.setFormat(n)}toggleDirectionless(){let e=this.getWritable();return e.__detail^=ti,e}toggleUnmergeable(){let e=this.getWritable();return e.__detail^=pn,e}setMode(e){let t=pd[e];if(this.__mode===t)return this;let n=this.getWritable();return n.__mode=t,n}setTextContent(e){if(this.__text===e)return this;let t=this.getWritable();return t.__text=e,t}select(e,t){de();let n=e,r=t,i=T(),s=this.getTextContent(),l=this.__key;if(typeof s=="string"){let a=s.length;n===void 0&&(n=a),r===void 0&&(r=a)}else n=0,r=0;if(_(i)){let a=Xe();(a===i.anchor.key||a===i.focus.key)&&se(l),i.setTextNodeRange(this,n,this,r)}else return _i(l,n,l,r,"text","text");return i}selectStart(){return this.select(0,0)}selectEnd(){let e=this.getTextContentSize();return this.select(e,e)}spliceText(e,t,n,r){let i=this.getWritable(),s=i.__text,l=n.length,a=e;a<0&&(a=l+a,a<0&&(a=0));let d=T();if(r&&_(d)){let f=e+l;d.setTextNodeRange(i,f,i,f)}let m=s.slice(0,a)+n+s.slice(a+t);return i.__text=m,i}canInsertTextBefore(){return!0}canInsertTextAfter(){return!0}splitText(...e){de();let t=this.getLatest(),n=t.getTextContent(),r=t.__key,i=Xe(),s=new Set(e),l=[],a=n.length,d="";for(let S=0;S<a;S++)d!==""&&s.has(S)&&(l.push(d),d=""),d+=n[S];d!==""&&l.push(d);let m=l.length;if(m===0)return[];if(l[0]===n)return[t];let f=l[0],c=t.getParent(),u,p=t.getFormat(),g=t.getStyle(),h=t.__detail,C=!1;t.isSegmented()?(u=q(f),u.__format=p,u.__style=g,u.__detail=h,C=!0):(u=t.getWritable(),u.__text=f);let N=T(),L=[u],M=f.length;for(let S=1;S<m;S++){let A=l[S],O=A.length,R=q(A).getWritable();R.__format=p,R.__style=g,R.__detail=h;let P=R.__key,k=M+O;if(_(N)){let W=N.anchor,ie=N.focus;W.key===r&&W.type==="text"&&W.offset>M&&W.offset<=k&&(W.key=P,W.offset-=M,N.dirty=!0),ie.key===r&&ie.type==="text"&&ie.offset>M&&ie.offset<=k&&(ie.key=P,ie.offset-=M,N.dirty=!0)}i===r&&se(P),M=k,L.push(R)}if(c!==null){Md(this);let S=c.getWritable(),A=this.getIndexWithinParent();C?(S.splice(A,0,L),this.remove()):S.splice(A,1,L),_(N)&&Mn(N,c,A,m-1)}return L}mergeWithSibling(e){let t=e===this.getPreviousSibling();!t&&e!==this.getNextSibling()&&x(!1,"mergeWithSibling: sibling must be a previous or next sibling");let n=this.__key,r=e.__key,i=this.__text,s=i.length;Xe()===r&&se(n);let a=T();if(_(a)){let c=a.anchor,u=a.focus;c!==null&&c.key===r&&(_l(c,t,n,e,s),a.dirty=!0),u!==null&&u.key===r&&(_l(u,t,n,e,s),a.dirty=!0)}let d=e.__text,m=t?d+i:i+d;this.setTextContent(m);let f=this.getWritable();return e.remove(),f}isTextEntity(){return!1}};function lN(o){let t=o.style;return{forChild:bl(t),node:null}}function aN(o){let e=o,t=e.style.fontWeight==="normal";return{forChild:bl(e.style,t?void 0:"bold"),node:null}}var Pc=new WeakMap;function dN(o){return o.nodeName==="PRE"||o.nodeType===mo&&o.style!==void 0&&o.style.whiteSpace!==void 0&&o.style.whiteSpace.startsWith("pre")}function cN(o){let e,t=o.parentNode,n=[o];for(;t!==null&&(e=Pc.get(t))===void 0&&!dN(t);)n.push(t),t=t.parentNode;let r=e===void 0?t:e;for(let i=0;i<n.length;i++)Pc.set(n[i],r);return r}function uN(o){let e=o,t=o.parentElement;x(t!==null,"Expected parentElement of Text not to be null");let n=e.textContent||"";if(cN(e)!==null){let r=n.split(/(\r?\n|\t)/),i=[],s=r.length;for(let l=0;l<s;l++){let a=r[l];a===`
`||a===`\r
`?i.push(ut()):a==="	"?i.push(Lt()):a!==""&&i.push(q(a))}return{node:i}}if(n=n.replace(/\r/g,"").replace(/[ \t\n]+/g," "),n==="")return{node:null};if(n[0]===" "){let r=e,i=!0;for(;r!==null&&(r=Bc(r,!1))!==null;){let s=r.textContent||"";if(s.length>0){/[ \t\n]$/.test(s)&&(n=n.slice(1)),i=!1;break}}i&&(n=n.slice(1))}if(n[n.length-1]===" "){let r=e,i=!0;for(;r!==null&&(r=Bc(r,!0))!==null;)if((r.textContent||"").replace(/^( |\t|\r?\n)+/,"").length>0){i=!1;break}i&&(n=n.slice(0,n.length-1))}return n===""?{node:null}:{node:q(n)}}function Bc(o,e){let t=o;for(;;){let n;for(;(n=e?t.nextSibling:t.previousSibling)===null;){let i=t.parentElement;if(i===null)return null;t=i}if(t=n,t.nodeType===mo){let i=t.style.display;if(i===""&&!Io(t)||i!==""&&!i.startsWith("inline"))return null}let r=t;for(;(r=e?t.firstChild:t.lastChild)!==null;)t=r;if(t.nodeType===Ke)return t;if(t.nodeName==="BR")return null}}var fN={code:"code",em:"italic",i:"italic",s:"strikethrough",strong:"bold",sub:"subscript",sup:"superscript",u:"underline"};function xo(o){let e=fN[o.nodeName.toLowerCase()];return e==="code"&&o.closest("pre")?{node:null}:e===void 0?{node:null}:{forChild:bl(o.style,e),node:null}}function q(o=""){return ne(new je(o))}function y(o){return o instanceof je}function bl(o,e){let t=o.fontWeight,n=o.textDecoration.split(" "),r=t==="700"||t==="bold",i=n.includes("line-through"),s=o.fontStyle==="italic",l=n.includes("underline"),a=o.verticalAlign,d=o.color,m=o.backgroundColor;return f=>{if(!y(f))return f;r&&!f.hasFormat("bold")&&f.toggleFormat("bold"),i&&!f.hasFormat("strikethrough")&&f.toggleFormat("strikethrough"),s&&!f.hasFormat("italic")&&f.toggleFormat("italic"),l&&!f.hasFormat("underline")&&f.toggleFormat("underline"),a==="sub"&&!f.hasFormat("subscript")&&f.toggleFormat("subscript"),a==="super"&&!f.hasFormat("superscript")&&f.toggleFormat("superscript");let c=f.getStyle();return d&&(c+=`color: ${d};`),m&&m!=="transparent"&&(c+=`background-color: ${m};`),c&&f.setStyle(c),e&&!f.hasFormat(e)&&f.toggleFormat(e),f}}var Fo=class o extends je{static getType(){return"tab"}static clone(e){return new o(e.__key)}afterCloneFrom(e){super.afterCloneFrom(e),this.__text=e.__text}constructor(e){super("	",e),this.__detail=pn}static importDOM(){return null}static importJSON(e){let t=Lt();return t.setFormat(e.format),t.setStyle(e.style),t}exportJSON(){return{...super.exportJSON(),type:"tab",version:1}}setTextContent(e){x(!1,"TabNode does not support setTextContent")}setDetail(e){x(!1,"TabNode does not support setDetail")}setMode(e){x(!1,"TabNode does not support setMode")}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}};function Lt(){return ne(new Fo)}function yl(o){return o instanceof Fo}var Ml=class{constructor(e,t,n){this._selection=null,this.key=e,this.offset=t,this.type=n}is(e){return this.key===e.key&&this.offset===e.offset&&this.type===e.type}isBefore(e){let t=this.getNode(),n=e.getNode(),r=this.offset,i=e.offset;if(E(t)){let s=t.getDescendantByIndex(r);t=s??t}if(E(n)){let s=n.getDescendantByIndex(i);n=s??n}return t===n?r<i:t.isBefore(n)}getNode(){let e=this.key,t=J(e);return t===null&&x(!1,"Point.getNode: node not found"),t}set(e,t,n){let r=this._selection,i=this.key;this.key=e,this.offset=t,this.type=n,st()||(Xe()===i&&se(e),r!==null&&(r.setCachedNodes(null),r.dirty=!0))}};function De(o,e,t){return new Ml(o,e,t)}function Sl(o,e){let t=e.__key,n=o.offset,r="element";if(y(e)){r="text";let i=e.getTextContentSize();n>i&&(n=i)}else if(!E(e)){let i=e.getNextSibling();if(y(i))t=i.__key,n=0,r="text";else{let s=e.getParent();s&&(t=s.__key,n=e.getIndexWithinParent()+1)}}o.set(t,n,r)}function El(o,e){if(E(e)){let t=e.getLastDescendant();E(t)||y(t)?Sl(o,t):Sl(o,e)}else Sl(o,e)}function mN(o,e,t,n){let r=o.getNode(),i=r.getChildAtIndex(o.offset),s=q(),l=oe(r)?I().append(s):s;s.setFormat(t),s.setStyle(n),i===null?r.append(l):i.insertBefore(l),o.is(e)&&e.set(s.__key,0,"text"),o.set(s.__key,0,"text")}function Eo(o,e,t,n){o.key=e,o.offset=t,o.type=n}var bi=class o{constructor(e){this._cachedNodes=null,this._nodes=e,this.dirty=!1}getCachedNodes(){return this._cachedNodes}setCachedNodes(e){this._cachedNodes=e}is(e){if(!Se(e))return!1;let t=this._nodes,n=e._nodes;return t.size===n.size&&Array.from(t).every(r=>n.has(r))}isCollapsed(){return!1}isBackward(){return!1}getStartEndPoints(){return null}add(e){this.dirty=!0,this._nodes.add(e),this._cachedNodes=null}delete(e){this.dirty=!0,this._nodes.delete(e),this._cachedNodes=null}clear(){this.dirty=!0,this._nodes.clear(),this._cachedNodes=null}has(e){return this._nodes.has(e)}clone(){return new o(new Set(this._nodes))}extract(){return this.getNodes()}insertRawText(e){}insertText(){}insertNodes(e){let t=this.getNodes(),n=t.length,r=t[n-1],i;if(y(r))i=r.select();else{let s=r.getIndexWithinParent()+1;i=r.getParentOrThrow().select(s,s)}i.insertNodes(e);for(let s=0;s<n;s++)t[s].remove()}getNodes(){let e=this._cachedNodes;if(e!==null)return e;let t=this._nodes,n=[];for(let r of t){let i=J(r);i!==null&&n.push(i)}return st()||(this._cachedNodes=n),n}getTextContent(){let e=this.getNodes(),t="";for(let n=0;n<e.length;n++)t+=e[n].getTextContent();return t}};function _(o){return o instanceof To}var To=class o{constructor(e,t,n,r){this.anchor=e,this.focus=t,e._selection=this,t._selection=this,this._cachedNodes=null,this.format=n,this.style=r,this.dirty=!1}getCachedNodes(){return this._cachedNodes}setCachedNodes(e){this._cachedNodes=e}is(e){return _(e)?this.anchor.is(e.anchor)&&this.focus.is(e.focus)&&this.format===e.format&&this.style===e.style:!1}isCollapsed(){return this.anchor.is(this.focus)}getNodes(){let e=this._cachedNodes;if(e!==null)return e;let t=this.anchor,n=this.focus,r=t.isBefore(n),i=r?t:n,s=r?n:t,l=i.getNode(),a=s.getNode(),d=i.offset,m=s.offset;if(E(l)){let c=l.getDescendantByIndex(d);l=c??l}if(E(a)){let c=a.getDescendantByIndex(m);c!==null&&c!==l&&a.getChildAtIndex(m)===c&&(c=c.getPreviousSibling()),a=c??a}let f;return l.is(a)?E(l)&&l.getChildrenSize()>0?f=[]:f=[l]:f=l.getNodesBetween(a),st()||(this._cachedNodes=f),f}setTextNodeRange(e,t,n,r){Eo(this.anchor,e.__key,t,"text"),Eo(this.focus,n.__key,r,"text"),this._cachedNodes=null,this.dirty=!0}getTextContent(){let e=this.getNodes();if(e.length===0)return"";let t=e[0],n=e[e.length-1],r=this.anchor,i=this.focus,s=r.isBefore(i),[l,a]=Mr(this),d="",m=!0;for(let f=0;f<e.length;f++){let c=e[f];if(E(c)&&!c.isInline())m||(d+=`
`),c.isEmpty()?m=!1:m=!0;else if(m=!1,y(c)){let u=c.getTextContent();c===t?c===n?(r.type!=="element"||i.type!=="element"||i.offset===r.offset)&&(u=l<a?u.slice(l,a):u.slice(a,l)):u=s?u.slice(l):u.slice(a):c===n&&(u=s?u.slice(0,a):u.slice(0,l)),d+=u}else(B(c)||ve(c))&&(c!==n||!this.isCollapsed())&&(d+=c.getTextContent())}return d}applyDOMRange(e){let t=j(),r=t.getEditorState()._selection,i=Zc(e.startContainer,e.startOffset,e.endContainer,e.endOffset,t,r);if(i===null)return;let[s,l]=i;Eo(this.anchor,s.key,s.offset,s.type),Eo(this.focus,l.key,l.offset,l.type),this._cachedNodes=null}clone(){let e=this.anchor,t=this.focus;return new o(De(e.key,e.offset,e.type),De(t.key,t.offset,t.type),this.format,this.style)}toggleFormat(e){this.format=pr(this.format,e,null),this.dirty=!0}setStyle(e){this.style=e,this.dirty=!0}hasFormat(e){let t=Ve[e];return(this.format&t)!==0}insertRawText(e){let t=e.split(/(\r?\n|\t)/),n=[],r=t.length;for(let i=0;i<r;i++){let s=t[i];s===`
`||s===`\r
`?n.push(ut()):s==="	"?n.push(Lt()):n.push(q(s))}this.insertNodes(n)}insertText(e){let t=this.anchor,n=this.focus,r=this.format,i=this.style,s=t,l=n;!this.isCollapsed()&&n.isBefore(t)&&(s=n,l=t),s.type==="element"&&mN(s,l,r,i);let a=s.offset,d=l.offset,m=this.getNodes(),f=m.length,c=m[0];y(c)||x(!1,"insertText: first node is not a text node");let p=c.getTextContent().length,g=c.getParentOrThrow(),h=f-1,C=m[h];if(f===1&&l.type==="element"&&(d=p,l.set(s.key,d,"text")),this.isCollapsed()&&a===p&&(c.isSegmented()||c.isToken()||!c.canInsertTextAfter()||!g.canInsertTextAfter()&&c.getNextSibling()===null)){let N=c.getNextSibling();if((!y(N)||!N.canInsertTextBefore()||Ue(N))&&(N=q(),N.setFormat(r),N.setStyle(i),g.canInsertTextAfter()?c.insertAfter(N):g.insertAfter(N)),N.select(0,0),c=N,e!==""){this.insertText(e);return}}else if(this.isCollapsed()&&a===0&&(c.isSegmented()||c.isToken()||!c.canInsertTextBefore()||!g.canInsertTextBefore()&&c.getPreviousSibling()===null)){let N=c.getPreviousSibling();if((!y(N)||Ue(N))&&(N=q(),N.setFormat(r),g.canInsertTextBefore()?c.insertBefore(N):g.insertBefore(N)),N.select(),c=N,e!==""){this.insertText(e);return}}else if(c.isSegmented()&&a!==p){let N=q(c.getTextContent());N.setFormat(r),c.replace(N),c=N}else if(!this.isCollapsed()&&e!==""){let N=C.getParent();if(!g.canInsertTextBefore()||!g.canInsertTextAfter()||E(N)&&(!N.canInsertTextBefore()||!N.canInsertTextAfter())){this.insertText(""),Yc(this.anchor,this.focus,null),this.insertText(e);return}}if(f===1){if(c.isToken()){let S=q(e);S.select(),c.replace(S);return}let N=c.getFormat(),L=c.getStyle();if(a===d&&(N!==r||L!==i))if(c.getTextContent()==="")c.setFormat(r),c.setStyle(i);else{let S=q(e);if(S.setFormat(r),S.setStyle(i),S.select(),a===0)c.insertBefore(S,!1);else{let[A]=c.splitText(a);A.insertAfter(S,!1)}S.isComposing()&&this.anchor.type==="text"&&(this.anchor.offset-=e.length);return}else if(yl(c)){let S=q(e);S.setFormat(r),S.setStyle(i),S.select(),c.replace(S);return}let M=d-a;c=c.spliceText(a,M,e,!0),c.getTextContent()===""?c.remove():this.anchor.type==="text"&&(c.isComposing()?this.anchor.offset-=e.length:(this.format=N,this.style=L))}else{let N=new Set([...c.getParentKeys(),...C.getParentKeys()]),L=E(c)?c:c.getParentOrThrow(),M=E(C)?C:C.getParentOrThrow(),S=C;if(!L.is(M)&&M.isInline())do S=M,M=M.getParentOrThrow();while(M.isInline());if(l.type==="text"&&(d!==0||C.getTextContent()==="")||l.type==="element"&&C.getIndexWithinParent()<d)if(y(C)&&!C.isToken()&&d!==C.getTextContentSize()){if(C.isSegmented()){let k=q(C.getTextContent());C.replace(k),C=k}!oe(l.getNode())&&l.type==="text"&&(C=C.spliceText(0,d,"")),N.add(C.__key)}else{let k=C.getParentOrThrow();!k.canBeEmpty()&&k.getChildrenSize()===1?k.remove():C.remove()}else N.add(C.__key);let A=M.getChildren(),O=new Set(m),R=L.is(M),P=L.isInline()&&c.getNextSibling()===null?L:c;for(let k=A.length-1;k>=0;k--){let W=A[k];if(W.is(c)||E(W)&&W.isParentOf(c))break;W.isAttached()&&(!O.has(W)||W.is(S)?R||P.insertAfter(W,!1):W.remove())}if(!R){let k=M,W=null;for(;k!==null;){let ie=k.getChildren(),an=ie.length;(an===0||ie[an-1].is(W))&&(N.delete(k.__key),W=k),k=k.getParent()}}if(!c.isToken())c=c.spliceText(a,p-a,e,!0),c.getTextContent()===""?c.remove():c.isComposing()&&this.anchor.type==="text"&&(this.anchor.offset-=e.length);else if(a===p)c.select();else{let k=q(e);k.select(),c.replace(k)}for(let k=1;k<f;k++){let W=m[k],ie=W.__key;N.has(ie)||W.remove()}}}removeText(){this.insertText("")}formatText(e){if(this.isCollapsed()){this.toggleFormat(e),se(null);return}let t=this.getNodes(),n=[];for(let N of t)y(N)&&n.push(N);let r=n.length;if(r===0){this.toggleFormat(e),se(null);return}let i=this.anchor,s=this.focus,l=this.isBackward(),a=l?s:i,d=l?i:s,m=0,f=n[0],c=a.type==="element"?0:a.offset;if(a.type==="text"&&c===f.getTextContentSize()&&(m=1,f=n[1],c=0),f==null)return;let u=f.getFormatFlags(e,null),p=r-1,g=n[p],h=d.type==="text"?d.offset:g.getTextContentSize();if(f.is(g)){if(c===h)return;if(Ue(f)||c===0&&h===f.getTextContentSize())f.setFormat(u);else{let N=f.splitText(c,h),L=c===0?N[0]:N[1];L.setFormat(u),a.type==="text"&&a.set(L.__key,0,"text"),d.type==="text"&&d.set(L.__key,h-c,"text")}this.format=u;return}c!==0&&!Ue(f)&&([,f]=f.splitText(c),c=0),f.setFormat(u);let C=g.getFormatFlags(e,u);h>0&&(h!==g.getTextContentSize()&&!Ue(g)&&([g]=g.splitText(h)),g.setFormat(C));for(let N=m+1;N<p;N++){let L=n[N],M=L.getFormatFlags(e,C);L.setFormat(M)}a.type==="text"&&a.set(f.__key,c,"text"),d.type==="text"&&d.set(g.__key,h,"text"),this.format=u|C}insertNodes(e){if(e.length===0)return;if(this.anchor.key==="root"){this.insertParagraph();let h=T();return x(_(h),"Expected RangeSelection after insertParagraph"),h.insertNodes(e)}let t=this.isBackward()?this.focus:this.anchor,n=mi(t.getNode(),$o),r=e[e.length-1];if("__language"in n&&E(n)){if("__language"in e[0])this.insertText(e[0].getTextContent());else{let h=Ll(this);n.splice(h,0,e),r.selectEnd()}return}let i=h=>(E(h)||B(h))&&!h.isInline();if(!e.some(i)){x(E(n),"Expected 'firstBlock' to be an ElementNode");let h=Ll(this);n.splice(h,0,e),r.selectEnd();return}let s=EN(e),l=s.getLastDescendant(),a=s.getChildren(),d=h=>E(h)&&$o(h)&&!h.isEmpty()&&E(n)&&(!n.isEmpty()||n.canMergeWhenEmpty()),f=!E(n)||!n.isEmpty()?this.insertParagraph():null,c=a[a.length-1],u=a[0];d(u)&&(x(E(n),"Expected 'firstBlock' to be an ElementNode"),n.append(...u.getChildren()),u=a[1]),u&&Ic(n,u);let p=mi(l,$o);f&&E(p)&&(f.canMergeWhenEmpty()||$o(c))&&(p.append(...f.getChildren()),f.remove()),E(n)&&n.isEmpty()&&n.remove(),l.selectEnd();let g=E(n)?n.getLastChild():null;ve(g)&&p!==n&&g.remove()}insertParagraph(){if(this.anchor.key==="root"){let s=I();return F().splice(this.anchor.offset,0,[s]),s.select(),s}let e=Ll(this),t=mi(this.anchor.getNode(),$o);x(E(t),"Expected ancestor to be an ElementNode");let n=t.getChildAtIndex(e),r=n?[n,...n.getNextSiblings()]:[],i=t.insertNewAfter(this,!1);return i?(i.append(...r),i.selectStart(),i):null}insertLineBreak(e){let t=ut();if(this.insertNodes([t]),e){let n=t.getParentOrThrow(),r=t.getIndexWithinParent();n.select(r,r)}}extract(){let e=this.getNodes(),t=e.length,n=t-1,r=this.anchor,i=this.focus,s=e[0],l=e[n],[a,d]=Mr(this);if(t===0)return[];if(t===1){if(y(s)&&!this.isCollapsed()){let f=a>d?d:a,c=a>d?a:d,u=s.splitText(f,c),p=f===0?u[0]:u[1];return p!=null?[p]:[]}return[s]}let m=r.isBefore(i);if(y(s)){let f=m?a:d;f===s.getTextContentSize()?e.shift():f!==0&&([,s]=s.splitText(f),e[0]=s)}if(y(l)){let c=l.getTextContent().length,u=m?d:a;u===0?e.pop():u!==c&&([l]=l.splitText(u),e[n]=l)}return e}modify(e,t,n){let r=this.focus,i=this.anchor,s=e==="move",l=Zt(r,t);if(B(l)&&!l.isIsolated()){if(s&&l.isKeyboardSelectable()){let u=Ho();u.add(l.__key),Y(u);return}let c=t?l.getPreviousSibling():l.getNextSibling();if(y(c)){let u=c.__key,p=t?c.getTextContent().length:0;r.set(u,p,"text"),s&&i.set(u,p,"text");return}else{let u=l.getParentOrThrow(),p,g;E(c)?(g=c.__key,p=t?c.getChildrenSize():0):(p=l.getIndexWithinParent(),g=u.__key,t||p++),r.set(g,p,"element"),s&&i.set(g,p,"element");return}}let a=j(),d=be(a._window);if(!d)return;let m=a._blockCursorElement,f=a._rootElement;if(f!==null&&m!==null&&E(l)&&!l.isInline()&&!l.canBeEmpty()&&Er(m,a,f),gN(d,e,t?"backward":"forward",n),d.rangeCount>0){let c=d.getRangeAt(0),u=this.anchor.getNode(),p=oe(u)?u:ol(u);if(this.applyDOMRange(c),this.dirty=!0,!s){let g=this.getNodes(),h=[],C=!1;for(let N=0;N<g.length;N++){let L=g[N];En(L,p)?h.push(L):C=!0}if(C&&h.length>0)if(t){let N=h[0];E(N)?N.selectStart():N.getParentOrThrow().selectStart()}else{let N=h[h.length-1];E(N)?N.selectEnd():N.getParentOrThrow().selectEnd()}(d.anchorNode!==c.startContainer||d.anchorOffset!==c.startOffset)&&pN(this)}}}forwardDeletion(e,t,n){if(!n&&(e.type==="element"&&E(t)&&e.offset===t.getChildrenSize()||e.type==="text"&&e.offset===t.getTextContentSize())){let r=t.getParent(),i=t.getNextSibling()||(r===null?null:r.getNextSibling());if(E(i)&&i.isShadowRoot())return!0}return!1}deleteCharacter(e){let t=this.isCollapsed();if(this.isCollapsed()){let n=this.anchor,r=n.getNode();if(this.forwardDeletion(n,r,e))return;let i=this.focus,s=Zt(i,e);if(B(s)&&!s.isIsolated()){if(s.isKeyboardSelectable()&&E(r)&&r.getChildrenSize()===0){r.remove();let l=Ho();l.add(s.__key),Y(l)}else s.remove(),j().dispatchCommand(we,void 0);return}else if(!e&&E(s)&&E(r)&&r.isEmpty()){r.remove(),s.selectStart();return}if(this.modify("extend",e,"character"),this.isCollapsed()){if(e&&n.offset===0&&(n.type==="element"?n.getNode():n.getNode().getParentOrThrow()).collapseAtStart(this))return}else{let l=i.type==="text"?i.getNode():null;if(r=n.type==="text"?n.getNode():null,l!==null&&l.isSegmented()){let a=i.offset,d=l.getTextContentSize();if(l.is(r)||e&&a!==d||!e&&a!==0){Uc(l,e,a);return}}else if(r!==null&&r.isSegmented()){let a=n.offset,d=r.getTextContentSize();if(r.is(l)||e&&a!==0||!e&&a!==d){Uc(r,e,a);return}}hN(this,e)}}if(this.removeText(),e&&!t&&this.isCollapsed()&&this.anchor.type==="element"&&this.anchor.offset===0){let n=this.anchor.getNode();n.isEmpty()&&oe(n.getParent())&&n.getIndexWithinParent()===0&&n.collapseAtStart(this)}}deleteLine(e){if(this.isCollapsed()){let t=this.anchor.type==="element";if(t&&this.insertText(" "),this.modify("extend",e,"lineboundary"),(e?this.focus:this.anchor).offset===0&&this.modify("extend",e,"character"),t){let r=e?this.anchor:this.focus;r.set(r.key,r.offset+1,r.type)}}this.removeText()}deleteWord(e){if(this.isCollapsed()){let t=this.anchor,n=t.getNode();if(this.forwardDeletion(t,n,e))return;this.modify("extend",e,"word")}this.removeText()}isBackward(){return this.focus.isBefore(this.anchor)}getStartEndPoints(){return[this.anchor,this.focus]}};function Se(o){return o instanceof bi}function Kc(o){let e=o.offset;if(o.type==="text")return e;let t=o.getNode();return e===t.getChildrenSize()?t.getTextContent().length:0}function Mr(o){let e=o.getStartEndPoints();if(e===null)return[0,0];let[t,n]=e;return t.type==="element"&&n.type==="element"&&t.key===n.key&&t.offset===n.offset?[0,0]:[Kc(t),Kc(n)]}function pN(o){let e=o.focus,t=o.anchor,n=t.key,r=t.offset,i=t.type;Eo(t,e.key,e.offset,e.type),Eo(e,n,r,i),o._cachedNodes=null}function gN(o,e,t,n){o.modify(e,t,n)}function hN(o,e){let t=o.anchor,n=o.focus,r=t.getNode(),i=n.getNode();if(r===i&&t.type==="text"&&n.type==="text"){let s=t.offset,l=n.offset,a=s<l,d=a?s:l,m=a?l:s,f=m-1;if(d!==f){let c=r.getTextContent().slice(d,m);li(c)||(e?n.offset=f:t.offset=f)}}}function Uc(o,e,t){let n=o,i=n.getTextContent().split(/(?=\s)/g),s=i.length,l=0,a=0;for(let m=0;m<s;m++){let f=i[m],c=m===s-1;if(a=l,l+=f.length,e&&l===t||l>t||c){i.splice(m,1),c&&(a=void 0);break}}let d=i.join("").trim();d===""?n.remove():(n.setTextContent(d),n.select(a,a))}function NN(o,e,t){let n=o.getParent();return t===null||n===null||!n.canBeEmpty()||n!==t.getNode()}function zc(o,e,t,n){let r=e,i;if(o.nodeType===mo){let s=!1,l=o.childNodes,a=l.length,d=n._blockCursorElement;r===a&&(s=!0,r=a-1);let m=l[r],f=!1;if(m===d)m=l[r+1],f=!0;else if(d!==null){let c=d.parentNode;if(o===c){let u=Array.prototype.indexOf.call(c.children,d);e>u&&r--}}if(i=ko(m),y(i))r=js(i,s);else{let c=ko(o);if(c===null)return null;if(E(c)){r=Math.min(c.getChildrenSize(),r);let u=c.getChildAtIndex(r);if(E(u)&&NN(u,r,t)){let p=s?u.getLastDescendant():u.getFirstDescendant();p===null?c=u:(u=p,c=E(u)?u:u.getParentOrThrow()),r=0}y(u)?(i=u,c=null,r=js(u,s)):u!==c&&s&&!f&&r++}else{let u=c.getIndexWithinParent();e===0&&B(c)&&ko(o)===c?r=u:r=u+1,c=c.getParentOrThrow()}if(E(c))return De(c.__key,r,"element")}}else i=ko(o);return y(i)?De(i.__key,r,"text"):null}function Wc(o,e,t){let n=o.offset,r=o.getNode();if(n===0){let i=r.getPreviousSibling(),s=r.getParent();if(!e)E(i)&&!t&&i.isInline()?(o.key=i.__key,o.offset=i.getChildrenSize(),o.type="element"):y(i)&&(o.key=i.__key,o.offset=i.getTextContent().length);else if((t||!e)&&i===null&&E(s)&&s.isInline()){let l=s.getPreviousSibling();y(l)&&(o.key=l.__key,o.offset=l.getTextContent().length)}}else if(n===r.getTextContent().length){let i=r.getNextSibling(),s=r.getParent();if(e&&E(i)&&i.isInline())o.key=i.__key,o.offset=0,o.type="element";else if((t||e)&&i===null&&E(s)&&s.isInline()&&!s.canInsertTextAfter()){let l=s.getNextSibling();y(l)&&(o.key=l.__key,o.offset=0)}}}function Yc(o,e,t){if(o.type==="text"&&e.type==="text"){let n=o.isBefore(e),r=o.is(e);Wc(o,n,r),Wc(e,!n,r),r&&(e.key=o.key,e.offset=o.offset,e.type=o.type);let i=j();if(i.isComposing()&&i._compositionKey!==o.key&&_(t)){let s=t.anchor,l=t.focus;Eo(o,s.key,s.offset,s.type),Eo(e,l.key,l.offset,l.type)}}}function Zc(o,e,t,n,r,i){if(o===null||t===null||!qt(r,o,t))return null;let s=zc(o,e,_(i)?i.anchor:null,r);if(s===null)return null;let l=zc(t,n,_(i)?i.focus:null,r);if(l===null)return null;if(s.type==="element"&&l.type==="element"){let a=ko(o),d=ko(t);if(B(a)&&B(d))return null}return Yc(s,l,i),[s,l]}function Ko(o){return E(o)&&!o.isInline()}function _i(o,e,t,n,r,i){let s=Ge(),l=new To(De(o,e,r),De(t,n,i),0,"");return l.dirty=!0,s._selection=l,l}function Uo(){let o=De("root",0,"element"),e=De("root",0,"element");return new To(o,e,0,"")}function Ho(){return new bi(new Set)}function Vc(o){let t=o.getEditorState()._selection,n=be(o._window);return _(t)||t==null?Lr(t,n,o,null):t.clone()}function wl(o,e){return Lr(null,o,e,null)}function Lr(o,e,t,n){let r=t._window;if(r===null)return null;let i=n||r.event,s=i?i.type:void 0,l=s==="selectionchange",a=!hd()&&(l||s==="beforeinput"||s==="compositionstart"||s==="compositionend"||s==="click"&&i&&i.detail===3||s==="drop"||s===void 0),d,m,f,c;if(!_(o)||a){if(e===null)return null;if(d=e.anchorNode,m=e.focusNode,f=e.anchorOffset,c=e.focusOffset,l&&_(o)&&!qt(t,d,m))return o.clone()}else return o.clone();let u=Zc(d,f,m,c,t,o);if(u===null)return null;let[p,g]=u;return new To(p,g,_(o)?o.format:0,_(o)?o.style:"")}function T(){return Ge()._selection}function ze(){return j()._editorState._selection}function Mn(o,e,t,n=1){let r=o.anchor,i=o.focus,s=r.getNode(),l=i.getNode();if(!e.is(s)&&!e.is(l))return;let a=e.__key;if(o.isCollapsed()){let d=r.offset;if(t<=d&&n>0||t<d&&n<0){let m=Math.max(0,d+n);r.set(a,m,"element"),i.set(a,m,"element"),qc(o)}}else{let d=o.isBackward(),m=d?i:r,f=m.getNode(),c=d?r:i,u=c.getNode();if(e.is(f)){let p=m.offset;(t<=p&&n>0||t<p&&n<0)&&m.set(a,Math.max(0,p+n),"element")}if(e.is(u)){let p=c.offset;(t<=p&&n>0||t<p&&n<0)&&c.set(a,Math.max(0,p+n),"element")}}qc(o)}function qc(o){let e=o.anchor,t=e.offset,n=o.focus,r=n.offset,i=e.getNode(),s=n.getNode();if(o.isCollapsed()){if(!E(i))return;let l=i.getChildrenSize(),a=t>=l,d=a?i.getChildAtIndex(l-1):i.getChildAtIndex(t);if(y(d)){let m=0;a&&(m=d.getTextContentSize()),e.set(d.__key,m,"text"),n.set(d.__key,m,"text")}return}if(E(i)){let l=i.getChildrenSize(),a=t>=l,d=a?i.getChildAtIndex(l-1):i.getChildAtIndex(t);if(y(d)){let m=0;a&&(m=d.getTextContentSize()),e.set(d.__key,m,"text")}}if(E(s)){let l=s.getChildrenSize(),a=r>=l,d=a?s.getChildAtIndex(l-1):s.getChildAtIndex(r);if(y(d)){let m=0;a&&(m=d.getTextContentSize()),n.set(d.__key,m,"text")}}}function Xc(o,e){let n=e.getEditorState()._selection,r=o._selection;if(_(r)){let i=r.anchor,s=r.focus,l;if(i.type==="text"&&(l=i.getNode(),l.selectionTransform(n,r)),s.type==="text"){let a=s.getNode();l!==a&&a.selectionTransform(n,r)}}}function wn(o,e,t,n,r){let i=null,s=0,l=null;n!==null?(i=n.__key,y(n)?(s=n.getTextContentSize(),l="text"):E(n)&&(s=n.getChildrenSize(),l="element")):r!==null&&(i=r.__key,y(r)?l="text":E(r)&&(l="element")),i!==null&&l!==null?o.set(i,s,l):(s=e.getIndexWithinParent(),s===-1&&(s=t.getChildrenSize()),o.set(t.__key,s,"element"))}function _l(o,e,t,n,r){o.type==="text"?(o.key=t,e||(o.offset+=r)):o.offset>n.getIndexWithinParent()&&(o.offset-=1)}function Gc(o,e,t,n,r,i,s){let l=n.anchorNode,a=n.focusNode,d=n.anchorOffset,m=n.focusOffset,f=document.activeElement;if(r.has("collaboration")&&f!==i||f!==null&&Tn(f))return;if(!_(e)){o!==null&&qt(t,l,a)&&n.removeAllRanges();return}let c=e.anchor,u=e.focus,p=c.key,g=u.key,h=bn(t,p),C=bn(t,g),N=c.offset,L=u.offset,M=e.format,S=e.style,A=e.isCollapsed(),O=h,R=C,P=!1;if(c.type==="text"){O=_n(h);let k=c.getNode();P=k.getFormat()!==M||k.getStyle()!==S}else _(o)&&o.anchor.type==="text"&&(P=!0);if(u.type==="text"&&(R=_n(C)),!(O===null||R===null)&&(A&&(o===null||P||_(o)&&(o.format!==M||o.style!==S))&&kc(M,S,N,p,performance.now()),!(d===N&&m===L&&l===O&&a===R&&!(n.type==="Range"&&A)&&((f===null||!i.contains(f))&&i.focus({preventScroll:!0}),c.type!=="element")))){try{n.setBaseAndExtent(O,N,R,L)}catch(k){__DEV__&&console.warn(k)}if(!r.has("skip-scroll-into-view")&&e.isCollapsed()&&i!==null&&i===document.activeElement){let k=e instanceof To&&e.anchor.type==="element"?O.childNodes[N]||null:n.rangeCount>0?n.getRangeAt(0):null;if(k!==null){let W;if(k instanceof Text){let ie=document.createRange();ie.selectNode(k),W=ie.getBoundingClientRect()}else W=k.getBoundingClientRect();sc(t,W,i)}}Rc()}}function Oe(o){let e=T()||ze();e===null&&(e=F().selectEnd()),e.insertNodes(o)}function Ll(o){let e=o;o.isCollapsed()||e.removeText();let t=T();_(t)&&(e=t),x(_(e),"Unexpected dirty selection to be null");let n=e.anchor,r=n.getNode(),i=n.offset;for(;!$o(r);)[r,i]=xN(r,i);return i}function xN(o,e){let t=o.getParent();if(!t){let r=I();return F().append(r),r.select(),[F(),0]}if(y(o)){let r=o.splitText(e);if(r.length===0)return[t,o.getIndexWithinParent()];let i=e===0?0:1,s=r[0].getIndexWithinParent()+i;return[t,s]}if(!E(o)||e===0)return[t,o.getIndexWithinParent()];let n=o.getChildAtIndex(e);if(n){let r=new To(De(o.__key,e,"element"),De(o.__key,e,"element"),0,""),i=o.insertNewAfter(r);i&&i.append(n,...n.getNextSiblings())}return[t,o.getIndexWithinParent()+1]}function EN(o){let e=I(),t=null;for(let n=0;n<o.length;n++){let r=o[n],i=ve(r);if(i||B(r)&&r.isInline()||E(r)&&r.isInline()||y(r)||r.isParentRequired()){if(t===null&&(t=r.createParentElementNode(),e.append(t),i))continue;t!==null&&t.append(r)}else e.append(r),t=null}return e}var ue=null,ge=null,Ae=!1,vl=!1,yi=0,jc={characterData:!0,childList:!0,subtree:!0};function st(){return Ae||ue!==null&&ue._readOnly}function de(){Ae&&x(!1,"Cannot use method in read-only mode.")}function rl(){yi>99&&x(!1,"One or more transforms are endlessly triggering additional transforms. May have encountered infinite recursion caused by transforms that have their preconditions too lose and/or conflict with each other.")}function Ge(){return ue===null&&x(!1,"Unable to find an active editor state. State helpers or node methods can only be used synchronously during the callback of editor.update(), editor.read(), or editorState.read().%s",tu()),ue}function j(){return ge===null&&x(!1,"Unable to find an active editor. This method can only be used synchronously during the callback of editor.update() or editor.read().%s",tu()),ge}function tu(){let o=0,e=new Set,t=ho.version;if(typeof window<"u")for(let r of document.querySelectorAll("[contenteditable]")){let i=Ro(r);if(Cn(i))o++;else if(i){let s=String(i.constructor.version||"<0.17.1");s===t&&(s+=" (separately built, likely a bundler configuration issue)"),e.add(s)}}let n=` Detected on the page: ${o} compatible editor(s) with version ${t}`;return e.size&&(n+=` and incompatible editors with versions ${Array.from(e).join(", ")}`),n}function ou(){return ge}function uc(){return ue}function Jc(o,e,t){let n=e.__type,r=bd(o,n),i=t.get(n);i===void 0&&(i=Array.from(r.transforms),t.set(n,i));let s=i.length;for(let l=0;l<s&&(i[l](e),!!e.isAttached());l++);}function Qc(o,e){return o!==void 0&&o.__key!==e&&o.isAttached()}function TN(o,e){let t=e._dirtyLeaves,n=o._nodeMap;for(let r of t){let i=n.get(r);y(i)&&i.isAttached()&&i.isSimpleText()&&!i.isUnmergeable()&&Vs(i)}}function CN(o,e){let t=e._dirtyLeaves,n=e._dirtyElements,r=o._nodeMap,i=Xe(),s=new Map,l=t,a=l.size,d=n,m=d.size;for(;a>0||m>0;){if(a>0){e._dirtyLeaves=new Set;for(let f of l){let c=r.get(f);y(c)&&c.isAttached()&&c.isSimpleText()&&!c.isUnmergeable()&&Vs(c),c!==void 0&&Qc(c,i)&&Jc(e,c,s),t.add(f)}if(l=e._dirtyLeaves,a=l.size,a>0){yi++;continue}}e._dirtyLeaves=new Set,e._dirtyElements=new Map;for(let f of d){let c=f[0],u=f[1];if(c!=="root"&&!u)continue;let p=r.get(c);p!==void 0&&Qc(p,i)&&Jc(e,p,s),n.set(c,u)}l=e._dirtyLeaves,a=l.size,d=e._dirtyElements,m=d.size,yi++}e._dirtyLeaves=t,e._dirtyElements=n}function Dl(o){return Ol(o,j()._nodes)}function Ol(o,e){let t=o.type,n=e.get(t);n===void 0&&x(!1,'parseEditorState: type "%s" + not found',t);let r=n.klass;o.type!==r.getType()&&x(!1,"LexicalNode: Node %s does not implement .importJSON().",r.name);let i=r.importJSON(o),s=o.children;if(E(i)&&Array.isArray(s))for(let l=0;l<s.length;l++){let a=s[l],d=Ol(a,e);i.append(d)}return i}function nu(o,e,t){let n=wr(),r=ue,i=Ae,s=ge,l=e._dirtyElements,a=e._dirtyLeaves,d=e._cloneNotNeeded,m=e._dirtyType;e._dirtyElements=new Map,e._dirtyLeaves=new Set,e._cloneNotNeeded=new Set,e._dirtyType=0,ue=n,Ae=!1,ge=e;try{let f=e._nodes,c=o.root;Ol(c,f),t&&t(),n._readOnly=!0,__DEV__&&ru(n)}catch(f){f instanceof Error&&e._onError(f)}finally{e._dirtyElements=l,e._dirtyLeaves=a,e._cloneNotNeeded=d,e._dirtyType=m,ue=r,Ae=i,ge=s}return n}function Al(o,e,t){let n=ue,r=Ae,i=ge;ue=e,Ae=!0,ge=o;try{return t()}finally{ue=n,Ae=r,ge=i}}function ru(o){let e=o._nodeMap;e.set=()=>{throw new Error("Cannot call set() on a frozen Lexical node map")},e.clear=()=>{throw new Error("Cannot call clear() on a frozen Lexical node map")},e.delete=()=>{throw new Error("Cannot call delete() on a frozen Lexical node map")}}function Mt(o,e){let t=o._pendingEditorState,n=o._rootElement,r=o._headless||n===null;if(t===null)return;let i=o._editorState,s=i._selection,l=t._selection,a=o._dirtyType!==bt,d=ue,m=Ae,f=ge,c=o._updating,u=o._observer,p=null;if(o._pendingEditorState=null,o._editorState=t,!r&&a&&u!==null){ge=o,ue=t,Ae=!1,o._updating=!0;try{let O=o._dirtyType,R=o._dirtyElements,P=o._dirtyLeaves;u.disconnect(),p=Ec(i,t,o,O,R,P)}catch(O){if(O instanceof Error&&o._onError(O),!vl)Rl(o,null,n,t),ni(o),o._dirtyType=Wt,vl=!0,Mt(o,i),vl=!1;else throw O;return}finally{u.observe(n,jc),o._updating=c,ue=d,Ae=m,ge=f}}t._readOnly||(t._readOnly=!0,__DEV__&&(ru(t),_(l)&&(Object.freeze(l.anchor),Object.freeze(l.focus)),Object.freeze(l)));let g=o._dirtyLeaves,h=o._dirtyElements,C=o._normalizedNodes,N=o._updateTags,L=o._deferred,M=t._nodeMap.size;a&&(o._dirtyType=bt,o._cloneNotNeeded.clear(),o._dirtyLeaves=new Set,o._dirtyElements=new Map,o._normalizedNodes=new Set,o._updateTags=new Set),fc(o,t);let S=r?null:be(o._window);if(o._editable&&S!==null&&(a||l===null||l.dirty)){ge=o,ue=t;try{if(u!==null&&u.disconnect(),a||l===null||l.dirty){let O=o._blockCursorElement;O!==null&&Er(O,o,n),Gc(s,l,o,S,N,n,M)}dc(o,n,l),u!==null&&u.observe(n,jc)}finally{ge=f,ue=d}}p!==null&&bN(o,p,N,g,i),!_(l)&&l!==null&&(s===null||!s.is(l))&&o.dispatchCommand(we,void 0);let A=o._pendingDecorators;A!==null&&(o._decorators=A,o._pendingDecorators=null,vn("decorator",o,!0,A)),_N(o,e||i,t),vn("update",o,!0,{dirtyElements:h,dirtyLeaves:g,editorState:t,normalizedNodes:C,prevEditorState:e||i,tags:N}),SN(o,L),yN(o)}function _N(o,e,t){let n=Gs(e),r=Gs(t);n!==r&&vn("textcontent",o,!0,r)}function bN(o,e,t,n,r){let i=Array.from(o._listeners.mutation),s=i.length;for(let l=0;l<s;l++){let[a,d]=i[l],m=e.get(d);m!==void 0&&a(m,{dirtyLeaves:n,prevEditorState:r,updateTags:t})}}function vn(o,e,t,...n){let r=e._updating;e._updating=t;try{let i=Array.from(e._listeners[o]);for(let s=0;s<i.length;s++)i[s].apply(null,n)}finally{e._updating=r}}function il(o,e,t){if(o._updating===!1||ge!==o){let r=!1;return o.update(()=>{r=il(o,e,t)}),r}let n=hr(o);for(let r=4;r>=0;r--)for(let i=0;i<n.length;i++){let a=n[i]._commands.get(e);if(a!==void 0){let d=a[r];if(d!==void 0){let m=Array.from(d),f=m.length;for(let c=0;c<f;c++)if(m[c](t,o)===!0)return!0}}}return!1}function yN(o){let e=o._updates;if(e.length!==0){let t=e.shift();if(t){let[n,r]=t;iu(o,n,r)}}}function SN(o,e){if(o._deferred=[],e.length!==0){let t=o._updating;o._updating=!0;try{for(let n=0;n<e.length;n++)e[n]()}finally{o._updating=t}}}function eu(o,e){let t=o._updates,n=e||!1;for(;t.length!==0;){let r=t.shift();if(r){let[i,s]=r,l,a;if(s!==void 0){if(l=s.onUpdate,a=s.tag,s.skipTransforms&&(n=!0),s.discrete){let d=o._pendingEditorState;x(d!==null,"Unexpected empty pending editor state on discrete nested update"),d._flushSync=!0}l&&o._deferred.push(l),a&&o._updateTags.add(a)}i()}}return n}function iu(o,e,t){let n=o._updateTags,r,i,s=!1,l=!1;t!==void 0&&(r=t.onUpdate,i=t.tag,i!=null&&n.add(i),s=t.skipTransforms||!1,l=t.discrete||!1),r&&o._deferred.push(r);let a=o._editorState,d=o._pendingEditorState,m=!1;(d===null||d._readOnly)&&(d=o._pendingEditorState=lu(d||a),m=!0),d._flushSync=l;let f=ue,c=Ae,u=ge,p=o._updating;ue=d,Ae=!1,o._updating=!0,ge=o;try{m&&(o._headless?a._selection!==null&&(d._selection=a._selection.clone()):d._selection=Vc(o));let h=o._compositionKey;e(),s=eu(o,s),Xc(d,o),o._dirtyType!==bt&&(s?TN(d,o):CN(d,o),eu(o),pc(a,d,o._dirtyLeaves,o._dirtyElements));let C=o._compositionKey;h!==C&&(d._flushSync=!0);let N=d._selection;if(_(N)){let L=d._nodeMap,M=N.anchor.key,S=N.focus.key;(L.get(M)===void 0||L.get(S)===void 0)&&x(!1,"updateEditor: selection has been lost because the previously selected nodes have been removed and selection wasn't moved to another node. Ensure selection changes after removing/replacing a selected node.")}else Se(N)&&N._nodes.size===0&&(d._selection=null)}catch(h){h instanceof Error&&o._onError(h),o._pendingEditorState=a,o._dirtyType=Wt,o._cloneNotNeeded.clear(),o._dirtyLeaves=new Set,o._dirtyElements.clear(),Mt(o);return}finally{ue=f,Ae=c,ge=u,o._updating=p,yi=0}o._dirtyType!==bt||su(d,o)?d._flushSync?(d._flushSync=!1,Mt(o)):m&&yd(()=>{Mt(o)}):(d._flushSync=!1,m&&(n.clear(),o._deferred=[],o._pendingEditorState=null))}function xe(o,e,t){o._updating?o._updates.push([e,t]):iu(o,e,t)}var Z=class extends St{constructor(e){super(e),this.__first=null,this.__last=null,this.__size=0,this.__style="",this.__dir=null}afterCloneFrom(e){super.afterCloneFrom(e),this.__first=e.__first,this.__last=e.__last,this.__size=e.__size,this.__style=e.__style,this.__dir=e.__dir}getStyle(){return this.getLatest().__style}getChildren(){let e=[],t=this.getFirstChild();for(;t!==null;)e.push(t),t=t.getNextSibling();return e}getChildrenKeys(){let e=[],t=this.getFirstChild();for(;t!==null;)e.push(t.__key),t=t.getNextSibling();return e}getChildrenSize(){return this.getLatest().__size}isEmpty(){return this.getChildrenSize()===0}isDirty(){let t=j()._dirtyElements;return t!==null&&t.has(this.__key)}isLastChild(){let e=this.getLatest(),t=this.getParentOrThrow().getLastChild();return t!==null&&t.is(e)}getAllTextNodes(){let e=[],t=this.getFirstChild();for(;t!==null;){if(y(t)&&e.push(t),E(t)){let n=t.getAllTextNodes();e.push(...n)}t=t.getNextSibling()}return e}getFirstDescendant(){let e=this.getFirstChild();for(;E(e);){let t=e.getFirstChild();if(t===null)break;e=t}return e}getLastDescendant(){let e=this.getLastChild();for(;E(e);){let t=e.getLastChild();if(t===null)break;e=t}return e}getDescendantByIndex(e){let t=this.getChildren(),n=t.length;if(e>=n){let i=t[n-1];return E(i)&&i.getLastDescendant()||i||null}let r=t[e];return E(r)&&r.getFirstDescendant()||r||null}getFirstChild(){let t=this.getLatest().__first;return t===null?null:J(t)}getFirstChildOrThrow(){let e=this.getFirstChild();return e===null&&x(!1,"Expected node %s to have a first child.",this.__key),e}getLastChild(){let t=this.getLatest().__last;return t===null?null:J(t)}getLastChildOrThrow(){let e=this.getLastChild();return e===null&&x(!1,"Expected node %s to have a last child.",this.__key),e}getChildAtIndex(e){let t=this.getChildrenSize(),n,r;if(e<t/2){for(n=this.getFirstChild(),r=0;n!==null&&r<=e;){if(r===e)return n;n=n.getNextSibling(),r++}return null}for(n=this.getLastChild(),r=t-1;n!==null&&r>=e;){if(r===e)return n;n=n.getPreviousSibling(),r--}return null}getTextContent(){let e="",t=this.getChildren(),n=t.length;for(let r=0;r<n;r++){let i=t[r];e+=i.getTextContent(),E(i)&&r!==n-1&&!i.isInline()&&(e+=Ze)}return e}getTextContentSize(){let e=0,t=this.getChildren(),n=t.length;for(let r=0;r<n;r++){let i=t[r];e+=i.getTextContentSize(),E(i)&&r!==n-1&&!i.isInline()&&(e+=Ze.length)}return e}getDirection(){return this.getLatest().__dir}select(e,t){de();let n=T(),r=e,i=t,s=this.getChildrenSize();if(!this.canBeEmpty()){if(e===0&&t===0){let a=this.getFirstChild();if(y(a)||E(a))return a.select(0,0)}else if((e===void 0||e===s)&&(t===void 0||t===s)){let a=this.getLastChild();if(y(a)||E(a))return a.select()}}r===void 0&&(r=s),i===void 0&&(i=s);let l=this.__key;if(_(n))n.anchor.set(l,r,"element"),n.focus.set(l,i,"element"),n.dirty=!0;else return _i(l,r,l,i,"element","element");return n}selectStart(){let e=this.getFirstDescendant();return e?e.selectStart():this.select()}selectEnd(){let e=this.getLastDescendant();return e?e.selectEnd():this.select()}clear(){let e=this.getWritable();return this.getChildren().forEach(n=>n.remove()),e}append(...e){return this.splice(this.getChildrenSize(),0,e)}setDirection(e){let t=this.getWritable();return t.__dir=e,t}setStyle(e){let t=this.getWritable();return t.__style=e||"",this}splice(e,t,n){let r=n.length,i=this.getChildrenSize(),s=this.getWritable(),l=s.__key,a=[],d=[],m=this.getChildAtIndex(e+t),f=null,c=i-t+r;if(e!==0)if(e===i)f=this.getLastChild();else{let p=this.getChildAtIndex(e);p!==null&&(f=p.getPreviousSibling())}if(t>0){let p=f===null?this.getFirstChild():f.getNextSibling();for(let g=0;g<t;g++){p===null&&x(!1,"splice: sibling not found");let h=p.getNextSibling(),C=p.__key,N=p.getWritable();Yt(N),d.push(C),p=h}}let u=f;for(let p=0;p<r;p++){let g=n[p];u!==null&&g.is(u)&&(f=u=u.getPreviousSibling());let h=g.getWritable();h.__parent===l&&c--,Yt(h);let C=g.__key;if(u===null)s.__first=C,h.__prev=null;else{let N=u.getWritable();N.__next=C,h.__prev=N.__key}g.__key===l&&x(!1,"append: attempting to append self"),h.__parent=l,a.push(C),u=g}if(e+t===i){if(u!==null){let p=u.getWritable();p.__next=null,s.__last=u.__key}}else if(m!==null){let p=m.getWritable();if(u!==null){let g=u.getWritable();p.__prev=u.__key,g.__next=m.__key}else p.__prev=null}if(s.__size=c,d.length){let p=T();if(_(p)){let g=new Set(d),h=new Set(a),{anchor:C,focus:N}=p;au(C,g,h)&&wn(C,C.getNode(),this,f,m),au(N,g,h)&&wn(N,N.getNode(),this,f,m),c===0&&!this.canBeEmpty()&&!me(this)&&this.remove()}}return s}exportJSON(){return{children:[],direction:this.getDirection(),type:"element",version:1}}insertNewAfter(e,t){return null}canIndent(){return!0}collapseAtStart(e){return!1}excludeFromCopy(e){return!1}canReplaceWith(e){return!0}canInsertAfter(e){return!0}canBeEmpty(){return!0}canInsertTextBefore(){return!0}canInsertTextAfter(){return!0}isInline(){return!1}isShadowRoot(){return!1}canMergeWith(e){return!1}extractWithChild(e,t,n){return!1}canMergeWhenEmpty(){return!1}};function E(o){return o instanceof Z}function au(o,e,t){let n=o.getNode();for(;n;){let r=n.__key;if(e.has(r)&&!t.has(r))return!0;n=n.getParent()}return!1}var wt=class extends St{constructor(e){super(e)}decorate(e,t){x(!1,"decorate: base method not extended")}isIsolated(){return!1}isInline(){return!0}isKeyboardSelectable(){return!0}};function B(o){return o instanceof wt}var zo=class o extends Z{static getType(){return"root"}static clone(){return new o}constructor(){super("root"),this.__cachedText=null}getTopLevelElementOrThrow(){x(!1,"getTopLevelElementOrThrow: root nodes are not top level elements")}getTextContent(){let e=this.__cachedText;return(st()||j()._dirtyType===bt)&&e!==null?e:super.getTextContent()}remove(){x(!1,"remove: cannot be called on root nodes")}replace(e){x(!1,"replace: cannot be called on root nodes")}insertBefore(e){x(!1,"insertBefore: cannot be called on root nodes")}insertAfter(e){x(!1,"insertAfter: cannot be called on root nodes")}updateDOM(e,t){return!1}append(...e){for(let t=0;t<e.length;t++){let n=e[t];!E(n)&&!B(n)&&x(!1,"rootNode.append: Only element or decorator nodes can be appended to the root node")}return super.append(...e)}static importJSON(e){let t=F();return t.setDirection(e.direction),t}exportJSON(){return{children:[],direction:this.getDirection(),type:"root",version:1}}collapseAtStart(){return!0}};function du(){return new zo}function oe(o){return o instanceof zo}function su(o,e){let t=e.getEditorState()._selection,n=o._selection;if(n!==null){if(n.dirty||!n.is(t))return!0}else if(t!==null)return!0;return!1}function lu(o){return new Si(new Map(o._nodeMap))}function wr(){return new Si(new Map([["root",du()]]))}function cu(o){let e=o.exportJSON(),t=o.constructor;if(e.type!==t.getType()&&x(!1,"LexicalNode: Node %s does not match the serialized type. Check if .exportJSON() is implemented and it is returning the correct type.",t.name),E(o)){let n=e.children;Array.isArray(n)||x(!1,"LexicalNode: Node %s is an element but .exportJSON() does not have a children array.",t.name);let r=o.getChildren();for(let i=0;i<r.length;i++){let s=r[i],l=cu(s);n.push(l)}}return e}var Si=class o{constructor(e,t){this._nodeMap=e,this._selection=t||null,this._flushSync=!1,this._readOnly=!1}isEmpty(){return this._nodeMap.size===1&&this._selection===null}read(e,t){return Al(t&&t.editor||null,this,e)}clone(e){let t=new o(this._nodeMap,e===void 0?this._selection:e);return t._readOnly=!0,t}toJSON(){return Al(null,this,()=>({root:cu(F())}))}};var Co=class extends Z{static getType(){return"artificial"}createDOM(e){return document.createElement("div")}};function b(o,e={},t=[]){let n=document.createElement(o),r=Object.keys(e);for(let i of r)e[i]!==null&&n.setAttribute(i,e[i]);for(let i of t)typeof i=="string"?n.append(document.createTextNode(i)):n.append(i);return n}function uu(o){return new DOMParser().parseFromString(o,"text/html")}function ft(o,e="px"){return typeof o=="number"||/^-?\d+$/.test(o)?`${o}${e}`:o}function Wo(o){return/^-?\d+$/.test(o)?Number(o):/^-?\d+\.\d+$/.test(o)?Math.round(Number(o)):/^-?\d+px\s*$/.test(o)?Number(o.trim().replace("px","")):0}function Dn(o){let e=new Map,n=(o.getAttribute("style")||"").split(";");for(let r of n){let[i,s]=r.split(":");!i||!s||e.set(i.trim().toLowerCase(),s.trim())}return e}function fu(o,e,t){t?o.setAttribute(e,t):o.removeAttribute(e)}var LN=["left","right","center","justify"];function vr(o){let e=o.style.textAlign||"";return LN.includes(e)?e:o.classList.contains("align-left")?"left":o.classList.contains("align-right")?"right":o.classList.contains("align-center")?"center":o.classList.contains("align-justify")?"justify":""}function MN(o){let e=o.style.paddingLeft||"0";return Wo(e)}function Dr(o){let e=(o.dir||"").toLowerCase();return e==="rtl"||e==="ltr"?e:null}function Je(o,e){o.id&&e.setId(o.id),e.setAlignment(vr(o)),e.setInset(MN(o)),e.setDirection(Dr(o))}function vt(o,e){return o.__id!==e.__id||o.__alignment!==e.__alignment||o.__inset!==e.__inset||o.__dir!==e.__dir}function Qe(o,e){e.__id&&o.setAttribute("id",e.__id),e.__alignment&&o.classList.add("align-"+e.__alignment),e.__inset&&(o.style.paddingLeft=`${e.__inset}px`),e.__dir&&(o.dir=e.__dir)}function et(o,e){e.setId(o.id),e.setAlignment(o.alignment),e.setInset(o.inset),e.setDirection(o.direction)}var Dt=class extends Z{constructor(){super(...arguments);this.__id="";this.__alignment="";this.__inset=0}setId(t){let n=this.getWritable();n.__id=t}getId(){return this.getLatest().__id}setAlignment(t){let n=this.getWritable();n.__alignment=t}getAlignment(){return this.getLatest().__alignment}setInset(t){let n=this.getWritable();n.__inset=t}getInset(){return this.getLatest().__inset}exportJSON(){return{...super.exportJSON(),id:this.__id,alignment:this.__alignment,inset:this.__inset}}};function _o(o,e){e.__alignment=o.__alignment,e.__inset=o.__inset}var ct=class o extends Dt{constructor(e){super(e),this.__textStyle=""}static getType(){return"paragraph"}getTextStyle(){return this.getLatest().__textStyle}setTextStyle(e){let t=this.getWritable();return t.__textStyle=e,t}static clone(e){return new o(e.__key)}afterCloneFrom(e){super.afterCloneFrom(e),this.__textStyle=e.__textStyle,_o(e,this)}createDOM(e){let t=document.createElement("p"),n=po(e.theme,"paragraph");return n!==void 0&&t.classList.add(...n),Qe(t,this),t}updateDOM(e,t,n){return vt(e,this)}static importDOM(){return{p:e=>({conversion:wN,priority:0})}}exportDOM(e){let{element:t}=super.exportDOM(e);return t&&pe(t)&&this.isEmpty()&&t.append(document.createElement("br")),{element:t}}static importJSON(e){let t=I();return et(e,t),t}exportJSON(){return{...super.exportJSON(),textStyle:this.getTextStyle(),type:"paragraph",version:1}}insertNewAfter(e,t){let n=I();n.setTextStyle(e.style);let r=this.getDirection();return n.setDirection(r),n.setStyle(this.getTextStyle()),this.insertAfter(n,t),n}collapseAtStart(){let e=this.getChildren();if(e.length===0||y(e[0])&&e[0].getTextContent().trim()===""){if(this.getNextSibling()!==null)return this.selectNext(),this.remove(),!0;if(this.getPreviousSibling()!==null)return this.selectPrevious(),this.remove(),!0}return!1}};function wN(o){let e=I();return Je(o,e),{node:e}}function I(){return ne(new ct)}function dt(o){return o instanceof ct}var vN=!0,G=0,mt=1,Li=2,We=3,Re=4;function Rl(o,e,t,n){let r=o._keyToDOMMap;r.clear(),o._editorState=wr(),o._pendingEditorState=n,o._compositionKey=null,o._dirtyType=bt,o._cloneNotNeeded.clear(),o._dirtyLeaves=new Set,o._dirtyElements.clear(),o._normalizedNodes=new Set,o._updateTags=new Set,o._updates=[],o._blockCursorElement=null;let i=o._observer;i!==null&&(i.disconnect(),o._observer=null),e!==null&&(e.textContent=""),t!==null&&(t.textContent="",r.set("root",t))}function DN(o,e){let t=new Map,n=new Set,r=i=>{Object.keys(i).forEach(s=>{let l=t.get(s);l===void 0&&(l=[],t.set(s,l)),l.push(i[s])})};return o.forEach(i=>{let s=i.klass.importDOM;if(s==null||n.has(s))return;n.add(s);let l=s.call(i.klass);l!==null&&r(l)}),e&&r(e),t}function kl(o){let e=o||{},t=ou(),n=e.theme||{},r=o===void 0?t:e.parentEditor||null,i=e.disableEvents||!1,s=wr(),l=e.namespace||(r!==null?r._config.namespace:Js()),a=e.editorState,d=[zo,je,Bo,Fo,ct,Co,...e.nodes||[]],{onError:m,html:f}=e,c=e.editable!==void 0?e.editable:!0,u;if(o===void 0&&t!==null)u=t._nodes;else{u=new Map;for(let g=0;g<d.length;g++){let h=d[g],C=null,N=null;if(typeof h!="function"){let A=h;h=A.replace,C=A.with,N=A.withKlass||null}if(__DEV__){let A=Object.prototype.hasOwnProperty.call(h,"getType")&&h.getType(),O=h.name;if(N&&x(N.prototype instanceof h,"%s doesn't extend the %s",N.name,O),O!=="RootNode"&&A!=="root"&&A!=="artificial"){let R=h.prototype;["getType","clone"].forEach(P=>{h.hasOwnProperty(P)||console.warn(`${O} must implement static "${P}" method`)}),!h.hasOwnProperty("importDOM")&&h.hasOwnProperty("exportDOM")&&console.warn(`${O} should implement "importDOM" if using a custom "exportDOM" method to ensure HTML serialization (important for copy & paste) works as expected`),R instanceof wt&&(R.hasOwnProperty("decorate")||console.warn(`${R.constructor.name} must implement "decorate" method`)),h.hasOwnProperty("importJSON")||console.warn(`${O} should implement "importJSON" method to ensure JSON and default HTML serialization works as expected`),R.hasOwnProperty("exportJSON")||console.warn(`${O} should implement "exportJSON" method to ensure JSON and default HTML serialization works as expected`)}}let L=h.getType(),M=h.transform(),S=new Set;M!==null&&S.add(M),u.set(L,{exportDOM:f&&f.export?f.export.get(h):void 0,klass:h,replace:C,replaceWithKlass:N,transforms:S})}}let p=new ho(s,r,u,{disableEvents:i,namespace:l,theme:n},m||console.error,DN(u,f?f.import:void 0),c);return a!==void 0&&(p._pendingEditorState=a,p._dirtyType=Wt),p}var ho=class{constructor(e,t,n,r,i,s,l){this._parentEditor=t,this._rootElement=null,this._editorState=e,this._pendingEditorState=null,this._compositionKey=null,this._deferred=[],this._keyToDOMMap=new Map,this._updates=[],this._updating=!1,this._listeners={decorator:new Set,editable:new Set,mutation:new Map,root:new Set,textcontent:new Set,update:new Set},this._commands=new Map,this._config=r,this._nodes=n,this._decorators={},this._pendingDecorators=null,this._dirtyType=bt,this._cloneNotNeeded=new Set,this._dirtyLeaves=new Set,this._dirtyElements=new Map,this._normalizedNodes=new Set,this._updateTags=new Set,this._observer=null,this._key=Js(),this._onError=i,this._htmlConversions=s,this._editable=l,this._headless=t!==null&&t._headless,this._window=null,this._blockCursorElement=null}isComposing(){return this._compositionKey!=null}registerUpdateListener(e){let t=this._listeners.update;return t.add(e),()=>{t.delete(e)}}registerEditableListener(e){let t=this._listeners.editable;return t.add(e),()=>{t.delete(e)}}registerDecoratorListener(e){let t=this._listeners.decorator;return t.add(e),()=>{t.delete(e)}}registerTextContentListener(e){let t=this._listeners.textcontent;return t.add(e),()=>{t.delete(e)}}registerRootListener(e){let t=this._listeners.root;return e(this._rootElement,null),t.add(e),()=>{e(null,this._rootElement),t.delete(e)}}registerCommand(e,t,n){n===void 0&&x(!1,'Listener for type "command" requires a "priority".');let r=this._commands;r.has(e)||r.set(e,[new Set,new Set,new Set,new Set,new Set]);let i=r.get(e);i===void 0&&x(!1,"registerCommand: Command %s not found in command map",String(e));let s=i[n];return s.add(t),()=>{s.delete(t),i.every(l=>l.size===0)&&r.delete(e)}}registerMutationListener(e,t,n){let r=this.resolveRegisteredNodeAfterReplacements(this.getRegisteredNode(e)).klass,i=this._listeners.mutation;i.set(t,r);let s=n&&n.skipInitialization;return(s===void 0?vN:s)||this.initializeMutationListener(t,r),()=>{i.delete(t)}}getRegisteredNode(e){let t=this._nodes.get(e.getType());return t===void 0&&x(!1,"Node %s has not been registered. Ensure node has been passed to createEditor.",e.name),t}resolveRegisteredNodeAfterReplacements(e){for(;e.replaceWithKlass;)e=this.getRegisteredNode(e.replaceWithKlass);return e}initializeMutationListener(e,t){let n=this._editorState,r=cc(n).get(t.getType());if(!r)return;let i=new Map;for(let s of r.keys())i.set(s,"created");i.size>0&&e(i,{dirtyLeaves:new Set,prevEditorState:n,updateTags:new Set(["registerMutationListener"])})}registerNodeTransformToKlass(e,t){let n=this.getRegisteredNode(e);return n.transforms.add(t),n}registerNodeTransform(e,t){let n=this.registerNodeTransformToKlass(e,t),r=[n],i=n.replaceWithKlass;if(i!=null){let s=this.registerNodeTransformToKlass(i,t);r.push(s)}return wd(this,e.getType()),()=>{r.forEach(s=>s.transforms.delete(t))}}hasNode(e){return this._nodes.has(e.getType())}hasNodes(e){return e.every(this.hasNode.bind(this))}dispatchCommand(e,t){return D(this,e,t)}getDecorators(){return this._decorators}getRootElement(){return this._rootElement}getKey(){return this._key}setRootElement(e){let t=this._rootElement;if(e!==t){let n=po(this._config.theme,"root"),r=this._pendingEditorState||this._editorState;if(this._rootElement=e,Rl(this,t,e,r),t!==null&&(this._config.disableEvents||Ac(t),n!=null&&t.classList.remove(...n)),e!==null){let i=ac(e),s=e.style;s.userSelect="text",s.whiteSpace="pre-wrap",s.wordBreak="break-word",e.setAttribute("data-lexical-editor","true"),this._window=i,this._dirtyType=Wt,ni(this),this._updateTags.add("history-merge"),Mt(this),this._config.disableEvents||Oc(e,this),n!=null&&e.classList.add(...n)}else this._editorState=r,this._pendingEditorState=null,this._window=null;vn("root",this,!1,e,t)}}getElementByKey(e){return this._keyToDOMMap.get(e)||null}getEditorState(){return this._editorState}setEditorState(e,t){e.isEmpty()&&x(!1,"setEditorState: the editor state is empty. Ensure the editor state's root node never becomes empty."),oi(this);let n=this._pendingEditorState,r=this._updateTags,i=t!==void 0?t.tag:null;n!==null&&!n.isEmpty()&&(i!=null&&r.add(i),Mt(this)),this._pendingEditorState=e,this._dirtyType=Wt,this._dirtyElements.set("root",!1),this._compositionKey=null,i!=null&&r.add(i),Mt(this)}parseEditorState(e,t){let n=typeof e=="string"?JSON.parse(e):e;return nu(n,this,t)}read(e){return Mt(this),this.getEditorState().read(e,{editor:this})}update(e,t){xe(this,e,t)}updateAndCommit(e,t){this.update(e,t),this.commitUpdates()}focus(e,t={}){let n=this._rootElement;n!==null&&(n.setAttribute("autocapitalize","off"),xe(this,()=>{let r=T(),i=F();r!==null?r.dirty=!0:i.getChildrenSize()!==0&&(t.defaultSelection==="rootStart"?i.selectStart():i.selectEnd())},{onUpdate:()=>{n.removeAttribute("autocapitalize"),e&&e()},tag:"focus"}),this._pendingEditorState===null&&n.removeAttribute("autocapitalize"))}commitUpdates(){Mt(this)}blur(){let e=this._rootElement;e!==null&&e.blur();let t=be(this._window);t!==null&&t.removeAllRanges()}isEditable(){return this._editable}setEditable(e){this._editable!==e&&(this._editable=e,vn("editable",this,!0,e))}toJSON(){return{editorState:this._editorState.toJSON()}}};ho.version="0.17.1";function jt(...o){return()=>{for(let e=o.length-1;e>=0;e--)o[e]();o.length=0}}var On=new Map;function Il(o){let e={},t=o.split(";");for(let n of t)if(n!==""){let[r,i]=n.split(/:([^]+)/);r&&i&&(e[r.trim()]=i.trim())}return e}function An(o){let e=On.get(o);return e===void 0&&(e=Il(o),On.set(o,e)),__DEV__&&Object.freeze(e),e}function pu(o){let e="";for(let t in o)t&&(e+=`${t}: ${o[t]};`);return e}function Or(o,e){let t=o.getStartEndPoints();if(e.isSelected(o)&&!e.isSegmented()&&!e.isToken()&&t!==null){let[n,r]=t,i=o.isBackward(),s=n.getNode(),l=r.getNode(),a=e.is(s),d=e.is(l);if(a||d){let[m,f]=Mr(o),c=s.is(l),u=e.is(i?l:s),p=e.is(i?s:l),g=0,h;if(c)g=m>f?f:m,h=m>f?m:f;else if(u)g=i?f:m,h=void 0;else if(p){let C=i?m:f;g=0,h=C}return e.__text=e.__text.slice(g,h),e}}return e}function $l(o){let e=o.getStyle(),t=Il(e);On.set(e,t)}function Rn(o,e){let t=An("getStyle"in o?o.getStyle():o.style),n=Object.entries(e).reduce((i,[s,l])=>(typeof l=="function"?i[s]=l(t[s],o):l===null?delete i[s]:i[s]=l,i),{...t}),r=pu(n);o.setStyle(r),On.set(r,n)}function Pl(o,e){let t=o.getNodes(),n=t.length,r=o.getStartEndPoints();if(r===null)return;let[i,s]=r,l=n-1,a=t[0],d=t[l];if(o.isCollapsed()&&_(o)){Rn(o,e);return}let f=a.getTextContent().length,c=s.offset,u=i.offset,p=i.isBefore(s),g=p?u:c,h=p?c:u,C=p?i.type:s.type,N=p?s.type:i.type,L=p?s.key:i.key;if(y(a)&&g===f){let M=a.getNextSibling();y(M)&&(u=0,g=0,a=M)}if(t.length===1){if(y(a)&&a.canHaveFormat()){if(g=C==="element"?0:u>c?c:u,h=N==="element"?f:u>c?u:c,g===h)return;if(Ue(a)||g===0&&h===f)Rn(a,e),a.select(g,h);else{let M=a.splitText(g,h),S=g===0?M[0]:M[1];Rn(S,e),S.select(0,h-g)}}}else{if(y(a)&&g<a.getTextContentSize()&&a.canHaveFormat()&&(g!==0&&!Ue(a)&&(a=a.splitText(g)[1],g=0,p?i.set(a.getKey(),g,"text"):s.set(a.getKey(),g,"text")),Rn(a,e)),y(d)&&d.canHaveFormat()){let S=d.getTextContent().length;d.__key!==L&&h!==0&&(h=S),h!==S&&!Ue(d)&&([d]=d.splitText(h)),(h!==0||N==="element")&&Rn(d,e)}for(let M=1;M<l;M++){let S=t[M],A=S.getKey();y(S)&&S.canHaveFormat()&&A!==a.getKey()&&A!==d.getKey()&&!S.isToken()&&Rn(S,e)}}}function Mi(o,e){if(o===null)return;let t=o.getStartEndPoints(),n=t?t[0]:null;if(n!==null&&n.key==="root"){let s=e(),l=F(),a=l.getFirstChild();a?a.replace(s,!0):l.append(s);return}let r=o.getNodes(),i=n!==null?AN(n.getNode(),gu):!1;i&&r.indexOf(i)===-1&&r.push(i);for(let s=0;s<r.length;s++){let l=r[s];if(!gu(l))continue;x(E(l),"Expected block node to be an ElementNode");let a=e();l.replace(a,!0)}}function wi(o,e){let t=Zt(o.focus,e);return B(t)&&!t.isIsolated()||E(t)&&!t.isInline()&&!t.canBeEmpty()}function hu(o,e,t,n){o.modify(e?"extend":"move",t,n)}function Nu(o){let e=o.anchor.getNode();return(oe(e)?e:e.getParentOrThrow()).getDirection()==="rtl"}function vi(o,e,t){let n=Nu(o);hu(o,e,t?!n:n,"character")}function ON(o,e,t){let n=o.getStyle(),r=An(n);return r!==null&&r[e]||t}function Bl(o,e,t=""){let n=null,r=o.getNodes(),i=o.anchor,s=o.focus,l=o.isBackward(),a=l?s.offset:i.offset,d=l?s.getNode():i.getNode();if(_(o)&&o.isCollapsed()&&o.style!==""){let m=o.style,f=An(m);if(f!==null&&e in f)return f[e]}for(let m=0;m<r.length;m++){let f=r[m];if(!(m!==0&&a===0&&f.is(d))&&y(f)){let c=ON(f,e,t);if(n===null)n=c;else if(n!==c){n="";break}}}return n===null?t:n}function gu(o){if(B(o)||!E(o)||me(o))return!1;let e=o.getFirstChild(),t=e===null||ve(e)||y(e)||e.isInline();return!o.isInline()&&o.canBeEmpty()!==!1&&t}function AN(o,e){let t=o;for(;t!==null&&t.getParent()!==null&&!e(t);)t=t.getParentOrThrow();return e(t)?t:null}function Te(o,...e){let t=yt(...e);t.length>0&&o.classList.add(...t)}function Di(o,...e){let t=yt(...e);t.length>0&&o.classList.remove(...t)}function xu(o,e){let t=o;for(;t!=null;){if(t instanceof e)return t;t=t.getParent()}return null}function Eu(o){let e=H(o,t=>E(t)&&!t.isInline());return E(e)||x(!1,"Expected node %s to have closest block element node.",o.__key),e}var H=(o,e)=>{let t=o;for(;t!==F()&&t!=null;){if(e(t))return t;t=t.getParent()}return null};function pt(o,e){return o!==null?Object.getPrototypeOf(o).constructor.name===e.name:!1}var Oi=0,Fl=1,Hl=2,gt=0,$N=1,Tu=2,PN=3,BN=4;function FN(o,e,t){let n=o._nodeMap,r=[];for(let i of e){let s=n.get(i);s!==void 0&&r.push(s)}for(let[i,s]of t){if(!s)continue;let l=n.get(i);l!==void 0&&!oe(l)&&r.push(l)}return r}function HN(o,e,t,n,r){if(o===null||t.size===0&&n.size===0&&!r)return gt;let i=e._selection,s=o._selection;if(r)return $N;if(!_(i)||!_(s)||!s.isCollapsed()||!i.isCollapsed())return gt;let l=FN(e,t,n);if(l.length===0)return gt;if(l.length>1){let C=e._nodeMap,N=C.get(i.anchor.key),L=C.get(s.anchor.key);return N&&L&&!o._nodeMap.has(N.__key)&&y(N)&&N.__text.length===1&&i.anchor.offset===1?Tu:gt}let a=l[0],d=o._nodeMap.get(a.__key);if(!y(d)||!y(a)||d.__mode!==a.__mode)return gt;let m=d.__text,f=a.__text;if(m===f)return gt;let c=i.anchor,u=s.anchor;if(c.key!==u.key||c.type!=="text")return gt;let p=c.offset,g=u.offset,h=f.length-m.length;return h===1&&g===p-1?Tu:h===-1&&g===p+1?PN:h===-1&&g===p?BN:gt}function KN(o,e,t){let n=e._nodeMap.get(o),r=t._nodeMap.get(o),i=e._selection,s=t._selection;return!(_(i)&&_(s)&&i.anchor.type==="element"&&i.focus.type==="element"&&s.anchor.type==="text"&&s.focus.type==="text")&&y(n)&&y(r)&&n.__parent===r.__parent?JSON.stringify(e.read(()=>n.exportJSON()))===JSON.stringify(t.read(()=>r.exportJSON())):!1}function UN(o,e){let t=Date.now(),n=gt;return(r,i,s,l,a,d)=>{let m=Date.now();if(d.has("historic"))return n=gt,t=m,Hl;let f=HN(r,i,l,a,o.isComposing()),c=(()=>{let u=s===null||s.editor===o,p=d.has("history-push");if(!p&&u&&d.has("history-merge"))return Oi;if(r===null)return Fl;let h=i._selection;if(!(l.size>0||a.size>0))return h!==null?Oi:Hl;if(p===!1&&f!==gt&&f===n&&m<t+e&&u)return Oi;if(l.size===1){let N=Array.from(l)[0];if(KN(N,r,i))return Oi}return Fl})();return t=m,n=f,c}}function zN(o,e){let t=e.redoStack,n=e.undoStack;if(t.length!==0){let r=e.current;r!==null&&(n.push(r),o.dispatchCommand(uo,!0));let i=t.pop();t.length===0&&o.dispatchCommand(co,!1),e.current=i||null,i&&i.editor.setEditorState(i.editorState,{tag:"historic"})}}function WN(o,e){let t=e.redoStack,n=e.undoStack;if(n.length!==0){let i=e.current,s=n.pop();i!==null&&(t.push(i),o.dispatchCommand(co,!0)),n.length===0&&o.dispatchCommand(uo,!1),e.current=s||null,s&&s.editor.setEditorState(s.editorState,{tag:"historic"})}}function Cu(o){o.undoStack=[],o.redoStack=[],o.current=null}function _u(o,e,t){let n=UN(o,t),r=({editorState:s,prevEditorState:l,dirtyLeaves:a,dirtyElements:d,tags:m})=>{let f=e.current,c=e.redoStack,u=e.undoStack,p=f===null?null:f.editorState;if(f!==null&&s===p)return;let g=n(l,s,f,a,d,m);if(g===Fl)c.length!==0&&(e.redoStack=[],o.dispatchCommand(co,!1)),f!==null&&(u.push({...f}),o.dispatchCommand(uo,!0));else if(g===Hl)return;e.current={editor:o,editorState:s}};return jt(o.registerCommand(io,()=>(WN(o,e),!0),G),o.registerCommand(so,()=>(zN(o,e),!0),G),o.registerCommand(Is,()=>(Cu(e),!1),G),o.registerCommand($s,()=>(Cu(e),o.dispatchCommand(co,!1),o.dispatchCommand(uo,!1),!0),G),o.registerUpdateListener(r))}function bu(){return{current:null,redoStack:[],undoStack:[]}}function Ai(o,e){let t=e.body?e.body.childNodes:[],n=[],r=[];for(let i=0;i<t.length;i++){let s=t[i];if(!Lu.has(s.nodeName)){let l=Mu(s,o,r,!1);l!==null&&(n=n.concat(l))}}return YN(r),n}function Ri(o,e){if(typeof document>"u"||typeof window>"u"&&typeof global.window>"u")throw new Error("To use $generateHtmlFromNodes in headless mode please initialize a headless browser implementation such as JSDom before calling this function.");let t=document.createElement("div"),r=F().getChildren();for(let i=0;i<r.length;i++){let s=r[i];Su(o,s,t,e)}return t.innerHTML}function Su(o,e,t,n=null){let r=n!==null?e.isSelected(n):!0,i=E(e)&&e.excludeFromCopy("html"),s=e;if(n!==null){let u=Vt(e);u=y(u)&&n!==null?Or(n,u):u,s=u}let l=E(s)?s.getChildren():[],a=o._nodes.get(s.getType()),d;a&&a.exportDOM!==void 0?d=a.exportDOM(o,s):d=s.exportDOM(o);let{element:m,after:f}=d;if(!m)return!1;let c=document.createDocumentFragment();for(let u=0;u<l.length;u++){let p=l[u],g=Su(o,p,c,n);!r&&E(e)&&g&&e.extractWithChild(p,n,"html")&&(r=!0)}if(r&&!i){if(pe(m)&&m.append(c),t.append(m),f){let u=f.call(s,m);u&&m.replaceWith(u)}}else t.append(c);return r}function qN(o,e){let{nodeName:t}=o,n=e._htmlConversions.get(t.toLowerCase()),r=null;if(n!==void 0)for(let i of n){let s=i(o);s!==null&&(r===null||(r.priority||0)<(s.priority||0))&&(r=s)}return r!==null?r.conversion:null}var Lu=new Set(["STYLE","SCRIPT"]);function Mu(o,e,t,n,r=new Map,i){let s=[];if(Lu.has(o.nodeName))return s;let l=null,a=qN(o,e),d=a?a(o):null,m=null;if(d!==null){m=d.after;let p=d.node;if(p==="ignore")return s;if(l=Array.isArray(p)?p[p.length-1]:p,l!==null){for(let[,g]of r)if(l=g(l,i),!l)break;l&&s.push(...Array.isArray(p)?p:[l])}d.forChild!=null&&r.set(o.nodeName,d.forChild)}let f=o.childNodes,c=[],u=l!=null&&me(l)?!1:l!=null&&Ko(l)||n;for(let p=0;p<f.length;p++)c.push(...Mu(f[p],e,t,u,new Map(r),l));return m!=null&&(c=m(c)),go(o)&&(u?c=yu(o,c,()=>{let p=new Co;return t.push(p),p}):c=yu(o,c,I)),l==null?c.length>0?s=s.concat(c):go(o)&&ZN(o)&&(s=s.concat(ut())):E(l)&&l.append(...c),s}function yu(o,e,t){let n=[],r=[];for(let i=0;i<e.length;i++){let s=e[i];if(Ko(s))n.push(s);else if(r.push(s),i===e.length-1||i<e.length-1&&Ko(e[i+1])){let l=t();l.append(...r),n.push(l),r=[]}}return n}function YN(o){for(let e of o)e.getNextSibling()instanceof Co&&e.insertAfter(ut());for(let e of o){let t=e.getChildren();for(let n of t)e.insertBefore(n);e.remove()}}function ZN(o){return o.nextSibling==null||o.previousSibling==null?!1:Io(o.nextSibling)&&Io(o.previousSibling)}var vu=o=>fe?(o||window).getSelection():null;function Du(o,e=T()){return e==null&&x(!1,"Expected valid LexicalSelection"),_(e)&&e.isCollapsed()||e.getNodes().length===0?"":Ri(o,e)}function Ou(o,e=T()){return e==null&&x(!1,"Expected valid LexicalSelection"),_(e)&&e.isCollapsed()||e.getNodes().length===0?null:JSON.stringify(Ru(o,e))}function ki(o,e,t){let n=o.getData("application/x-lexical-editor");if(n)try{let s=JSON.parse(n);if(s.namespace===t._config.namespace&&Array.isArray(s.nodes)){let l=ku(s.nodes);return Kl(t,l,e)}}catch{}let r=o.getData("text/html");if(r)try{let l=new DOMParser().parseFromString(r,"text/html"),a=Ai(t,l);return Kl(t,a,e)}catch{}let i=o.getData("text/plain")||o.getData("text/uri-list");if(i!=null)if(_(e)){let s=i.split(/(\r?\n|\t)/);s[s.length-1]===""&&s.pop();for(let l=0;l<s.length;l++){let a=T();if(_(a)){let d=s[l];d===`
`||d===`\r
`?a.insertParagraph():d==="	"?a.insertNodes([Lt()]):a.insertText(d)}}}else e.insertRawText(i)}function Kl(o,e,t){o.dispatchCommand(er,{nodes:e,selection:t})||t.insertNodes(e)}function VN(o){let e=o.exportJSON(),t=o.constructor;if(e.type!==t.getType()&&x(!1,"LexicalNode: Node %s does not implement .exportJSON().",t.name),E(o)){let n=e.children;Array.isArray(n)||x(!1,"LexicalNode: Node %s is an element but .exportJSON() does not have a children array.",t.name)}return e}function Au(o,e,t,n=[]){let r=e!==null?t.isSelected(e):!0,i=E(t)&&t.excludeFromCopy("html"),s=t;if(e!==null){let d=Vt(t);d=y(d)&&e!==null?Or(e,d):d,s=d}let l=E(s)?s.getChildren():[],a=VN(s);if(y(s)){let d=s.__text;d.length>0?a.text=d:r=!1}for(let d=0;d<l.length;d++){let m=l[d],f=Au(o,e,m,a.children);!r&&E(t)&&f&&t.extractWithChild(m,e,"clone")&&(r=!0)}if(r&&!i)n.push(a);else if(Array.isArray(a.children))for(let d=0;d<a.children.length;d++){let m=a.children[d];n.push(m)}return r}function Ru(o,e){let t=[],r=F().getChildren();for(let i=0;i<r.length;i++){let s=r[i];Au(o,e,s,t)}return{namespace:o._config.namespace,nodes:t}}function ku(o){let e=[];for(let t=0;t<o.length;t++){let n=o[t],r=Dl(n);y(r)&&$l(r),e.push(r)}return e}var XN=50,kn=null;async function In(o,e,t){if(kn!==null)return!1;if(e!==null)return new Promise((a,d)=>{o.update(()=>{a(wu(o,e,t))})});let n=o.getRootElement(),r=o._window==null?window.document:o._window.document,i=vu(o._window);if(n===null||i===null)return!1;let s=r.createElement("span");s.style.cssText="position: fixed; top: -1000px;",s.append(r.createTextNode("#")),n.append(s);let l=new Range;return l.setStart(s,0),l.setEnd(s,1),i.removeAllRanges(),i.addRange(l),new Promise((a,d)=>{let m=o.registerCommand(lo,f=>(pt(f,ClipboardEvent)&&(m(),kn!==null&&(window.clearTimeout(kn),kn=null),a(wu(o,f,t))),!0),Re);kn=window.setTimeout(()=>{m(),kn=null,a(!1)},XN),r.execCommand("copy"),s.remove()})}function wu(o,e,t){if(t===void 0){let r=vu(o._window);if(!r)return!1;let i=r.anchorNode,s=r.focusNode;if(i!==null&&s!==null&&!qt(o,i,s))return!1;let l=T();if(l===null)return!1;t=Ii(l)}e.preventDefault();let n=e.clipboardData;return n===null?!1:(Iu(n,t),!0)}var GN=[["text/html",Du],["application/x-lexical-editor",Ou]];function Ii(o=T()){let e={"text/plain":o?o.getTextContent():""};if(o){let t=nl();for(let[n,r]of GN){let i=r(t,o);i!==null&&(e[n]=i)}}return e}function Iu(o,e){for(let t in e){let n=e[t];n!==void 0&&o.setData(t,n)}}function $i(o,e){if(typeof document.caretRangeFromPoint<"u"){let t=document.caretRangeFromPoint(o,e);return t===null?null:{node:t.startContainer,offset:t.startOffset}}else if(document.caretPositionFromPoint!=="undefined"){let t=document.caretPositionFromPoint(o,e);return t===null?null:{node:t.offsetNode,offset:t.offset}}else return null}var $u=$("DRAG_DROP_PASTE_FILE");function jN(o,e){o.preventDefault(),e.update(()=>{let t=T(),n=pt(o,InputEvent)||pt(o,KeyboardEvent)?null:o.clipboardData;n!=null&&t!==null&&ki(n,t,e)},{tag:"paste"})}async function JN(o,e){await In(e,pt(o,ClipboardEvent)?o:null),e.update(()=>{let t=T();_(t)?t.removeText():Se(t)&&t.getNodes().forEach(n=>n.remove())})}function Pi(o){let e=null;if(pt(o,DragEvent)?e=o.dataTransfer:pt(o,ClipboardEvent)&&(e=o.clipboardData),e===null)return[!1,[],!1];let t=e.types,n=t.includes("Files"),r=t.includes("text/html")||t.includes("text/plain");return[n,Array.from(e.files),r]}function Bi(o){let e=ee(o);return B(e)}function QN(o){let e=o.focus;return e.key==="root"&&e.offset===F().getChildrenSize()}function Pu(o){return jt(o.registerCommand(tr,t=>{let n=T();return Se(n)?(n.clear(),!0):!1},0),o.registerCommand(Ye,t=>{let n=T();return _(n)?(n.deleteCharacter(t),!0):!1},G),o.registerCommand(Ct,t=>{let n=T();return _(n)?(n.deleteWord(t),!0):!1},G),o.registerCommand(it,t=>{let n=T();return _(n)?(n.deleteLine(t),!0):!1},G),o.registerCommand(rt,t=>{let n=T();if(typeof t=="string")n!==null&&n.insertText(t);else{if(n===null)return!1;let r=t.dataTransfer;if(r!=null)ki(r,n,o);else if(_(n)){let i=t.data;return i&&n.insertText(i),!0}}return!0},G),o.registerCommand(cn,()=>{let t=T();return _(t)?(t.removeText(),!0):!1},G),o.registerCommand(Ne,t=>{let n=T();return _(n)?(n.formatText(t),!0):!1},G),o.registerCommand($t,t=>{let n=T();return _(n)?(n.insertLineBreak(t),!0):!1},G),o.registerCommand(Pt,()=>{let t=T();return _(t)?(t.insertParagraph(),!0):!1},G),o.registerCommand(Rs,()=>(Oe([Lt()]),!0),G),o.registerCommand(Bt,t=>{let n=T();if(Se(n)&&!Bi(t.target)){let r=n.getNodes();if(r.length>0)return r[0].selectPrevious(),!0}else if(_(n)){let r=Zt(n.focus,!0);if(!t.shiftKey&&B(r)&&!r.isIsolated()&&!r.isInline())return r.selectPrevious(),t.preventDefault(),!0}return!1},G),o.registerCommand(Ft,t=>{let n=T();if(Se(n)){let r=n.getNodes();if(r.length>0)return r[0].selectNext(0,0),!0}else if(_(n)){if(QN(n))return t.preventDefault(),!0;let r=Zt(n.focus,!1);if(!t.shiftKey&&B(r)&&!r.isIsolated()&&!r.isInline())return r.selectNext(),t.preventDefault(),!0}return!1},G),o.registerCommand(wo,t=>{let n=T();if(Se(n)){let r=n.getNodes();if(r.length>0)return t.preventDefault(),r[0].selectPrevious(),!0}if(!_(n))return!1;if(wi(n,!0)){let r=t.shiftKey;return t.preventDefault(),vi(n,r,!0),!0}return!1},G),o.registerCommand(Mo,t=>{let n=T();if(Se(n)&&!Bi(t.target)){let i=n.getNodes();if(i.length>0)return t.preventDefault(),i[0].selectNext(0,0),!0}if(!_(n))return!1;let r=t.shiftKey;return wi(n,!1)?(t.preventDefault(),vi(n,r,!1),!0):!1},G),o.registerCommand(Ht,t=>{if(Bi(t.target))return!1;let n=T();return _(n)?(t.preventDefault(),o.dispatchCommand(Ye,!0)):!1},G),o.registerCommand(Kt,t=>{if(Bi(t.target))return!1;let n=T();return _(n)?(t.preventDefault(),o.dispatchCommand(Ye,!1)):!1},G),o.registerCommand(Be,t=>{let n=T();if(!_(n))return!1;if(t!==null){if((_t||Ut||zt)&&fo)return!1;if(t.preventDefault(),t.shiftKey)return o.dispatchCommand($t,!1)}return o.dispatchCommand(Pt,void 0)},G),o.registerCommand(vo,()=>{let t=T();return _(t)?(o.blur(),!0):!1},G),o.registerCommand(Oo,t=>{let[,n]=Pi(t);if(n.length>0){let i=t.clientX,s=t.clientY,l=$i(i,s);if(l!==null){let{offset:a,node:d}=l,m=ee(d);if(m!==null){let f=Uo();if(y(m))f.anchor.set(m.getKey(),a,"text"),f.focus.set(m.getKey(),a,"text");else{let u=m.getParentOrThrow().getKey(),p=m.getIndexWithinParent()+1;f.anchor.set(u,p,"element"),f.focus.set(u,p,"element")}let c=Ao(f);Y(c)}o.dispatchCommand($u,n)}return t.preventDefault(),!0}let r=T();return!!_(r)},G),o.registerCommand(nr,t=>{let[n]=Pi(t),r=T();return!(n&&!_(r))},G),o.registerCommand(rr,t=>{let[n]=Pi(t),r=T();if(n&&!_(r))return!1;let i=t.clientX,s=t.clientY,l=$i(i,s);if(l!==null){let a=ee(l.node);B(a)&&t.preventDefault()}return!0},G),o.registerCommand(un,()=>(tl(),!0),G),o.registerCommand(lo,t=>(In(o,pt(t,ClipboardEvent)?t:null),!0),G),o.registerCommand(ao,t=>(JN(t,o),!0),G),o.registerCommand(ro,t=>{let[,n,r]=Pi(t);return n.length>0&&!r?(o.dispatchCommand($u,n),!0):Tn(t.target)?!1:T()!==null?(jN(t,o),!0):!1},G))}var qo=class o extends Z{constructor(t,n){super(n);this.__id="";this.__category="info";this.__alignment="";this.__inset=0;this.__category=t}static getType(){return"callout"}static clone(t){let n=new o(t.__category,t.__key);return n.__id=t.__id,n.__alignment=t.__alignment,n.__inset=t.__inset,n}setCategory(t){let n=this.getWritable();n.__category=t}getCategory(){return this.getLatest().__category}setId(t){let n=this.getWritable();n.__id=t}getId(){return this.getLatest().__id}setAlignment(t){let n=this.getWritable();n.__alignment=t}getAlignment(){return this.getLatest().__alignment}setInset(t){let n=this.getWritable();n.__inset=t}getInset(){return this.getLatest().__inset}createDOM(t,n){let r=document.createElement("p");return r.classList.add("callout",this.__category||""),Qe(r,this),r}updateDOM(t){return t.__category!==this.__category||vt(t,this)}insertNewAfter(t,n){let r=t?t.anchor.offset:0,i=r===this.getTextContentSize()||!t?I():$n(this.__category);if(i.setDirection(this.getDirection()),this.insertAfter(i,n),r===0&&!this.isEmpty()&&t){let s=I();s.select(),this.replace(s,!0)}return i}static importDOM(){return{p(t){return t.classList.contains("callout")?{conversion:n=>{let r="info",i=["info","success","warning","danger"];for(let l of i)if(n.classList.contains(l)){r=l;break}let s=new o(r);return Je(n,s),{node:s}},priority:3}:null}}}exportJSON(){return{...super.exportJSON(),type:"callout",version:1,category:this.__category,id:this.__id,alignment:this.__alignment,inset:this.__inset}}static importJSON(t){let n=$n(t.category);return et(t,n),n}};function $n(o="info"){return new qo(o)}function Ul(o){return o instanceof qo}function zl(o,e="info"){return o instanceof qo&&o.getCategory()===e}var ex=new Set(["http:","https:","mailto:","sms:","tel:"]),Pn=class o extends Z{static getType(){return"link"}static clone(e){return new o(e.__url,{rel:e.__rel,target:e.__target,title:e.__title},e.__key)}constructor(e,t={},n){super(n);let{target:r=null,rel:i=null,title:s=null}=t;this.__url=e,this.__target=r,this.__rel=i,this.__title=s}createDOM(e){let t=document.createElement("a");return t.href=this.sanitizeUrl(this.__url),this.__target!==null&&(t.target=this.__target),this.__rel!==null&&(t.rel=this.__rel),this.__title!==null&&(t.title=this.__title),Te(t,e.theme.link),t}updateDOM(e,t,n){if(t instanceof HTMLAnchorElement){let r=this.__url,i=this.__target,s=this.__rel,l=this.__title;r!==e.__url&&(t.href=r),i!==e.__target&&(i?t.target=i:t.removeAttribute("target")),s!==e.__rel&&(s?t.rel=s:t.removeAttribute("rel")),l!==e.__title&&(l?t.title=l:t.removeAttribute("title"))}return!1}static importDOM(){return{a:e=>({conversion:tx,priority:1})}}static importJSON(e){let t=ht(e.url,{rel:e.rel,target:e.target,title:e.title});return t.setDirection(e.direction),t}sanitizeUrl(e){try{let t=new URL(e);if(!ex.has(t.protocol))return"about:blank"}catch{return e}return e}exportJSON(){return{...super.exportJSON(),rel:this.getRel(),target:this.getTarget(),title:this.getTitle(),type:"link",url:this.getURL(),version:1}}getURL(){return this.getLatest().__url}setURL(e){let t=this.getWritable();t.__url=e}getTarget(){return this.getLatest().__target}setTarget(e){let t=this.getWritable();t.__target=e}getRel(){return this.getLatest().__rel}setRel(e){let t=this.getWritable();t.__rel=e}getTitle(){return this.getLatest().__title}setTitle(e){let t=this.getWritable();t.__title=e}insertNewAfter(e,t=!0){let n=ht(this.__url,{rel:this.__rel,target:this.__target,title:this.__title});return this.insertAfter(n,t),n}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}canBeEmpty(){return!1}isInline(){return!0}extractWithChild(e,t,n){if(!_(t))return!1;let r=t.anchor.getNode(),i=t.focus.getNode();return this.isParentOf(r)&&this.isParentOf(i)&&t.getTextContent().length>0}isEmailURI(){return this.__url.startsWith("mailto:")}isWebSiteURI(){return this.__url.startsWith("https://")||this.__url.startsWith("http://")}};function tx(o){let e=null;if(fi(o)){let t=o.textContent;(t!==null&&t!==""||o.children.length>0)&&(e=ht(o.getAttribute("href")||"",{rel:o.getAttribute("rel"),target:o.getAttribute("target"),title:o.getAttribute("title")}))}return{node:e}}function ht(o,e){return ne(new Pn(o,e))}function Ot(o){return o instanceof Pn}var BS=$("TOGGLE_LINK_COMMAND");var Yo=class o extends Z{constructor(t,n,r){super(r);this.__src="";this.__alt="";this.__width=0;this.__height=0;this.__alignment="";this.__src=t,n.alt&&(this.__alt=n.alt),n.width&&(this.__width=n.width),n.height&&(this.__height=n.height)}static getType(){return"image"}static clone(t){let n=new o(t.__src,{alt:t.__alt,width:t.__width,height:t.__height},t.__key);return n.__alignment=t.__alignment,n}setSrc(t){let n=this.getWritable();n.__src=t}getSrc(){return this.getLatest().__src}setAltText(t){let n=this.getWritable();n.__alt=t}getAltText(){return this.getLatest().__alt}setHeight(t){let n=this.getWritable();n.__height=t}getHeight(){return this.getLatest().__height}setWidth(t){let n=this.getWritable();n.__width=t}getWidth(){return this.getLatest().__width}setAlignment(t){let n=this.getWritable();n.__alignment=t}getAlignment(){return this.getLatest().__alignment}isInline(){return!0}createDOM(t,n){let r=document.createElement("img");return r.setAttribute("src",this.__src),this.__width&&r.setAttribute("width",String(this.__width)),this.__height&&r.setAttribute("height",String(this.__height)),this.__alt&&r.setAttribute("alt",this.__alt),this.__alignment&&r.classList.add("align-"+this.__alignment),r.addEventListener("click",i=>{n.update(()=>{this.select()})}),r}updateDOM(t,n){return t.__src!==this.__src&&n.setAttribute("src",this.__src),t.__width!==this.__width&&(this.__width?n.setAttribute("width",String(this.__width)):n.removeAttribute("width")),t.__height!==this.__height&&(this.__height?n.setAttribute("height",String(this.__height)):n.removeAttribute("height")),t.__alt!==this.__alt&&(this.__alt?n.setAttribute("alt",String(this.__alt)):n.removeAttribute("alt")),t.__alignment!==this.__alignment&&(t.__alignment&&n.classList.remove("align-"+t.__alignment),this.__alignment&&n.classList.add("align-"+this.__alignment)),!1}static importDOM(){return{img(t){return{conversion:n=>{let r=n.getAttribute("src")||"",i={alt:n.getAttribute("alt")||"",height:Number.parseInt(n.getAttribute("height")||"0"),width:Number.parseInt(n.getAttribute("width")||"0")},s=new o(r,i);return s.setAlignment(vr(n)),{node:s}},priority:3}}}}exportJSON(){return{...super.exportJSON(),type:"image",version:1,src:this.__src,alt:this.__alt,height:this.__height,width:this.__width,alignment:this.__alignment}}static importJSON(t){let n=Bn(t.src,{alt:t.alt,width:t.width,height:t.height});return n.setAlignment(t.alignment),n}};function Bn(o,e={}){return new Yo(o,e)}function Nt(o){return o instanceof Yo}var Fn=class o extends Z{constructor(){super(...arguments);this.__id="";this.__summary="";this.__open=!1}static getType(){return"details"}setId(t){let n=this.getWritable();n.__id=t}getId(){return this.getLatest().__id}setSummary(t){let n=this.getWritable();n.__summary=t}getSummary(){return this.getLatest().__summary}setOpen(t){let n=this.getWritable();n.__open=t}getOpen(){return this.getLatest().__open}static clone(t){let n=new o(t.__key);return n.__id=t.__id,n.__dir=t.__dir,n.__summary=t.__summary,n.__open=t.__open,n}createDOM(t,n){let r=document.createElement("details");this.__id&&r.setAttribute("id",this.__id),this.__dir&&r.setAttribute("dir",this.__dir),this.__open&&r.setAttribute("open","true");let i=document.createElement("summary");return i.textContent=this.__summary,i.setAttribute("contenteditable","false"),i.addEventListener("click",s=>{s.preventDefault(),n.update(()=>{this.select()})}),r.append(i),r}updateDOM(t,n){return t.__open!==this.__open&&n.toggleAttribute("open",this.__open),t.__id!==this.__id||t.__dir!==this.__dir||t.__summary!==this.__summary}static importDOM(){return{details(t){return{conversion:n=>{let r=new o;n.id&&r.setId(n.id),n.dir&&r.setDirection(Dr(n));let i=Array.from(n.children).find(s=>s.nodeName==="SUMMARY");return r.setSummary(i?.textContent||""),{node:r}},priority:3}},summary(t){return{conversion:n=>({node:"ignore"}),priority:3}}}}exportDOM(t){let n=this.createDOM(t._config,t),r=n.querySelectorAll("[contenteditable]");for(let i of r)i.removeAttribute("contenteditable");return n.removeAttribute("open"),{element:n}}exportJSON(){return{...super.exportJSON(),type:"details",version:1,id:this.__id,summary:this.__summary}}static importJSON(t){let n=Wl();return n.setId(t.id),n.setDirection(t.direction),n}};function Wl(){return new Fn}function ke(o){return o instanceof Fn}function ql(o){let e=1,t=o.getParent();for(;t!=null;){if(V(t)){let n=t.getParent();if(U(n)){e++,t=n.getParent();continue}x(!1,"A ListItemNode must have a ListNode for a parent.")}return e}return e}function Yl(o){let e=o.getParent();U(e)||x(!1,"A ListItemNode must have a ListNode for a parent.");let t=e;for(;t!==null;)t=t.getParent(),U(t)&&(e=t);return e}function Zl(o){let e=[],t=o.getChildren().filter(V);for(let n=0;n<t.length;n++){let r=t[n],i=r.getFirstChild();U(i)?e=e.concat(Zl(i)):e.push(r)}return e}var m0=Symbol.for("@lexical/NestedListNodeBrand");function Hn(o){return V(o)&&U(o.getFirstChild())}function Bu(o){return Ie().append(o)}function Hu(o,e){return V(o)&&(e.length===0||e.length===1&&o.is(e[0])&&o.getChildrenSize()===0)}function Vl(o,e){o.update(()=>{let t=T();if(t!==null){let n=t.getNodes();if(_(t)){let i=t.getStartEndPoints();x(i!==null,"insertList: anchor should be defined");let[s]=i,l=s.getNode(),a=l.getParent();if(Hu(l,n)){let d=Ce(e);if(me(a)){l.replace(d);let m=Ie();d.append(m)}else if(V(l)){let m=l.getParentOrThrow();Ar(d,m.getChildren()),m.replace(d)}return}}let r=new Set;for(let i=0;i<n.length;i++){let s=n[i];if(E(s)&&s.isEmpty()&&!V(s)&&!r.has(s.getKey())){Fu(s,e);continue}if(gr(s)){let l=s.getParent();for(;l!=null;){let a=l.getKey();if(U(l)){if(!r.has(a)){let d=Ce(e);Ar(d,l.getChildren()),l.replace(d),r.add(a)}break}else{let d=l.getParent();if(me(d)&&!r.has(a)){r.add(a),Fu(l,e);break}l=d}}}}}})}function Ar(o,e){o.splice(o.getChildrenSize(),0,e)}function Fu(o,e){if(U(o))return o;let t=o.getPreviousSibling(),n=o.getNextSibling(),r=Ie();if(Ar(r,o.getChildren()),U(t)&&e===t.getListType())return t.append(r),o.remove(),U(n)&&e===n.getListType()&&(Ar(t,n.getChildren()),n.remove()),t;if(U(n)&&e===n.getListType())return n.getFirstChildOrThrow().insertBefore(r),o.remove(),n;{let i=Ce(e);return i.append(r),o.replace(i),i}}function Fi(o,e){let t=o.getLastChild(),n=e.getFirstChild();t&&n&&Hn(t)&&Hn(n)&&(Fi(t.getFirstChild(),n.getFirstChild()),n.remove());let r=e.getChildren();r.length>0&&o.append(...r),e.remove()}function Xl(o){o.update(()=>{let e=T();if(_(e)){let t=new Set,n=e.getNodes(),r=e.anchor.getNode();if(Hu(r,n))t.add(Yl(r));else for(let i=0;i<n.length;i++){let s=n[i];if(gr(s)){let l=xu(s,Jt);l!=null&&t.add(Yl(l))}}for(let i of t){let s=i,l=Zl(i);for(let a of l){let d=I();Ar(d,a.getChildren()),s.insertAfter(d),s=d,a.__key===e.anchor.key&&e.anchor.set(d.getKey(),0,"element"),a.__key===e.focus.key&&e.focus.set(d.getKey(),0,"element"),a.remove()}i.remove()}}})}function Ku(o){let e=o.getListType()!=="check",t=o.getStart();for(let n of o.getChildren())V(n)&&(n.getValue()!==t&&n.setValue(t),e&&n.getLatest().__checked!=null&&n.setChecked(void 0),U(n.getFirstChild())||t++)}function Uu(o){let e=o.getNextSibling();U(e)&&o.getListType()===e.getListType()&&Fi(o,e)}var Jt=class o extends Z{static getType(){return"listitem"}static clone(e){return new o(e.__value,e.__checked,e.__key)}constructor(e,t,n){super(n),this.__value=e===void 0?1:e,this.__checked=t}createDOM(e){let t=document.createElement("li"),n=this.getParent();return U(n)&&n.getListType()==="check"&&Wu(t,this),t.value=this.__value,zu(this)&&(t.style.listStyle="none"),t}updateDOM(e,t,n){let r=this.getParent();return U(r)&&r.getListType()==="check"&&Wu(t,this),t.style.listStyle=zu(this)?"none":"",t.value=this.__value,!1}static transform(){return e=>{if(x(V(e),"node is not a ListItemNode"),e.__checked==null)return;let t=e.getParent();U(t)&&t.getListType()!=="check"&&e.getChecked()!=null&&e.setChecked(void 0)}}static importDOM(){return{li:()=>({conversion:ox,priority:0})}}static importJSON(e){let t=Ie();return t.setChecked(e.checked),t.setValue(e.value),t.setDirection(e.direction),t}exportDOM(e){let t=this.createDOM(e._config);if(t.classList.contains("task-list-item")){let n=b("input",{type:"checkbox",disabled:"disabled"});t.hasAttribute("checked")&&(n.setAttribute("checked","checked"),t.removeAttribute("checked")),t.prepend(n)}return{element:t}}exportJSON(){return{...super.exportJSON(),checked:this.getChecked(),type:"listitem",value:this.getValue(),version:1}}append(...e){for(let t=0;t<e.length;t++){let n=e[t];if(E(n)&&this.canMergeWith(n)){let r=n.getChildren();this.append(...r),n.remove()}else super.append(n)}return this}replace(e,t){if(V(e))return super.replace(e);let n=this.getParentOrThrow();if(!U(n))return e;if(n.__first===this.getKey())n.insertBefore(e);else if(n.__last===this.getKey())n.insertAfter(e);else{let r=Ce(n.getListType()),i=this.getNextSibling();for(;i;){let s=i;i=i.getNextSibling(),r.append(s)}n.insertAfter(e),e.insertAfter(r)}return t&&(x(E(e),"includeChildren should only be true for ElementNodes"),this.getChildren().forEach(r=>{e.append(r)})),this.remove(),n.getChildrenSize()===0&&n.remove(),e}insertAfter(e,t=!0){let n=this.getParentOrThrow();if(U(n)||x(!1,"insertAfter: list node is not parent of list item node"),V(e))return super.insertAfter(e,t);let r=this.getNextSiblings();if(n.insertAfter(e,t),r.length!==0){let i=Ce(n.getListType());r.forEach(s=>i.append(s)),e.insertAfter(i,t)}return e}remove(e){let t=this.getPreviousSibling(),n=this.getNextSibling();super.remove(e),t&&n&&Hn(t)&&Hn(n)&&(Fi(t.getFirstChild(),n.getFirstChild()),n.remove())}insertNewAfter(e,t=!0){if(this.getTextContent().trim()===""&&this.isLastChild()){let r=this.getParentOrThrow(),i=r.getParent();if(V(i))return i.insertAfter(this),this.selectStart(),null;{let s=I();return r.insertAfter(s,t),this.remove(),s}}let n=Ie(this.__checked==null?void 0:!1);return this.insertAfter(n,t),n}collapseAtStart(e){let t=I();this.getChildren().forEach(l=>t.append(l));let r=this.getParentOrThrow(),i=r.getParentOrThrow(),s=V(i);if(r.getChildrenSize()===1)if(s)r.remove(),i.select();else{r.insertBefore(t),r.remove();let l=e.anchor,a=e.focus,d=t.getKey();l.type==="element"&&l.getNode().is(this)&&l.set(d,l.offset,"element"),a.type==="element"&&a.getNode().is(this)&&a.set(d,a.offset,"element")}else r.insertBefore(t),this.remove();return!0}getValue(){return this.getLatest().__value}setValue(e){let t=this.getWritable();t.__value=e}getChecked(){let e=this.getLatest(),t,n=this.getParent();return U(n)&&(t=n.getListType()),t==="check"?!!e.__checked:void 0}setChecked(e){let t=this.getWritable();t.__checked=e}toggleChecked(){this.setChecked(!this.__checked)}canInsertAfter(e){return V(e)}canReplaceWith(e){return V(e)}canMergeWith(e){return dt(e)||V(e)}extractWithChild(e,t){if(!_(t))return!1;let n=t.anchor.getNode(),r=t.focus.getNode();return this.isParentOf(n)&&this.isParentOf(r)&&this.getTextContent().length===t.getTextContent().length}isParentRequired(){return!0}createParentElementNode(){return Ce("bullet")}canMergeWhenEmpty(){return!0}};function zu(o){let e=o.getChildren(),t=!1,n=!1;for(let r of e)U(r)?n=!0:r.getTextContent().trim().length>0&&(t=!0);return n&&!t}function Wu(o,e){let t=!U(e.getFirstChild());o.classList.toggle("task-list-item",t),e.__checked?o.setAttribute("checked","checked"):o.removeAttribute("checked")}function ox(o){if(o.classList.contains("task-list-item")){for(let r of o.children)if(r.tagName==="INPUT")return nx(r)}let t=o.getAttribute("aria-checked");return{node:Ie(t==="true"?!0:t==="false"?!1:void 0)}}function nx(o){if(!(o.getAttribute("type")==="checkbox"))return{node:null};let t=o.hasAttribute("checked");return{node:Ie(t)}}function Ie(o){return ne(new Jt(void 0,o))}function V(o){return o instanceof Jt}var Zo=class o extends Z{constructor(t,n,r){super(r);this.__id="";let i=sx[t]||t;this.__listType=i,this.__tag=i==="number"?"ol":"ul",this.__start=n}static getType(){return"list"}static clone(t){let n=new o(t.__listType,t.__start,t.__key);return n.__id=t.__id,n.__dir=t.__dir,n}getTag(){return this.__tag}setId(t){let n=this.getWritable();n.__id=t}getId(){return this.getLatest().__id}setListType(t){let n=this.getWritable();n.__listType=t,n.__tag=t==="number"?"ol":"ul"}getListType(){return this.__listType}getStart(){return this.__start}createDOM(t,n){let r=this.__tag,i=document.createElement(r);return this.__start!==1&&i.setAttribute("start",String(this.__start)),i.__lexicalListType=this.__listType,qu(i,t.theme,this),this.__id&&i.setAttribute("id",this.__id),this.__dir&&i.setAttribute("dir",this.__dir),i}updateDOM(t,n,r){return t.__tag!==this.__tag||t.__dir!==this.__dir||t.__id!==this.__id?!0:(qu(n,r.theme,this),!1)}static transform(){return t=>{x(U(t),"node is not a ListNode"),Uu(t),Ku(t)}}static importDOM(){return{ol:()=>({conversion:Yu,priority:0}),ul:()=>({conversion:Yu,priority:0})}}static importJSON(t){let n=Ce(t.listType,t.start);return n.setId(t.id),n.setDirection(t.direction),n}exportDOM(t){let{element:n}=super.exportDOM(t);return n&&pe(n)&&(this.__start!==1&&n.setAttribute("start",String(this.__start)),this.__listType==="check"&&n.setAttribute("__lexicalListType","check")),{element:n}}exportJSON(){return{...super.exportJSON(),listType:this.getListType(),start:this.getStart(),tag:this.getTag(),type:"list",version:1,id:this.__id}}canBeEmpty(){return!1}canIndent(){return!1}append(...t){for(let n=0;n<t.length;n++){let r=t[n];if(V(r))super.append(r);else{let i=Ie();if(U(r))i.append(r);else if(E(r)){let s=q(r.getTextContent());i.append(s)}else i.append(r);super.append(i)}}return this}extractWithChild(t){return V(t)}};function qu(o,e,t){let n=[],r=[],i=e.list;if(i!==void 0){let s=i[`${t.__tag}Depth`]||[],l=ql(t)-1,a=l%s.length,d=s[a],m=i[t.__tag],f,c=i.nested,u=i.checklist;if(c!==void 0&&c.list&&(f=c.list),m!==void 0&&n.push(m),u!==void 0&&t.__listType==="check"&&n.push(u),d!==void 0){n.push(...yt(d));for(let p=0;p<s.length;p++)p!==a&&r.push(t.__tag+p)}if(f!==void 0){let p=yt(f);l>1?n.push(...p):r.push(...p)}}r.length>0&&Di(o,...r),n.length>0&&Te(o,...n)}function rx(o){let e=[];for(let t of o)V(t)?e.push(t):e.push(Bu(t));return e}function ix(o){if(o.getAttribute("__lexicallisttype")==="check"||o.classList.contains("contains-task-list"))return!0;for(let e of o.childNodes)if(pe(e)&&(e.hasAttribute("aria-checked")||e.classList.contains("task-list-item")||e.firstElementChild&&e.firstElementChild.matches('input[type="checkbox"]')))return!0;return!1}function Yu(o){let e=o.nodeName.toLowerCase(),t=null;if(e==="ol"){let n=o.start;t=Ce("number",n)}else e==="ul"&&(ix(o)?t=Ce("check"):t=Ce("bullet"));return o.id&&t&&t.setId(o.id),o.dir&&t&&t.setDirection(Dr(o)),{after:rx,node:t}}var sx={ol:"number",ul:"bullet"};function Ce(o,e=1){return ne(new Zo(o,e))}function U(o){return o instanceof Zo}var aL=$("INSERT_UNORDERED_LIST_COMMAND"),dL=$("INSERT_ORDERED_LIST_COMMAND"),cL=$("INSERT_CHECK_LIST_COMMAND"),uL=$("REMOVE_LIST_COMMAND");var re={BOTH:3,COLUMN:2,NO_STATUS:0,ROW:1},Qt=class o extends Z{constructor(t=re.NO_STATUS,n=1,r,i){super(i);this.__styles=new Map;this.__alignment="";this.__colSpan=n,this.__rowSpan=1,this.__headerState=t,this.__width=r,this.__backgroundColor=null}static getType(){return"tablecell"}static clone(t){let n=new o(t.__headerState,t.__colSpan,t.__width,t.__key);return n.__rowSpan=t.__rowSpan,n.__backgroundColor=t.__backgroundColor,n.__styles=new Map(t.__styles),n.__alignment=t.__alignment,n}static importDOM(){return{td:t=>({conversion:Zu,priority:0}),th:t=>({conversion:Zu,priority:0})}}static importJSON(t){let n=$e(t.headerState,t.colSpan,t.width);return t.rowSpan&&n.setRowSpan(t.rowSpan),n.setStyles(new Map(Object.entries(t.styles))),n.setAlignment(t.alignment),n}createDOM(t){let n=document.createElement(this.getTag());this.__width&&(n.style.width=`${this.__width}px`),this.__colSpan>1&&(n.colSpan=this.__colSpan),this.__rowSpan>1&&(n.rowSpan=this.__rowSpan),this.__backgroundColor!==null&&(n.style.backgroundColor=this.__backgroundColor),Te(n,t.theme.tableCell,this.hasHeader()&&t.theme.tableCellHeader);for(let[r,i]of this.__styles.entries())n.style.setProperty(r,i);return this.__alignment&&n.classList.add("align-"+this.__alignment),n}exportDOM(t){let{element:n}=super.exportDOM(t);return{element:n}}exportJSON(){return{...super.exportJSON(),backgroundColor:this.getBackgroundColor(),colSpan:this.__colSpan,headerState:this.__headerState,rowSpan:this.__rowSpan,type:"tablecell",width:this.getWidth(),styles:Object.fromEntries(this.__styles),alignment:this.__alignment}}getColSpan(){return this.__colSpan}setColSpan(t){return this.getWritable().__colSpan=t,this}getRowSpan(){return this.__rowSpan}setRowSpan(t){return this.getWritable().__rowSpan=t,this}getTag(){return this.hasHeader()?"th":"td"}setHeaderStyles(t){let n=this.getWritable();return n.__headerState=t,this.__headerState}getHeaderStyles(){return this.getLatest().__headerState}setWidth(t){let n=this.getWritable();return n.__width=t,this.__width}getWidth(){return this.getLatest().__width}clearWidth(){let t=this.getWritable();t.__width=void 0}getStyles(){let t=this.getLatest();return new Map(t.__styles)}setStyles(t){let n=this.getWritable();n.__styles=new Map(t)}setAlignment(t){let n=this.getWritable();n.__alignment=t}getAlignment(){return this.getLatest().__alignment}updateTag(t){let r=t.toLowerCase()==="th"?re.ROW:re.NO_STATUS,i=this.getWritable();i.__headerState=r}getBackgroundColor(){return this.getLatest().__backgroundColor}setBackgroundColor(t){this.getWritable().__backgroundColor=t}toggleHeaderStyle(t){let n=this.getWritable();return(n.__headerState&t)===t?n.__headerState-=t:n.__headerState+=t,n}hasHeaderState(t){return(this.getHeaderStyles()&t)===t}hasHeader(){return this.getLatest().__headerState!==re.NO_STATUS}updateDOM(t){return t.__headerState!==this.__headerState||t.__width!==this.__width||t.__colSpan!==this.__colSpan||t.__rowSpan!==this.__rowSpan||t.__backgroundColor!==this.__backgroundColor||t.__styles!==this.__styles||t.__alignment!==this.__alignment}isShadowRoot(){return!0}collapseAtStart(){return!0}canBeEmpty(){return!1}canIndent(){return!1}};function Zu(o){let e=o,t=o.nodeName.toLowerCase(),n;/^(\d+(?:\.\d+)?)px$/.test(e.style.width)&&(n=parseFloat(e.style.width));let i=$e(t==="th"?re.ROW:re.NO_STATUS,e.colSpan,n);i.__rowSpan=e.rowSpan;let s=e.style,l=s.textDecoration.split(" "),a=s.fontWeight==="700"||s.fontWeight==="bold",d=l.includes("line-through"),m=s.fontStyle==="italic",f=l.includes("underline");return o instanceof HTMLElement&&(i.setStyles(Dn(o)),i.setAlignment(vr(o))),{after:c=>(c.length===0&&c.push(I()),c),forChild:(c,u)=>{if(v(u)&&!E(c)){let p=I();return ve(c)&&c.getTextContent()===`
`?null:(y(c)&&(a&&c.toggleFormat("bold"),d&&c.toggleFormat("strikethrough"),m&&c.toggleFormat("italic"),f&&c.toggleFormat("underline")),p.append(c),p)}return c},node:i}}function $e(o=re.NO_STATUS,e=1,t){return ne(new Qt(o,e,t))}function v(o){return o instanceof Qt}var lx=$("INSERT_TABLE_COMMAND");var eo=class o extends Z{constructor(t){super(t);this.__styles=new Map}static getType(){return"tablerow"}static clone(t){let n=new o(t.__key);return n.__styles=new Map(t.__styles),n}static importDOM(){return{tr:t=>({conversion:ax,priority:0})}}static importJSON(t){let n=Vo();return n.setStyles(new Map(Object.entries(t.styles))),n}exportJSON(){return{...super.exportJSON(),type:"tablerow",version:1,styles:Object.fromEntries(this.__styles),height:this.__height||0}}createDOM(t){let n=document.createElement("tr");this.__height&&(n.style.height=`${this.__height}px`);for(let[r,i]of this.__styles.entries())n.style.setProperty(r,i);return Te(n,t.theme.tableRow),n}isShadowRoot(){return!0}getStyles(){let t=this.getLatest();return new Map(t.__styles)}setStyles(t){let n=this.getWritable();n.__styles=new Map(t)}setHeight(t){let n=this.getWritable();return n.__height=t,this.__height}getHeight(){return this.getLatest().__height}updateDOM(t){return t.__height!==this.__height||t.__styles!==this.__styles}canBeEmpty(){return!1}canIndent(){return!1}};function ax(o){let e=Vo(),n=Wo(o.style.height);return e.setHeight(n),o instanceof HTMLElement&&e.setStyles(Dn(o)),{node:e}}function Vo(){return ne(new eo)}function Q(o){return o instanceof eo}function jl(o,e,t=!0){let n=kr();for(let r=0;r<o;r++){let i=Vo();for(let s=0;s<e;s++){let l=re.NO_STATUS;typeof t=="object"?(r===0&&t.rows&&(l|=re.ROW),s===0&&t.columns&&(l|=re.COLUMN)):t&&(r===0&&(l|=re.ROW),s===0&&(l|=re.COLUMN));let a=$e(l),d=I();d.append(q()),a.append(d),i.append(a)}n.append(i)}return n}var Gl=(o,e)=>o===re.BOTH||o===e?e:re.NO_STATUS;function Hi(o=!0){let e=T();x(_(e)||z(e),"Expected a RangeSelection or TableSelection");let t=e.focus.getNode(),[n,,r]=Le(t),[i,s]=tt(r,n,n),l=i[0].length,{startRow:a}=s;if(o){let d=a+n.__rowSpan-1,m=i[d],f=Vo();for(let u=0;u<l;u++){let{cell:p,startRow:g}=m[u];if(g+p.__rowSpan-1<=d){let C=m[u].cell.__headerState,N=Gl(C,re.COLUMN);f.append($e(N).append(I()))}else p.setRowSpan(p.__rowSpan+1)}let c=r.getChildAtIndex(d);x(Q(c),"focusEndRow is not a TableRowNode"),c.insertAfter(f)}else{let d=i[a],m=Vo();for(let c=0;c<l;c++){let{cell:u,startRow:p}=d[c];if(p===a){let h=d[c].cell.__headerState,C=Gl(h,re.COLUMN);m.append($e(C).append(I()))}else u.setRowSpan(u.__rowSpan+1)}let f=r.getChildAtIndex(a);x(Q(f),"focusEndRow is not a TableRowNode"),f.insertBefore(m)}}function Ki(o=!0){let e=T();x(_(e)||z(e),"Expected a RangeSelection or TableSelection");let t=e.anchor.getNode(),n=e.focus.getNode(),[r]=Le(t),[i,,s]=Le(n),[l,a,d]=tt(s,i,r),m=l.length,f=o?Math.max(a.startColumn,d.startColumn):Math.min(a.startColumn,d.startColumn),c=o?f+i.__colSpan-1:f-1,u=s.getFirstChild();x(Q(u),"Expected firstTable child to be a row");let p=null;function g(C=re.NO_STATUS){let N=$e(C).append(I());return p===null&&(p=N),N}let h=u;e:for(let C=0;C<m;C++){if(C!==0){let R=h.getNextSibling();x(Q(R),"Expected row nextSibling to be a row"),h=R}let N=l[C],L=N[c<0?0:c].cell.__headerState,M=Gl(L,re.ROW);if(c<0){ea(h,g(M));continue}let{cell:S,startColumn:A,startRow:O}=N[c];if(A+S.__colSpan-1<=c){let R=S,P=O,k=c;for(;P!==C&&R.__rowSpan>1;)if(k-=S.__colSpan,k>=0){let{cell:W,startRow:ie}=N[k];R=W,P=ie}else{h.append(g(M));continue e}R.insertAfter(g(M))}else S.setColSpan(S.__colSpan+1)}p!==null&&Rr(p)}function Jl(){let o=T();x(_(o)||z(o),"Expected a RangeSelection or TableSelection");let e=o.anchor.getNode(),t=o.focus.getNode(),[n,,r]=Le(e),[i]=Le(t),[s,l,a]=tt(r,n,i),{startRow:d}=l,{startRow:m}=a,f=m+i.__rowSpan-1;if(s.length===f-d+1){r.remove();return}let c=s[0].length,u=s[f+1],p=r.getChildAtIndex(f+1);for(let g=f;g>=d;g--){for(let C=c-1;C>=0;C--){let{cell:N,startRow:L,startColumn:M}=s[g][C];if(M===C&&(g===d&&L<d&&N.setRowSpan(N.__rowSpan-(L-d)),L>=d&&L+N.__rowSpan-1>f))if(N.setRowSpan(N.__rowSpan-(f-L+1)),x(p!==null,"Expected nextRowNode not to be null"),C===0)ea(p,N);else{let{cell:S}=u[C-1];S.insertAfter(N)}}let h=r.getChildAtIndex(g);x(Q(h),"Expected GridNode childAtIndex(%s) to be RowNode",String(g)),h.remove()}if(u!==void 0){let{cell:g}=u[0];Rr(g)}else{let g=s[d-1],{cell:h}=g[0];Rr(h)}}function Ql(){let o=T();x(_(o)||z(o),"Expected a RangeSelection or TableSelection");let e=o.anchor.getNode(),t=o.focus.getNode(),[n,,r]=Le(e),[i]=Le(t),[s,l,a]=tt(r,n,i),{startColumn:d}=l,{startRow:m,startColumn:f}=a,c=Math.min(d,f),u=Math.max(d+n.__colSpan-1,f+i.__colSpan-1),p=u-c+1;if(s[0].length===u-c+1){r.selectPrevious(),r.remove();return}let h=s.length;for(let L=0;L<h;L++)for(let M=c;M<=u;M++){let{cell:S,startColumn:A}=s[L][M];if(A<c){if(M===c){let O=c-A;S.setColSpan(S.__colSpan-Math.min(p,S.__colSpan-O))}}else if(A+S.__colSpan-1>u){if(M===u){let O=u-A+1;S.setColSpan(S.__colSpan-O)}}else S.remove()}let C=s[m],N=d>f?C[d+n.__colSpan]:C[f+i.__colSpan];if(N!==void 0){let{cell:L}=N;Rr(L)}else{let L=f<d?C[f-1]:C[d-1],{cell:M}=L;Rr(M)}}function Rr(o){let e=o.getFirstDescendant();e==null?o.selectStart():e.getParentOrThrow().selectStart()}function ea(o,e){let t=o.getFirstChild();t!==null?t.insertBefore(e):o.append(e)}function ta(){let o=T();x(_(o)||z(o),"Expected a RangeSelection or TableSelection");let e=o.anchor.getNode(),[t,n,r]=Le(e),i=t.__colSpan,s=t.__rowSpan;if(i>1){for(let l=1;l<i;l++)t.insertAfter($e(re.NO_STATUS).append(I()));t.setColSpan(1)}if(s>1){let[l,a]=tt(r,t,t),{startColumn:d,startRow:m}=a,f;for(let c=1;c<s;c++){let u=m+c,p=l[u];f=(f||n).getNextSibling(),x(Q(f),"Expected row next sibling to be a row");let g=null;for(let h=0;h<d;h++){let C=p[h],N=C.cell;C.startRow===u&&(g=N),N.__colSpan>1&&(h+=N.__colSpan-1)}if(g===null)for(let h=0;h<i;h++)ea(f,$e(re.NO_STATUS).append(I()));else for(let h=0;h<i;h++)g.insertAfter($e(re.NO_STATUS).append(I()))}t.setRowSpan(1)}}function tt(o,e,t){let[n,r,i]=Vu(o,e,t);return x(r!==null,"Anchor not found in Grid"),x(i!==null,"Focus not found in Grid"),[n,r,i]}function Vu(o,e,t){let n=[],r=null,i=null;function s(d,m,f){let c={cell:f,startColumn:m,startRow:d},u=f.__rowSpan,p=f.__colSpan;for(let g=0;g<u;g++){n[d+g]===void 0&&(n[d+g]=[]);for(let h=0;h<p;h++)n[d+g][m+h]=c}e!==null&&e.is(f)&&(r=c),t!==null&&t.is(f)&&(i=c)}function l(d,m){return n[d]===void 0||n[d][m]===void 0}let a=o.getChildren();for(let d=0;d<a.length;d++){let m=a[d];x(Q(m),"Expected GridNode children to be TableRowNode");let f=m.getChildren(),c=0;for(let u of f){for(x(v(u),"Expected TableRowNode children to be TableCellNode");!l(d,c);)c++;s(d,c,u),c+=u.__colSpan}}return[n,r,i]}function Le(o){let e;if(o instanceof Qt)e=o;else if("__type"in o){let r=H(o,v);x(v(r),"Expected to find a parent TableCellNode"),e=r}else{let r=H(o.getNode(),v);x(v(r),"Expected to find a parent TableCellNode"),e=r}let t=e.getParent();x(Q(t),"Expected TableCellNode to have a parent TableRowNode");let n=t.getParent();return x(K(n),"Expected TableRowNode to have a parent GridNode"),[e,t,n]}function Ui(o){let[e,,t]=Le(o),n=t.getChildren(),r=n.length,i=n[0].getChildren().length,s=new Array(r);for(let l=0;l<r;l++)s[l]=new Array(i);for(let l=0;l<r;l++){let d=n[l].getChildren(),m=0;for(let f=0;f<d.length;f++){for(;s[l][m];)m++;let c=d[f],u=c.__rowSpan||1,p=c.__colSpan||1;for(let g=0;g<u;g++)for(let h=0;h<p;h++)s[l+g][m+h]=c;if(e===c)return{colSpan:p,columnIndex:m,rowIndex:l,rowSpan:u};m+=p}}return null}var zi=class o{constructor(e,t,n){this.anchor=t,this.focus=n,t._selection=this,n._selection=this,this._cachedNodes=null,this.dirty=!1,this.tableKey=e}getStartEndPoints(){return[this.anchor,this.focus]}isBackward(){return this.focus.isBefore(this.anchor)}getCachedNodes(){return this._cachedNodes}setCachedNodes(e){this._cachedNodes=e}is(e){return z(e)?this.tableKey===e.tableKey&&this.anchor.is(e.anchor)&&this.focus.is(e.focus):!1}set(e,t,n){this.dirty=!0,this.tableKey=e,this.anchor.key=t,this.focus.key=n,this._cachedNodes=null}clone(){return new o(this.tableKey,this.anchor,this.focus)}isCollapsed(){return!1}extract(){return this.getNodes()}insertRawText(e){}insertText(){}insertNodes(e){let t=this.focus.getNode();x(E(t),"Expected TableSelection focus to be an ElementNode"),Ao(t.select(0,t.getChildrenSize())).insertNodes(e)}getShape(){let e=J(this.anchor.key);x(v(e),"Expected TableSelection anchor to be (or a child of) TableCellNode");let t=Ui(e);x(t!==null,"getCellRect: expected to find AnchorNode");let n=J(this.focus.key);x(v(n),"Expected TableSelection focus to be (or a child of) TableCellNode");let r=Ui(n);x(r!==null,"getCellRect: expected to find focusCellNode");let i=Math.min(t.columnIndex,r.columnIndex),s=Math.max(t.columnIndex,r.columnIndex),l=Math.min(t.rowIndex,r.rowIndex),a=Math.max(t.rowIndex,r.rowIndex);return{fromX:Math.min(i,s),fromY:Math.min(l,a),toX:Math.max(i,s),toY:Math.max(l,a)}}getNodes(){let e=this._cachedNodes;if(e!==null)return e;let t=this.anchor.getNode(),n=this.focus.getNode(),r=H(t,v),i=H(n,v);x(v(r),"Expected TableSelection anchor to be (or a child of) TableCellNode"),x(v(i),"Expected TableSelection focus to be (or a child of) TableCellNode");let s=r.getParent();x(Q(s),"Expected anchorCell to have a parent TableRowNode");let l=s.getParent();x(K(l),"Expected tableNode to have a parent TableNode");let a=i.getParents()[1];if(a!==l){if(l.isParentOf(i)){let O=a.getParent();x(O!=null,"Expected focusCellParent to have a parent"),this.set(this.tableKey,i.getKey(),O.getKey())}else{let O=l.getParent();x(O!=null,"Expected gridParent to have a parent"),this.set(this.tableKey,O.getKey(),i.getKey())}return this.getNodes()}let[d,m,f]=tt(l,r,i),c=Math.min(m.startColumn,f.startColumn),u=Math.min(m.startRow,f.startRow),p=Math.max(m.startColumn+m.cell.__colSpan-1,f.startColumn+f.cell.__colSpan-1),g=Math.max(m.startRow+m.cell.__rowSpan-1,f.startRow+f.cell.__rowSpan-1),h=c,C=u,N=c,L=u;function M(O){let{cell:R,startColumn:P,startRow:k}=O;c=Math.min(c,P),u=Math.min(u,k),p=Math.max(p,P+R.__colSpan-1),g=Math.max(g,k+R.__rowSpan-1)}for(;c<h||u<C||p>N||g>L;){if(c<h){let O=L-C,R=h-1;for(let P=0;P<=O;P++)M(d[C+P][R]);h=R}if(u<C){let O=N-h,R=C-1;for(let P=0;P<=O;P++)M(d[R][h+P]);C=R}if(p>N){let O=L-C,R=N+1;for(let P=0;P<=O;P++)M(d[C+P][R]);N=R}if(g>L){let O=N-h,R=L+1;for(let P=0;P<=O;P++)M(d[R][h+P]);L=R}}let S=[l],A=null;for(let O=u;O<=g;O++)for(let R=c;R<=p;R++){let{cell:P}=d[O][R],k=P.getParent();x(Q(k),"Expected TableCellNode parent to be a TableRowNode"),k!==A&&S.push(k),S.push(P,...dx(P)),A=k}return st()||(this._cachedNodes=S),S}getTextContent(){let e=this.getNodes().filter(n=>v(n)),t="";for(let n=0;n<e.length;n++){let r=e[n],i=r.__parent,s=(e[n+1]||{}).__parent;t+=r.getTextContent()+(s!==i?`
`:"	")}return t}};function z(o){return o instanceof zi}function Wi(){let o=De("root",0,"element"),e=De("root",0,"element");return new zi("root",o,e)}function dx(o){let e=[],t=[o];for(;t.length>0;){let n=t.pop();x(n!==void 0,"Stack.length > 0; can't be undefined"),E(n)&&t.unshift(...n.getChildren()),n!==o&&e.push(n)}return e}var $r=class{constructor(e,t){this.isHighlightingCells=!1,this.anchorX=-1,this.anchorY=-1,this.focusX=-1,this.focusY=-1,this.listenersToRemove=new Set,this.tableNodeKey=t,this.editor=e,this.table={columns:0,domRows:[],rows:0},this.tableSelection=null,this.anchorCellNodeKey=null,this.focusCellNodeKey=null,this.anchorCell=null,this.focusCell=null,this.hasHijackedSelectionStyles=!1,this.trackTable(),this.isSelecting=!1}getTable(){return this.table}removeListeners(){Array.from(this.listenersToRemove).forEach(e=>e())}trackTable(){let e=new MutationObserver(t=>{this.editor.update(()=>{let n=!1;for(let i=0;i<t.length;i++){let a=t[i].target.nodeName;if(a==="TABLE"||a==="TBODY"||a==="THEAD"||a==="TR"){n=!0;break}}if(!n)return;let r=this.editor.getElementByKey(this.tableNodeKey);if(!r)throw new Error("Expected to find TableElement in DOM");this.table=Xo(r)})});this.editor.update(()=>{let t=this.editor.getElementByKey(this.tableNodeKey);if(!t)throw new Error("Expected to find TableElement in DOM");this.table=Xo(t),e.observe(t,{attributes:!0,childList:!0,subtree:!0})})}clearHighlight(){let e=this.editor;this.isHighlightingCells=!1,this.anchorX=-1,this.anchorY=-1,this.focusX=-1,this.focusY=-1,this.tableSelection=null,this.anchorCellNodeKey=null,this.focusCellNodeKey=null,this.anchorCell=null,this.focusCell=null,this.hasHijackedSelectionStyles=!1,this.enableHighlightStyle(),e.update(()=>{let t=J(this.tableNodeKey);if(!K(t))throw new Error("Expected TableNode.");let n=e.getElementByKey(this.tableNodeKey);if(!n)throw new Error("Expected to find TableElement in DOM");let r=Xo(n);Ir(e,r,null),Y(null),e.dispatchCommand(we,void 0)})}enableHighlightStyle(){let e=this.editor;e.update(()=>{let t=e.getElementByKey(this.tableNodeKey);if(!t)throw new Error("Expected to find TableElement in DOM");Di(t,e._config.theme.tableSelection),t.classList.remove("disable-selection"),this.hasHijackedSelectionStyles=!1})}disableHighlightStyle(){let e=this.editor;e.update(()=>{let t=e.getElementByKey(this.tableNodeKey);if(!t)throw new Error("Expected to find TableElement in DOM");Te(t,e._config.theme.tableSelection),this.hasHijackedSelectionStyles=!0})}updateTableTableSelection(e){if(e!==null&&e.tableKey===this.tableNodeKey){let t=this.editor;this.tableSelection=e,this.isHighlightingCells=!0,this.disableHighlightStyle(),Ir(t,this.table,this.tableSelection)}else e==null?this.clearHighlight():(this.tableNodeKey=e.tableKey,this.updateTableTableSelection(e))}setFocusCellForSelection(e,t=!1){let n=this.editor;n.update(()=>{let r=J(this.tableNodeKey);if(!K(r))throw new Error("Expected TableNode.");if(!n.getElementByKey(this.tableNodeKey))throw new Error("Expected to find TableElement in DOM");let s=e.x,l=e.y;if(this.focusCell=e,this.anchorCell!==null){let a=oa(n._window);a&&a.setBaseAndExtent(this.anchorCell.elem,0,this.focusCell.elem,0)}if(!this.isHighlightingCells&&(this.anchorX!==s||this.anchorY!==l||t))this.isHighlightingCells=!0,this.disableHighlightStyle();else if(s===this.focusX&&l===this.focusY)return;if(this.focusX=s,this.focusY=l,this.isHighlightingCells){let a=ee(e.elem);if(this.tableSelection!=null&&this.anchorCellNodeKey!=null&&v(a)&&r.is(bo(a))){let d=a.getKey();this.tableSelection=this.tableSelection.clone()||Wi(),this.focusCellNodeKey=d,this.tableSelection.set(this.tableNodeKey,this.anchorCellNodeKey,this.focusCellNodeKey),Y(this.tableSelection),n.dispatchCommand(we,void 0),Ir(n,this.table,this.tableSelection)}}})}setAnchorCellForSelection(e){this.isHighlightingCells=!1,this.anchorCell=e,this.anchorX=e.x,this.anchorY=e.y,this.editor.update(()=>{let t=ee(e.elem);if(v(t)){let n=t.getKey();this.tableSelection=this.tableSelection!=null?this.tableSelection.clone():Wi(),this.anchorCellNodeKey=n}})}formatCells(e){this.editor.update(()=>{let t=T();z(t)||x(!1,"Expected grid selection");let n=Uo(),r=n.anchor,i=n.focus;t.getNodes().forEach(s=>{v(s)&&s.getTextContentSize()!==0&&(r.set(s.getKey(),0,"element"),i.set(s.getKey(),s.getChildrenSize(),"element"),n.formatText(e))}),Y(t),this.editor.dispatchCommand(we,void 0)})}clearText(){let e=this.editor;e.update(()=>{let t=J(this.tableNodeKey);if(!K(t))throw new Error("Expected TableNode.");let n=T();z(n)||x(!1,"Expected grid selection");let r=n.getNodes().filter(v);if(r.length===this.table.columns*this.table.rows){t.selectPrevious(),t.remove(),F().selectStart();return}r.forEach(i=>{if(E(i)){let s=I(),l=q();s.append(l),i.append(s),i.getChildren().forEach(a=>{a!==s&&a.remove()})}}),Ir(e,this.table,null),Y(null),e.dispatchCommand(we,void 0)})}};var cx="__lexicalTableSelection",oa=o=>fe?(o||window).getSelection():null,ux=o=>(o.buttons&1)===1;function ia(o,e,t,n){let r=t.getRootElement();if(r===null)throw new Error("No root element.");let i=new $r(t,o.getKey()),s=t._window||window;fx(e,i);let l=()=>{let c=()=>{i.isSelecting=!1,s.removeEventListener("mouseup",c),s.removeEventListener("mousemove",u)},u=p=>{setTimeout(()=>{if(!ux(p)&&i.isSelecting){i.isSelecting=!1,s.removeEventListener("mouseup",c),s.removeEventListener("mousemove",u);return}let g=ra(p.target);g!==null&&(i.anchorX!==g.x||i.anchorY!==g.y)&&(p.preventDefault(),i.setFocusCellForSelection(g))},0)};return{onMouseMove:u,onMouseUp:c}};e.addEventListener("mousedown",c=>{setTimeout(()=>{if(c.button!==0||!s)return;let u=ra(c.target);u!==null&&(jo(c),i.setAnchorCellForSelection(u));let{onMouseUp:p,onMouseMove:g}=l();i.isSelecting=!0,s.addEventListener("mouseup",p),s.addEventListener("mousemove",g)},0)});let a=c=>{c.button===0&&t.update(()=>{let u=T(),p=c.target;z(u)&&u.tableKey===i.tableNodeKey&&r.contains(p)&&i.clearHighlight()})};s.addEventListener("mousedown",a),i.listenersToRemove.add(()=>s.removeEventListener("mousedown",a)),i.listenersToRemove.add(t.registerCommand(Ft,c=>Pr(t,c,"down",o,i),We)),i.listenersToRemove.add(t.registerCommand(Bt,c=>Pr(t,c,"up",o,i),We)),i.listenersToRemove.add(t.registerCommand(wo,c=>Pr(t,c,"backward",o,i),We)),i.listenersToRemove.add(t.registerCommand(Mo,c=>Pr(t,c,"forward",o,i),We)),i.listenersToRemove.add(t.registerCommand(vo,c=>{let u=T();if(z(u)){let p=H(u.focus.getNode(),v);if(v(p))return jo(c),p.selectEnd(),!0}return!1},We));let d=c=>()=>{let u=T();if(!Go(u,o))return!1;if(z(u))return i.clearText(),!0;if(_(u)){let p=H(u.anchor.getNode(),A=>v(A));if(!v(p))return!1;let g=u.anchor.getNode(),h=u.focus.getNode(),C=o.isParentOf(g),N=o.isParentOf(h);if(C&&!N||N&&!C)return i.clearText(),!0;let M=H(u.anchor.getNode(),A=>E(A)),S=M&&H(M,A=>E(A)&&v(A.getParent()));if(!E(S)||!E(M))return!1;if(c===it&&S.getPreviousSibling()===null)return!0}return!1};[Ct,it,Ye].forEach(c=>{i.listenersToRemove.add(t.registerCommand(c,d(c),Re))});let m=c=>{let u=T();if(!Go(u,o)){let p=u?u.getNodes():null;if(p){let g=p.find(h=>K(h)&&h.getKey()===i.tableNodeKey);if(K(g)){if(!g.getParent())return!1;g.remove()}}return!1}if(z(u))return c&&(c.preventDefault(),c.stopPropagation()),i.clearText(),!0;if(_(u)){let p=H(u.anchor.getNode(),g=>v(g));if(!v(p))return!1}return!1};i.listenersToRemove.add(t.registerCommand(Ht,m,Re)),i.listenersToRemove.add(t.registerCommand(Kt,m,Re)),i.listenersToRemove.add(t.registerCommand(ao,c=>{let u=T();if(u){if(!(z(u)||_(u)))return!1;In(t,pt(c,ClipboardEvent)?c:null,Ii(u));let p=m(c);return _(u)&&u.removeText(),p}return!1},Re)),i.listenersToRemove.add(t.registerCommand(Ne,c=>{let u=T();if(!Go(u,o))return!1;if(z(u))return i.formatCells(c),!0;if(_(u)){let p=H(u.anchor.getNode(),g=>v(g));if(!v(p))return!1}return!1},Re)),i.listenersToRemove.add(t.registerCommand(rt,c=>{let u=T();if(!Go(u,o))return!1;if(z(u))return i.clearHighlight(),!1;if(_(u)){let p=H(u.anchor.getNode(),g=>v(g));if(!v(p))return!1;if(typeof c=="string"){let g=ju(t,u,o);if(g)return Gu(g,o,[q(c)]),!0}}return!1},Re)),n&&i.listenersToRemove.add(t.registerCommand(Do,c=>{let u=T();if(!_(u)||!u.isCollapsed()||!Go(u,o))return!1;let p=Yi(u.anchor.getNode());if(p===null)return!1;jo(c);let g=o.getCordsFromCellNode(p,i.table);return Ju(i,o,g.x,g.y,c.shiftKey?"backward":"forward"),!0},Re)),i.listenersToRemove.add(t.registerCommand(ir,c=>o.isSelected(),We));function f(c){let u=o.getCordsFromCellNode(c,i.table);return o.getDOMCellFromCordsOrThrow(u.x,u.y,i.table)}return i.listenersToRemove.add(t.registerCommand(er,c=>{let{nodes:u,selection:p}=c,g=p.getStartEndPoints(),h=z(p),N=_(p)&&H(p.anchor.getNode(),Pe=>v(Pe))!==null&&H(p.focus.getNode(),Pe=>v(Pe))!==null||h;if(u.length!==1||!K(u[0])||!N||g===null)return!1;let[L]=g,M=u[0],S=M.getChildren(),A=M.getFirstChildOrThrow().getChildrenSize(),O=M.getChildrenSize(),R=H(L.getNode(),Pe=>v(Pe)),P=R&&H(R,Pe=>Q(Pe)),k=P&&H(P,Pe=>K(Pe));if(!v(R)||!Q(P)||!K(k))return!1;let W=P.getIndexWithinParent(),ie=Math.min(k.getChildrenSize()-1,W+O-1),an=R.getIndexWithinParent(),td=Math.min(P.getChildrenSize()-1,an+A-1),ah=Math.min(an,td),dh=Math.min(W,ie),ch=Math.max(an,td),uh=Math.max(W,ie),fh=k.getChildren(),od=0;for(let Pe=dh;Pe<=uh;Pe++){let nd=fh[Pe];if(!Q(nd))return!1;let rd=S[od];if(!Q(rd))return!1;let mh=nd.getChildren(),ph=rd.getChildren(),id=0;for(let vs=ah;vs<=ch;vs++){let Jr=mh[vs];if(!v(Jr))return!1;let sd=ph[id];if(!v(sd))return!1;let gh=Jr.getChildren();sd.getChildren().forEach(dn=>{y(dn)&&I().append(dn),Jr.append(dn)}),gh.forEach(dn=>dn.remove()),id++}od++}return!0},Re)),i.listenersToRemove.add(t.registerCommand(we,()=>{let c=T(),u=ze();if(_(c)){let{anchor:p,focus:g}=c,h=p.getNode(),C=g.getNode(),N=Yi(h),L=Yi(C),M=!!(N&&o.is(bo(N))),S=!!(L&&o.is(bo(L))),A=M!==S,O=M&&S,R=c.isBackward();if(A){let P=c.clone();if(S){let[k]=tt(o,L,L),W=k[0][0].cell,ie=k[k.length-1].at(-1).cell;P.focus.set(R?W.getKey():ie.getKey(),R?W.getChildrenSize():ie.getChildrenSize(),"element")}Y(P),Xu(t,i)}else O&&(N.is(L)||(i.setAnchorCellForSelection(f(N)),i.setFocusCellForSelection(f(L),!0),i.isSelecting||setTimeout(()=>{let{onMouseUp:P,onMouseMove:k}=l();i.isSelecting=!0,s.addEventListener("mouseup",P),s.addEventListener("mousemove",k)},0)))}else if(c&&z(c)&&c.is(u)&&c.tableKey===o.getKey()){let p=oa(t._window);if(p&&p.anchorNode&&p.focusNode){let g=ee(p.focusNode),h=g&&!o.is(bo(g)),C=ee(p.anchorNode),N=C&&o.is(bo(C));if(h&&N&&p.rangeCount>0){let L=wl(p,t);L&&(L.anchor.set(o.getKey(),c.isBackward()?o.getChildrenSize():0,"element"),p.removeAllRanges(),Y(L))}}}return c&&!c.is(u)&&(z(c)||z(u))&&i.tableSelection&&!i.tableSelection.is(u)?(z(c)&&c.tableKey===i.tableNodeKey?i.updateTableTableSelection(c):!z(c)&&z(u)&&u.tableKey===i.tableNodeKey&&i.updateTableTableSelection(null),!1):(i.hasHijackedSelectionStyles&&!o.isSelected()?mx(t,i):!i.hasHijackedSelectionStyles&&o.isSelected()&&Xu(t,i),!1)},Re)),i.listenersToRemove.add(t.registerCommand(Pt,()=>{let c=T();if(!_(c)||!c.isCollapsed()||!Go(c,o))return!1;let u=ju(t,c,o);return u?(Gu(u,o),!0):!1},Re)),i}function fx(o,e){o[cx]=e}function ra(o){let e=o;for(;e!=null;){let t=e.nodeName;if(t==="TD"||t==="TH"){let n=e._cell;return n===void 0?null:n}e=e.parentNode}return null}function Xo(o){let e=[],t={columns:0,domRows:e,rows:0},n=o.firstChild,r=0,i=0;for(e.length=0;n!=null;){let s=n.nodeName;if(s==="TD"||s==="TH"){let d=n,m={elem:d,hasBackgroundColor:d.style.backgroundColor!=="",highlighted:!1,x:r,y:i};n._cell=m;let f=e[i];f===void 0&&(f=e[i]=[]),f[r]=m}else{let d=n.firstChild;if(d!=null){n=d;continue}}let l=n.nextSibling;if(l!=null){r++,n=l;continue}let a=n.parentNode;if(a!=null){let d=a.nextSibling;if(d==null)break;i++,r=0,n=d}}return t.columns=r+1,t.rows=i+1,t}function Ir(o,e,t){let n=new Set(t?t.getNodes():[]);sa(e,(r,i)=>{let s=r.elem;n.has(i)?(r.highlighted=!0,Qu(o,r)):(r.highlighted=!1,ef(o,r),s.getAttribute("style")||s.removeAttribute("style"))})}function sa(o,e){let{domRows:t}=o;for(let n=0;n<t.length;n++){let r=t[n];if(r)for(let i=0;i<r.length;i++){let s=r[i];if(!s)continue;let l=ee(s.elem);l!==null&&e(s,l,{x:i,y:n})}}}function Xu(o,e){e.disableHighlightStyle(),sa(e.table,t=>{t.highlighted=!0,Qu(o,t)})}function mx(o,e){e.enableHighlightStyle(),sa(e.table,t=>{let n=t.elem;t.highlighted=!1,ef(o,t),n.getAttribute("style")||n.removeAttribute("style")})}var Ju=(o,e,t,n,r)=>{let i=r==="forward";switch(r){case"backward":case"forward":return t!==(i?o.table.columns-1:0)?qi(e.getCellNodeFromCordsOrThrow(t+(i?1:-1),n,o.table),i):n!==(i?o.table.rows-1:0)?qi(e.getCellNodeFromCordsOrThrow(i?0:o.table.columns-1,n+(i?1:-1),o.table),i):i?e.selectNext():e.selectPrevious(),!0;case"up":return n!==0?qi(e.getCellNodeFromCordsOrThrow(t,n-1,o.table),!1):e.selectPrevious(),!0;case"down":return n!==o.table.rows-1?qi(e.getCellNodeFromCordsOrThrow(t,n+1,o.table),!0):e.selectNext(),!0;default:return!1}},px=(o,e,t,n,r)=>{let i=r==="forward";switch(r){case"backward":case"forward":return t!==(i?o.table.columns-1:0)&&o.setFocusCellForSelection(e.getDOMCellFromCordsOrThrow(t+(i?1:-1),n,o.table)),!0;case"up":return n!==0?(o.setFocusCellForSelection(e.getDOMCellFromCordsOrThrow(t,n-1,o.table)),!0):!1;case"down":return n!==o.table.rows-1?(o.setFocusCellForSelection(e.getDOMCellFromCordsOrThrow(t,n+1,o.table)),!0):!1;default:return!1}};function Go(o,e){if(_(o)||z(o)){let t=e.isParentOf(o.anchor.getNode()),n=e.isParentOf(o.focus.getNode());return t&&n}return!1}function qi(o,e){e?o.selectStart():o.selectEnd()}var na="172,206,247";function Qu(o,e){let t=e.elem,n=ee(t);x(v(n),"Expected to find LexicalNode from Table Cell DOMNode"),n.getBackgroundColor()===null?t.style.setProperty("background-color",`rgb(${na})`):t.style.setProperty("background-image",`linear-gradient(to right, rgba(${na},0.85), rgba(${na},0.85))`),t.style.setProperty("caret-color","transparent")}function ef(o,e){let t=e.elem,n=ee(t);x(v(n),"Expected to find LexicalNode from Table Cell DOMNode"),n.getBackgroundColor()===null&&t.style.removeProperty("background-color"),t.style.removeProperty("background-image"),t.style.removeProperty("caret-color")}function Yi(o){let e=H(o,v);return v(e)?e:null}function bo(o){let e=H(o,K);return K(e)?e:null}function Pr(o,e,t,n,r){if((t==="up"||t==="down")&&gx(o))return!1;let i=T();if(!Go(i,n)){if(_(i)){if(i.isCollapsed()&&t==="backward"){let s=i.anchor.type,l=i.anchor.offset;if(s!=="element"&&!(s==="text"&&l===0))return!1;let a=i.anchor.getNode();if(!a)return!1;let d=H(a,f=>E(f)&&!f.isInline());if(!d)return!1;let m=d.getPreviousSibling();return!m||!K(m)?!1:(jo(e),m.selectEnd(),!0)}else if(e.shiftKey&&(t==="up"||t==="down")){let s=i.focus.getNode();if(me(s)){let l=i.getNodes()[0];if(l){let a=H(l,v);if(a&&n.isParentOf(a)){let d=n.getFirstDescendant(),m=n.getLastDescendant();if(!d||!m)return!1;let[f]=Le(d),[c]=Le(m),u=n.getCordsFromCellNode(f,r.table),p=n.getCordsFromCellNode(c,r.table),g=n.getDOMCellFromCordsOrThrow(u.x,u.y,r.table),h=n.getDOMCellFromCordsOrThrow(p.x,p.y,r.table);return r.setAnchorCellForSelection(g),r.setFocusCellForSelection(h,!0),!0}}return!1}else{let l=H(s,d=>E(d)&&!d.isInline());if(!l)return!1;let a=t==="down"?l.getNextSibling():l.getPreviousSibling();if(K(a)&&r.tableNodeKey===a.getKey()){let d=a.getFirstDescendant(),m=a.getLastDescendant();if(!d||!m)return!1;let[f]=Le(d),[c]=Le(m),u=i.clone();return u.focus.set((t==="up"?f:c).getKey(),t==="up"?0:c.getChildrenSize(),"element"),Y(u),!0}}}}return!1}if(_(i)&&i.isCollapsed()){let{anchor:s,focus:l}=i,a=H(s.getNode(),v),d=H(l.getNode(),v);if(!v(a)||!a.is(d))return!1;let m=bo(a);if(m!==n&&m!=null){let N=o.getElementByKey(m.getKey());if(N!=null)return r.table=Xo(N),Pr(o,e,t,m,r)}if(t==="backward"||t==="forward"){let N=s.type,L=s.offset,M=s.getNode();if(!M)return!1;let S=i.getNodes();return S.length===1&&B(S[0])?!1:hx(N,L,M,t)?Ex(e,M,n,t):!1}let f=o.getElementByKey(a.__key),c=o.getElementByKey(s.key);if(c==null||f==null)return!1;let u;if(s.type==="element")u=c.getBoundingClientRect();else{let N=window.getSelection();if(N===null||N.rangeCount===0)return!1;u=N.getRangeAt(0).getBoundingClientRect()}let p=t==="up"?a.getFirstChild():a.getLastChild();if(p==null)return!1;let g=o.getElementByKey(p.__key);if(g==null)return!1;let h=g.getBoundingClientRect();if(t==="up"?h.top>u.top-u.height:u.bottom+u.height>h.bottom){jo(e);let N=n.getCordsFromCellNode(a,r.table);if(e.shiftKey){let L=n.getDOMCellFromCordsOrThrow(N.x,N.y,r.table);r.setAnchorCellForSelection(L),r.setFocusCellForSelection(L,!0)}else return Ju(r,n,N.x,N.y,t);return!0}}else if(z(i)){let{anchor:s,focus:l}=i,a=H(s.getNode(),v),d=H(l.getNode(),v),[m]=i.getNodes(),f=o.getElementByKey(m.getKey());if(!v(a)||!v(d)||!K(m)||f==null)return!1;r.updateTableTableSelection(i);let c=Xo(f),u=n.getCordsFromCellNode(a,c),p=n.getDOMCellFromCordsOrThrow(u.x,u.y,c);if(r.setAnchorCellForSelection(p),jo(e),e.shiftKey){let g=n.getCordsFromCellNode(d,c);return px(r,m,g.x,g.y,t)}else d.selectEnd();return!0}return!1}function jo(o){o.preventDefault(),o.stopImmediatePropagation(),o.stopPropagation()}function gx(o){let e=o.getRootElement();return e?e.hasAttribute("aria-controls")&&e.getAttribute("aria-controls")==="typeahead-menu":!1}function hx(o,e,t,n){return Nx(o,t,n)||xx(o,e,t,n)}function Nx(o,e,t){return o==="element"&&(t==="backward"?e.getPreviousSibling()===null:e.getNextSibling()===null)}function xx(o,e,t,n){let r=H(t,s=>E(s)&&!s.isInline());if(!r)return!1;let i=n==="backward"?e===0:e===t.getTextContentSize();return o==="text"&&i&&(n==="backward"?r.getPreviousSibling()===null:r.getNextSibling()===null)}function Ex(o,e,t,n){let r=H(e,v);if(!v(r))return!1;let[i,s]=tt(t,r,r);if(!Tx(i,s,n))return!1;let l=Cx(e,n,t);return!l||K(l)?!1:(jo(o),n==="backward"?l.selectEnd():l.selectStart(),!0)}function Tx(o,e,t){let n=o[0][0],r=o[o.length-1][o[0].length-1],{startColumn:i,startRow:s}=e;return t==="backward"?i===n.startColumn&&s===n.startRow:i===r.startColumn&&s===r.startRow}function Cx(o,e,t){let n=H(o,i=>E(i)&&!i.isInline());if(!n)return;let r=e==="backward"?n.getPreviousSibling():n.getNextSibling();return r&&K(r)?r:e==="backward"?t.getPreviousSibling():t.getNextSibling()}function Gu(o,e,t){let n=I();o==="first"?e.insertBefore(n):e.insertAfter(n),n.append(...t||[]),n.selectEnd()}function ju(o,e,t){let n=t.getParent();if(!n)return;let r=o.getElementByKey(n.getKey());if(!r)return;let i=window.getSelection();if(!i||i.anchorNode!==r)return;let s=H(e.anchor.getNode(),h=>v(h));if(!s)return;let l=H(s,h=>K(h));if(!K(l)||!l.is(t))return;let[a,d]=tt(t,s,s),m=a[0][0],f=a[a.length-1][a[0].length-1],{startRow:c,startColumn:u}=d,p=c===m.startRow&&u===m.startColumn,g=c===f.startRow&&u===f.startColumn;return p?"first":g?"last":void 0}function _x(o){return o.map(e=>{if(y(e)){let t=I();return t.append(e),t}return e})}function yo(o,e){let t=uu(e),n=Ai(o,t);return _x(n)}function At(o,e){for(let t of o.getParents())if(e(t))return t;return null}function la(o,e){e||(e=F());let t=[];for(let n of e.getChildren())o(n)&&t.push(n),E(n)&&t.push(...la(o,n));return t}function tf(o,e,t){let n=F().getChildren();for(let r of n){let i=o.getElementByKey(r.__key);if(!i)continue;let s=i.getBoundingClientRect();if(t<=s.bottom)return r}return null}function Jo(o){let e=t=>(E(t)||B(t))&&!t.isInline()&&!oe(t);return e(o)?o:H(o,e)}function of(o){let e=[],t=i=>{for(let s of i.getChildren())e.push(s.getKey()),E(s)&&t(s)},n=F();t(n);let r=Array.from(o);return r.sort((i,s)=>{let l=e.indexOf(i.getKey()),a=e.indexOf(s.getKey());return l-a}),r}function Br(o){return"__alignment"in o}function nf(o){return"__inset"in o}var rf=new WeakMap;function le(o){return rf.get(o)||null}function sf(o,e){rf.set(o,e)}function ae(o,e){return X(o,e)!==null}function X(o,e){if(!o)return null;for(let t of o.getNodes()){if(e(t))return t;let n=At(t,e);if(n)return n}return null}function lf(o){return X(o,y)}function af(o,e){if(!o)return!1;for(let t of o.getNodes())if(y(t)&&t.hasFormat(e))return!0;return!1}function Kn(o,e){let t=T(),n=t?Eu(t.getNodes()[0]):null;t&&o(n)?Mi(t,I):Mi(t,e)}function Qo(o,e=!0){aa([o],e)}function aa(o,e=!0){let t=T()?.getNodes()||[],n=t.length>0?Jo(t[0]):null;if(n)if(e)for(let r=o.length-1;r>=0;r--)n.insertAfter(o[r]);else for(let r of o)n.insertBefore(r);else F().append(...o)}function ot(o){let e=Ho();e.add(o.getKey()),Y(e)}function df(o){for(let e of o){if(y(e))return e;if(E(e)){let t=e.getChildren(),n=df(t);if(n!==null)return n}}return null}function cf(o){let e=[...o].reverse();for(let t of e){if(y(t))return t;if(E(t)){let n=[...t.getChildren()].reverse(),r=cf(n);if(r!==null)return r}}return null}function uf(o){if(o.length===0)return;let e=Uo(),t=df(o),n=cf(o);t&&n&&(e.setTextNodeRange(t,0,n,n.getTextContentSize()||0),Y(e))}function ff(o){let e=le(o);e&&window.requestAnimationFrame(()=>{o.update(()=>{Y(e.clone())})})}function Zi(o,e){if(!o)return!1;let t=e.getKey();for(let n of o.getNodes())if(n.getKey()===t)return!0;return!1}function Fr(o,e){let t=[...o?.getNodes()||[],...Rt(o)];for(let n of t)if(Br(n)&&n.getAlignment()===e)return!0;return!1}function da(o,e){let t=[...o?.getNodes()||[],...Rt(o)];for(let n of t)if(Ko(n)&&n.getDirection()===e)return!0;return!1}function Rt(o){if(!o)return[];let e=new Map;for(let t of o.getNodes()){let n=Jo(t);E(n)&&e.set(n.getKey(),n)}return Array.from(e.values())}var kt=class{constructor(e){this.rowCount=0;this.columnCount=0;this.cells=[];this.buildCellMap(e)}buildCellMap(e){let t=[],n=(a,d,m)=>{typeof t[d]>"u"&&(t[d]=[]),t[d][a]=m},r=(a,d)=>!!(t[d]&&t[d][a]),i=e.getChildren().filter(a=>Q(a));for(let a=0;a<i.length;a++){let m=i[a].getChildren().filter(c=>v(c)),f=0;for(let c=0;c<m.length;c++){let u=m[c],p=u.getColSpan()||1,g=u.getRowSpan()||1;for(let h=f;h<f+p;h++)for(let C=a;C<a+g;C++){for(;r(h,C);)f+=1,h+=1;n(h,C,u)}f+=p}}this.rowCount=t.length,this.columnCount=Math.max(...t.map(a=>a.length));let s=[],l=t[0][0];for(let a=0;a<this.rowCount;a++)for(let d=0;d<this.columnCount;d++)!t[a]||!t[a][d]?s.push(l):(s.push(t[a][d]),l=t[a][d]);this.cells=s}getCellAtPosition(e,t){let n=t*this.columnCount+e;if(n>=this.cells.length)throw new Error(`TableMap Error: Attempted to get cell ${n+1} of ${this.cells.length}`);return this.cells[n]}getCellsInRange(e){let t=Math.max(Math.min(e.fromX,e.toX),0),n=Math.min(Math.max(e.fromX,e.toX),this.columnCount-1),r=Math.max(Math.min(e.fromY,e.toY),0),i=Math.min(Math.max(e.fromY,e.toY),this.rowCount-1),s=new Set;for(let l=r;l<=i;l++)for(let a=t;a<=n;a++)s.add(this.getCellAtPosition(a,l));return[...s.values()]}getCellsInColumn(e){return this.getCellsInRange({fromX:e,toX:e,fromY:0,toY:this.rowCount-1})}getRangeForCell(e){let t=null,n=e.getKey();for(let r=0;r<this.rowCount;r++)for(let i=0;i<this.columnCount;i++){let s=r*this.columnCount+i;this.cells[s].getKey()===n&&(t===null?t={fromX:i,toX:i,fromY:r,toY:r}:(t.fromX=Math.min(t.fromX,i),t.toX=Math.max(t.toX,i),t.fromY=Math.min(t.fromY,r),t.toY=Math.max(t.toY,r)))}return t}};function ca(o){return At(o,K)}function pf(o){let e=gf(o),t=o.querySelector("colgroup"),n=[];return t&&(t.childElementCount===e?.childElementCount||!e)&&(n=mf(t)),n.filter(Boolean).length===0&&e&&(n=mf(e)),n}function gf(o){let e=o.querySelectorAll("tr"),t=0,n=null;for(let r of e)r.childElementCount>t&&(n=r,t=r.childElementCount);return n}function mf(o){return[...o.children].map(e=>bx(e))}function bx(o){let e=o.style.width||o.getAttribute("width");return e&&!Number.isNaN(Number(e))&&(e=e+"px"),e||""}function ua(o,e,t){let n=o.getChildren(),r=0;for(let s of n){let l=s.getChildren().length;l>r&&(r=l)}let i=o.getColWidths();(i.length===0||i.length<r)&&(i=Array(r).fill("")),e+1>i.length&&console.error(`Attempted to set table column width for column [${e}] but only ${i.length} columns found`),i[e]=ft(t),o.setColWidths(i)}function hf(o,e,t){let n=e.getColWidths();if(n.length>t&&n[t].endsWith("px"))return Number(n[t].replace("px",""));let r=o.getElementByKey(e.__key);if(r){let i=gf(r);if(i&&i.children.length>t)return i.children[t].clientWidth}return 0}function Nf(o){let e=o.getParent();if(!Q(e))return-1;let t=0,n=e.getChildren();for(let r of n){let i=r.getColSpan()||1;if(t+=i,r.getKey()===o.getKey())break}return t-1}function xf(o,e){let t=ca(o),n=Nf(o);t&&n>=0&&ua(t,n,e)}function Ef(o,e){let t=ca(e),n=Nf(e);if(!t)return"";let r=t.getColWidths();return r.length>n?r[n]:""}function en(o){if(z(o))return o.getNodes().filter(n=>v(n));let e=X(o,v);return e?[e]:[]}function Tf(o){let e=o.getShape(),t=en(o);if(t.length===0)return;let n=ca(t[0]);if(!n)return;let r=new kt(n),i=r.getCellAtPosition(e.toX,e.toY);if(!i)return;let s=e.toX+((i.getColSpan()||1)-1),l=e.toY+((i.getRowSpan()||1)-1),a=r.getCellsInRange({fromX:e.fromX,fromY:e.fromY,toX:s,toY:l});if(a.length===0)return;let d=a[0],m=Math.abs(e.fromX-s)+1,f=Math.abs(e.fromY-l)+1;for(let c=1;c<a.length;c++){let u=a[c];d.append(...u.getChildren()),u.remove()}d.setColSpan(m),d.setRowSpan(f)}function to(o){let e=en(o),t={};for(let n of e){let r=n.getParent();Q(r)&&(t[r.getKey()]=r)}return Object.values(t)}function xt(o){let e=en(o);if(e.length===0)return null;let t=At(e[0],K);return K(t)?t:null}function Cf(o){o.setColWidths([]);for(let e of o.getChildren()){if(!Q(e))continue;let t=e.getStyles();t.delete("height"),t.delete("width"),e.setStyles(t);let n=e.getChildren().filter(r=>v(r));for(let r of n){let i=r.getStyles();i.delete("height"),i.delete("width"),r.setStyles(i),r.clearWidth()}}}function _f(o){o.setColWidths([]),o.setStyles(new Map);for(let e of o.getChildren()){if(!Q(e))continue;e.setStyles(new Map);let t=e.getChildren().filter(n=>v(n));for(let n of t)n.setStyles(new Map),n.clearWidth()}}function fa(o,e){e:for(let t of o.getChildren()){if(!Q(t))continue;let n=t.getChildren();for(let r of n){if(!v(r))return;if(e(r)===!1)break e}}}function bf(o){let e=null;return fa(o,t=>{let n=t.getStyles().get("padding")||"";if(e===null&&(e=n),n!==e)return e=null,!1}),e||""}var Et=class o extends Dt{constructor(t){super(t);this.__colWidths=[];this.__styles=new Map}static getType(){return"table"}static clone(t){let n=new o(t.__key);return _o(t,n),n.__colWidths=t.__colWidths,n.__styles=new Map(t.__styles),n}static importDOM(){return{table:t=>({conversion:yx,priority:1})}}static importJSON(t){let n=kr();return et(t,n),n.setColWidths(t.colWidths),n.setStyles(new Map(Object.entries(t.styles))),n}exportJSON(){return{...super.exportJSON(),type:"table",version:1,colWidths:this.__colWidths,styles:Object.fromEntries(this.__styles)}}createDOM(t,n){let r=document.createElement("table");Te(r,t.theme.table),Qe(r,this);let i=this.getColWidths();if(i.length>0){let s=b("colgroup");for(let l of i){let a=b("col");l&&(a.style.width=l),s.append(a)}r.append(s)}for(let[s,l]of this.__styles.entries())r.style.setProperty(s,l);return r}updateDOM(t){return vt(t,this)||this.__colWidths.join(":")!==t.__colWidths.join(":")||this.__styles.size!==t.__styles.size||Array.from(this.__styles.values()).join(":")!==Array.from(t.__styles.values()).join(":")}exportDOM(t){return{...super.exportDOM(t),after:n=>{if(!n)return;let r=n.cloneNode(),i=document.createElement("tbody");if(pe(n))for(let s of Array.from(n.children))s.nodeName==="TR"?i.append(s):s.nodeName==="CAPTION"?r.insertBefore(s,r.firstChild):r.append(s);return r.append(i),r}}}canBeEmpty(){return!1}isShadowRoot(){return!0}setColWidths(t){let n=this.getWritable();n.__colWidths=t}getColWidths(){return this.getLatest().__colWidths}getStyles(){let t=this.getLatest();return new Map(t.__styles)}setStyles(t){let n=this.getWritable();n.__styles=new Map(t)}getCordsFromCellNode(t,n){let{rows:r,domRows:i}=n;for(let s=0;s<r;s++){let l=i[s];if(l==null)continue;let a=l.findIndex(d=>{if(!d)return;let{elem:m}=d;return ee(m)===t});if(a!==-1)return{x:a,y:s}}throw new Error("Cell not found in table.")}getDOMCellFromCords(t,n,r){let{domRows:i}=r,s=i[n];if(s==null)return null;let l=t<s.length?t:s.length-1,a=s[l];return a??null}getDOMCellFromCordsOrThrow(t,n,r){let i=this.getDOMCellFromCords(t,n,r);if(!i)throw new Error("Cell not found at cords.");return i}getCellNodeFromCords(t,n,r){let i=this.getDOMCellFromCords(t,n,r);if(i==null)return null;let s=ee(i.elem);return v(s)?s:null}getCellNodeFromCordsOrThrow(t,n,r){let i=this.getCellNodeFromCords(t,n,r);if(!i)throw new Error("Node at cords not TableCellNode.");return i}canSelectBefore(){return!0}canIndent(){return!1}};function yx(o){let e=kr();Je(o,e);let t=pf(o);return e.setColWidths(t),e.setStyles(Dn(o)),{node:e}}function kr(){return ne(new Et)}function K(o){return o instanceof Et}var Un=class o extends Z{constructor(){super(...arguments);this.__id=""}static getType(){return"horizontal-rule"}setId(t){let n=this.getWritable();n.__id=t}getId(){return this.getLatest().__id}static clone(t){let n=new o(t.__key);return n.__id=t.__id,n}createDOM(t,n){let r=document.createElement("hr");return this.__id&&r.setAttribute("id",this.__id),r}updateDOM(t,n){return t.__id!==this.__id}static importDOM(){return{hr(t){return{conversion:n=>{let r=new o;return n.id&&r.setId(n.id),{node:r}},priority:3}}}}exportJSON(){return{...super.exportJSON(),type:"horizontal-rule",version:1,id:this.__id}}static importJSON(t){let n=ma();return n.setId(t.id),n}};function ma(){return new Un}function yf(o){return o instanceof Un}var Sf=o=>(o.split(" ").filter(t=>t.startsWith("language-"))[0]||"").replace("language-",""),tn=class o extends wt{constructor(t="",n="",r){super(r);this.__id="";this.__language="";this.__code="";this.__language=t,this.__code=n}static getType(){return"code-block"}static clone(t){let n=new o(t.__language,t.__code,t.__key);return n.__id=t.__id,n}setLanguage(t){let n=this.getWritable();n.__language=t}getLanguage(){return this.getLatest().__language}setCode(t){let n=this.getWritable();n.__code=t}getCode(){return this.getLatest().__code}setId(t){let n=this.getWritable();n.__id=t}getId(){return this.getLatest().__id}decorate(t,n){return{type:"code",getNode:()=>this}}isInline(){return!1}isIsolated(){return!0}createDOM(t,n){let r=b("pre",{id:this.__id||null},[b("code",{class:this.__language?`language-${this.__language}`:null},[this.__code])]);return b("div",{class:"editor-code-block-wrap"},[r])}updateDOM(t,n){let r=n.querySelector("code");return r&&(t.__language!==this.__language&&(r.className=this.__language?`language-${this.__language}`:""),t.__id!==this.__id&&n.setAttribute("id",this.__id),t.__code!==this.__code&&(r.textContent=this.__code)),!1}exportDOM(t){return{element:this.createDOM(t._config,t).querySelector("pre")}}static importDOM(){return{pre(t){return{conversion:n=>{let r=n.querySelector("code"),i=Sf(n.className)||r&&Sf(r.className)||"",s=r?(r.textContent||"").trim():(n.textContent||"").trim(),l=Vi(i,s);return n.id&&l.setId(n.id),{node:l,after(a){return[]}}},priority:3}}}}exportJSON(){return{type:"code-block",version:1,id:this.__id,language:this.__language,code:this.__code}}static importJSON(t){let n=Vi(t.language,t.code);return n.setId(t.id||""),n}};function Vi(o="",e=""){return new tn(o,e)}function Xi(o){return o instanceof tn}function Hr(o,e){let t=e.getCode(),n=e.getLanguage();window.$components.first("code-editor").open(t,n,"ltr",(i,s)=>{o.update(()=>{e.setCode(i),e.setLanguage(s)})},()=>{})}var So=class o extends wt{constructor(t,n,r){super(r);this.__id="";this.__drawingId="";this.__drawingUrl="";this.__drawingId=t,this.__drawingUrl=n}static getType(){return"diagram"}static clone(t){let n=new o(t.__drawingId,t.__drawingUrl);return n.__id=t.__id,n}setDrawingIdAndUrl(t,n){let r=this.getWritable();r.__drawingUrl=n,r.__drawingId=t}getDrawingIdAndUrl(){let t=this.getLatest();return{id:t.__drawingId,url:t.__drawingUrl}}setId(t){let n=this.getWritable();n.__id=t}getId(){return this.getLatest().__id}decorate(t,n){return{type:"diagram",getNode:()=>this}}isInline(){return!1}isIsolated(){return!0}createDOM(t,n){return b("div",{id:this.__id||null,"drawio-diagram":this.__drawingId},[b("img",{src:this.__drawingUrl})])}updateDOM(t,n){let r=n.querySelector("img");return r&&(t.__id!==this.__id&&n.setAttribute("id",this.__id),t.__drawingUrl!==this.__drawingUrl&&r.setAttribute("src",this.__drawingUrl),t.__drawingId!==this.__drawingId&&n.setAttribute("drawio-diagram",this.__drawingId)),!1}static importDOM(){return{div(t){return t.hasAttribute("drawio-diagram")?{conversion:n=>{let i=n.querySelector("img")?.getAttribute("src")||"",s=n.getAttribute("drawio-diagram")||"",l=zn(s,i);return n.id&&l.setId(n.id),{node:l}},priority:3}:null}}}exportJSON(){return{type:"diagram",version:1,id:this.__id,drawingId:this.__drawingId,drawingUrl:this.__drawingUrl}}static importJSON(t){let n=zn(t.drawingId,t.drawingUrl);return n.setId(t.id||""),n}};function zn(o="",e=""){return new So(o,e)}var Sx=["width","height","style","title","name","src","allow","allowfullscreen","loading","sandbox","type","data","controls","autoplay","controlslist","loop","muted","playsinline","poster","preload"];function Lx(o){let e={};for(let t of Object.keys(o))Sx.includes(t)&&(e[t]=o[t]);return e}function Lf(o,e){let t=Mf(o),n={};for(let i of e.attributes)n[i.name]=i.value;t.setAttributes(n);let r=[];if(o==="video"||o==="audio"){for(let i of e.children)if(i.tagName==="SOURCE"){let s=i.getAttribute("src"),l=i.getAttribute("type");s&&l&&r.push({src:s,type:l})}t.setSources(r)}return Je(e,t),t}var Lo=class o extends Z{constructor(t,n){super(n);this.__id="";this.__alignment="";this.__attributes={};this.__sources=[];this.__inset=0;this.__tag=t}static getType(){return"media"}static clone(t){let n=new o(t.__tag,t.__key);return n.__attributes=Object.assign({},t.__attributes),n.__sources=t.__sources.map(r=>Object.assign({},r)),n.__id=t.__id,n.__alignment=t.__alignment,n.__inset=t.__inset,n}setTag(t){let n=this.getWritable();n.__tag=t}getTag(){return this.getLatest().__tag}setAttributes(t){let n=this.getWritable();n.__attributes=Lx(t)}getAttributes(){return this.getLatest().__attributes}setSources(t){let n=this.getWritable();n.__sources=t}getSources(){return this.getLatest().__sources}setSrc(t){let n=Object.assign({},this.getAttributes());this.__tag==="object"?n.data=t:n.src=t,this.setAttributes(n)}setWidthAndHeight(t,n){let r=Object.assign({},this.getAttributes(),{width:t,height:n});this.setAttributes(r)}setId(t){let n=this.getWritable();n.__id=t}getId(){return this.getLatest().__id}setAlignment(t){let n=this.getWritable();n.__alignment=t}getAlignment(){return this.getLatest().__alignment}setInset(t){let n=this.getWritable();n.__inset=t}getInset(){return this.getLatest().__inset}setHeight(t){if(!t)return;let n=Object.assign({},this.getAttributes(),{height:t});this.setAttributes(n)}getHeight(){let t=this.getLatest();return Wo(t.__attributes.height||"0")}setWidth(t){let n=Object.assign({},this.getAttributes(),{width:t});this.setAttributes(n)}getWidth(){let t=this.getLatest();return Wo(t.__attributes.width||"0")}isInline(){return!0}isParentRequired(){return!0}createInnerDOM(){let n=(this.__tag==="video"||this.__tag==="audio"?this.__sources:[]).map(i=>b("source",i)),r=b(this.__tag,this.__attributes,n);return Qe(r,this),r}createDOM(t,n){let r=this.createInnerDOM(),i=b("span",{class:r.className+" editor-media-wrap"},[r]);return i.addEventListener("click",s=>{n.update(()=>ot(this))}),i}updateDOM(t,n){if(t.__tag!==this.__tag||JSON.stringify(t.__sources)!==JSON.stringify(this.__sources)||JSON.stringify(t.__attributes)!==JSON.stringify(this.__attributes))return!0;let r=n.firstElementChild;return t.__id!==this.__id&&fu(r,"id",this.__id),t.__alignment!==this.__alignment&&(t.__alignment&&(n.classList.remove(`align-${t.__alignment}`),r.classList.remove(`align-${t.__alignment}`)),this.__alignment&&(n.classList.add(`align-${this.__alignment}`),r.classList.add(`align-${this.__alignment}`))),t.__inset!==this.__inset&&(n.style.paddingLeft=`${this.__inset}px`),!1}static importDOM(){let t=n=>r=>({conversion:i=>({node:Lf(n,i)}),priority:3});return{iframe:t("iframe"),embed:t("embed"),object:t("object"),video:t("video"),audio:t("audio")}}exportDOM(t){return{element:this.createInnerDOM()}}exportJSON(){return{...super.exportJSON(),type:"media",version:1,id:this.__id,alignment:this.__alignment,inset:this.__inset,tag:this.__tag,attributes:this.__attributes,sources:this.__sources}}static importJSON(t){let n=Mf(t.tag);return et(t,n),n}};function Mf(o){return new Lo(o)}function wf(o){let n=new DOMParser().parseFromString(`<body>${o}</body>`,"text/html").body.children[0];if(!(n instanceof HTMLElement))return null;let r=n.tagName.toLowerCase();return["embed","iframe","video","audio","object"].includes(r)?Lf(r,n):null}var Mx=[{regex:/.*?youtu\.be\/([\w\-_\?&=.]+)/i,w:560,h:314,url:"https://www.youtube.com/embed/$1"},{regex:/.*youtube\.com(.+)v=([^&]+)(&([a-z0-9&=\-_]+))?.*/i,w:560,h:314,url:"https://www.youtube.com/embed/$2?$4"},{regex:/.*youtube.com\/embed\/([a-z0-9\?&=\-_]+).*/i,w:560,h:314,url:"https://www.youtube.com/embed/$1"}],wx=["mp4","mpeg","m4v","m4p","mov"],vx=["3gp","aac","flac","mp3","m4a","ogg","wav","webm"],Dx=["html","htm","php","asp","aspx",""];function vf(o){for(let s of Mx)if(o.match(s.regex)){let a=o.replace(s.regex,s.url),d=new Lo("iframe");return d.setSrc(a),d.setHeight(s.h),d.setWidth(s.w),d}let e="iframe",n=(o.split("?")[0].split("/").pop()||"").split("."),r=(n.length>1?n[n.length-1]:"").toLowerCase();wx.includes(r)?e="video":vx.includes(r)?e="audio":r&&!Dx.includes(r)&&(e="embed");let i=new Lo(e);return i.setSrc(o),i}function oo(o){return o instanceof Lo}var Yn=class o extends Dt{static getType(){return"heading"}static clone(e){let t=new o(e.__tag,e.__key);return _o(e,t),t}constructor(e,t){super(t),this.__tag=e}getTag(){return this.__tag}createDOM(e){let t=this.__tag,n=document.createElement(t),i=e.theme.heading;if(i!==void 0){let s=i[t];Te(n,s)}return Qe(n,this),n}updateDOM(e,t){return vt(e,this)}static importDOM(){return{h1:e=>({conversion:Wn,priority:0}),h2:e=>({conversion:Wn,priority:0}),h3:e=>({conversion:Wn,priority:0}),h4:e=>({conversion:Wn,priority:0}),h5:e=>({conversion:Wn,priority:0}),h6:e=>({conversion:Wn,priority:0})}}exportDOM(e){let{element:t}=super.exportDOM(e);return t&&pe(t)&&this.isEmpty()&&t.append(document.createElement("br")),{element:t}}static importJSON(e){let t=qn(e.tag);return et(e,t),t}exportJSON(){return{...super.exportJSON(),tag:this.getTag(),type:"heading",version:1}}insertNewAfter(e,t=!0){let n=e?e.anchor.offset:0,r=this.getLastDescendant(),s=!r||e&&e.anchor.key===r.getKey()&&n===r.getTextContentSize()||!e?I():qn(this.getTag()),l=this.getDirection();if(s.setDirection(l),this.insertAfter(s,t),n===0&&!this.isEmpty()&&e){let a=I();a.select(),this.replace(a,!0)}return s}collapseAtStart(){let e=this.isEmpty()?I():qn(this.getTag());return this.getChildren().forEach(n=>e.append(n)),this.replace(e),!0}extractWithChild(){return!0}};function Wn(o){let e=o.nodeName.toLowerCase(),t=null;return(e==="h1"||e==="h2"||e==="h3"||e==="h4"||e==="h5"||e==="h6")&&(t=qn(e),Je(o,t)),{node:t}}function qn(o){return ne(new Yn(o))}function Zn(o){return o instanceof Yn}var Vn=class o extends Dt{static getType(){return"quote"}static clone(e){let t=new o(e.__key);return _o(e,t),t}constructor(e){super(e)}createDOM(e){let t=document.createElement("blockquote");return Te(t,e.theme.quote),Qe(t,this),t}updateDOM(e,t){return vt(e,this)}static importDOM(){return{blockquote:e=>({conversion:Ox,priority:0})}}exportDOM(e){let{element:t}=super.exportDOM(e);return t&&pe(t)&&this.isEmpty()&&t.append(document.createElement("br")),{element:t}}static importJSON(e){let t=Gi();return et(e,t),t}exportJSON(){return{...super.exportJSON(),type:"quote"}}insertNewAfter(e,t){let n=I(),r=this.getDirection();return n.setDirection(r),this.insertAfter(n,t),n}collapseAtStart(){let e=I();return this.getChildren().forEach(n=>e.append(n)),this.replace(e),!0}canMergeWhenEmpty(){return!0}};function Gi(){return ne(new Vn)}function ji(o){return o instanceof Vn}function Ox(o){let e=Gi();return Je(o,e),{node:e}}var Xn=class o extends Z{static getType(){return"caption"}static clone(e){return new o(e.__key)}createDOM(e,t){return document.createElement("caption")}updateDOM(e,t,n){return!1}isParentRequired(){return!0}canBeEmpty(){return!1}exportJSON(){return{...super.exportJSON(),type:"caption",version:1}}insertDOMIntoParent(e,t){return t.insertBefore(e,t.firstChild),!0}static importJSON(e){return pa()}static importDOM(){return{caption:e=>({conversion(t){return{node:pa()}},priority:0})}}};function pa(){return new Xn}function ga(o){return o instanceof Xn}function ha(o){for(let e of o.getChildren())if(ga(e))return!0;return!1}function Df(o,e=""){let t=pa(),n=q(e||" ");t.append(n),o.append(t)}function Of(){return[qo,Yn,Vn,Zo,Jt,Et,eo,Qt,Xn,Yo,Un,Fn,tn,So,Lo,ct,Pn]}function Af(o){let e=[Yo,tn,So],t=n=>{for(let[r,i]of n)if(i==="destroyed"){let s=o.manager.getDecoratorByNodeKey(r);s&&s.destroy(o)}};for(let n of e)o.editor.registerMutationListener(n,r=>t(r))}function Na(o){return"build"in o}var Me=class{constructor(){this.dom=null;this.context=null}setContext(e){this.context=e}getContext(){if(this.context===null)throw new Error("Attempted to use EditorUIContext before it has been set");return this.context}getDOMElement(){return this.dom||(this.dom=this.buildDOM()),this.dom}rebuildDOM(){let e=this.buildDOM();return this.dom?.replaceWith(e),this.dom=e,this.dom}trans(e){return this.getContext().translate(e)}updateState(e){}},te=class extends Me{constructor(t){super();this.children=[];this.children.push(...t)}buildDOM(){return b("div",{},this.getChildren().map(t=>t.getDOMElement()))}getChildren(){return this.children}addChildren(...t){this.children.push(...t)}removeChildren(...t){for(let n of t)this.removeChild(n)}removeChild(t){let n=this.children.indexOf(t);n!==-1&&this.children.splice(n,1)}updateState(t){for(let n of this.children)n.updateState(t)}setContext(t){super.setContext(t);for(let n of this.getChildren())n.setContext(t)}},Ji=class extends te{constructor(e,t){super(t),this.className=e}buildDOM(){return b("div",{class:this.className},this.getChildren().map(e=>e.getDOMElement()))}};var w=class extends Me{constructor(t){super();this.active=!1;this.completedSetup=!1;this.disabled=!1;t.action!==void 0?this.definition=t:this.definition={...t,action(){return!1},isActive:()=>!1}}setContext(t){super.setContext(t),this.definition.setup&&!this.completedSetup&&(this.definition.setup(t,this),this.completedSetup=!0)}buildDOM(){let t=this.getLabel(),n=this.definition.format||"small",r=[];if(this.definition.icon||n==="long"){let s=b("div",{class:"editor-button-icon"});s.innerHTML=this.definition.icon||"",r.push(s)}if(!this.definition.icon||n==="long"){let s=b("div",{class:"editor-button-text"},[t]);r.push(s)}let i=b("button",{type:"button",class:`editor-button editor-button-${n}`,title:this.definition.icon?t:null,disabled:this.disabled?"true":null},r);return i.addEventListener("click",this.onClick.bind(this)),i}onClick(){this.definition.action(this.getContext(),this)}updateActiveState(t){let n=this.definition.isActive(t,this.getContext());this.setActiveState(n)}updateDisabledState(t){if(this.definition.isDisabled){let n=this.definition.isDisabled(t,this.getContext());this.toggleDisabled(n)}}setActiveState(t){this.active=t,this.dom?.classList.toggle("editor-button-active",this.active)}updateState(t){this.updateActiveState(t.selection),this.updateDisabledState(t.selection)}isActive(){return this.active}getLabel(){return this.trans(this.definition.label)}toggleDisabled(t){this.disabled=t,t?this.dom?.setAttribute("disabled","true"):this.dom?.removeAttribute("disabled")}};function Ax(o,e,t){let n=e.getBoundingClientRect(),r=o.getBoundingClientRect();if(o.style.position="fixed",t){let i=n.right;n.right+r.width>window.innerWidth&&(i=Math.max(n.left-r.width,0)),o.style.top=n.top+"px",o.style.left=i+"px"}else{let i=n.left+r.width>window.innerWidth,s=n.left;i&&(s=Math.max(n.right-r.width,0)),o.style.top=n.bottom+"px",o.style.left=s+"px"}}function Qi(o){let{menu:e,toggle:t,onClose:n,onOpen:r,showOnHover:i,showAside:s}=o,l=null,a=()=>{e.hidden=!0,e.style.removeProperty("position"),e.style.removeProperty("left"),e.style.removeProperty("top"),l&&window.removeEventListener("click",l),n&&n()},d=()=>{e.hidden=!1,Ax(e,t,!!s),l=f=>{!t.contains(f.target)&&!e.contains(f.target)&&a()},window.addEventListener("click",l),r&&r()},m=f=>{e.hasAttribute("hidden")?d():a()};t.addEventListener("click",m),i&&t.addEventListener("mouseenter",m),e.parentElement?.addEventListener("mouseleave",f=>{let c=t.getBoundingClientRect(),u=f.clientX<=c.right&&f.clientX>=c.left,p=f.clientY<=c.bottom&&f.clientY>=c.top;u&&p||a()})}var es=class extends te{buildDOM(){let e=this.getChildren().map(i=>i.getDOMElement()),t=b("div",{class:"editor-format-menu-dropdown editor-dropdown-menu editor-dropdown-menu-vertical",hidden:"true"},e),n=b("button",{class:"editor-format-menu-toggle editor-button",type:"button"},[this.trans("Formats")]),r=b("div",{class:"editor-format-menu editor-dropdown-menu-container"},[n,t]);return Qi({toggle:n,menu:t}),r}updateState(e){super.updateState(e);for(let t of this.children){if(t instanceof w&&t.isActive()){this.updateToggleLabel(t.getLabel());return}if(t instanceof te){for(let n of t.getChildren())if(n instanceof w&&n.isActive()){this.updateToggleLabel(n.getLabel());return}}}this.updateToggleLabel(this.trans("Formats"))}updateToggleLabel(e){let t=this.getDOMElement().querySelector("button");t&&(t.innerText=e)}};var qe=class extends w{constructor(e,t){super(t),this.previewSampleElement=e}buildDOM(){let e=super.buildDOM();e.innerHTML="";let t=b("span",{class:"editor-button-format-preview"},[this.getLabel()]),n=this.getStylesFromPreview();for(let r of Object.keys(n))t.style.setProperty(r,n[r]);return e.append(t),e}getStylesFromPreview(){let e=b("div",{style:"display: none",hidden:"true",class:"page-content"}),t=this.previewSampleElement.cloneNode();t.textContent=this.getLabel(),e.append(t),document.body.append(e);let n=["color","font-size","background-color","border-inline-start"],r={},i=window.getComputedStyle(t);for(let s of n)r[s]=i.getPropertyValue(s);return e.remove(),r}};var Rf='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/><path d="M0 0h24v24H0z" fill="none"/></svg>';var ts=class extends w{buildDOM(){let e=super.buildDOM(),t=b("div",{class:"editor-menu-button-icon"});return t.innerHTML=Rf,e.append(t),e}};var kx={showOnHover:!1,direction:"horizontal",showAside:void 0,button:{label:"Menu"}},Ee=class extends te{constructor(t,n){super(n);this.open=!1;if(this.childItems=n,this.options=Object.assign({},kx,t),t.button instanceof w)this.button=t.button;else{let r=t.button.format==="long"?ts:w;this.button=new r({...t.button,action(){return!1},isActive:()=>this.open})}this.addChildren(this.button)}insertItems(...t){this.addChildren(...t),this.childItems.push(...t)}buildDOM(){let t=this.button.getDOMElement(),n=this.childItems.map(s=>s.getDOMElement()),r=b("div",{class:`editor-dropdown-menu editor-dropdown-menu-${this.options.direction}`,hidden:"true"},n),i=b("div",{class:"editor-dropdown-menu-container"},[t,r]);return Qi({toggle:t,menu:r,showOnHover:this.options.showOnHover,showAside:typeof this.options.showAside=="boolean"?this.options.showAside:this.options.direction==="vertical",onOpen:()=>{this.open=!0,this.getContext().manager.triggerStateUpdateForElement(this.button)},onClose:()=>{this.open=!1,this.getContext().manager.triggerStateUpdateForElement(this.button)}}),i}};var kf='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M800-436q0 36-8 69t-22 63l-62-60q6-17 9-34.5t3-37.5q0-47-17.5-89T650-600L480-768l-88 86-56-56 144-142 226 222q44 42 69 99.5T800-436Zm-8 380L668-180q-41 29-88 44.5T480-120q-133 0-226.5-92.5T160-436q0-51 16-98t48-90L56-792l56-56 736 736-56 56ZM480-200q36 0 68.5-10t61.5-28L280-566q-21 32-30.5 64t-9.5 66q0 98 70 167t170 69Zm-37-204Zm110-116Z"/></svg>';var If='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M480-80q-82 0-155-31.5t-127.5-86Q143-252 111.5-325T80-480q0-83 32.5-156t88-127Q256-817 330-848.5T488-880q80 0 151 27.5t124.5 76q53.5 48.5 85 115T880-518q0 115-70 176.5T640-280h-74q-9 0-12.5 5t-3.5 11q0 12 15 34.5t15 51.5q0 50-27.5 74T480-80Zm0-400Zm-220 40q26 0 43-17t17-43q0-26-17-43t-43-17q-26 0-43 17t-17 43q0 26 17 43t43 17Zm120-160q26 0 43-17t17-43q0-26-17-43t-43-17q-26 0-43 17t-17 43q0 26 17 43t43 17Zm200 0q26 0 43-17t17-43q0-26-17-43t-43-17q-26 0-43 17t-17 43q0 26 17 43t43 17Zm120 160q26 0 43-17t17-43q0-26-17-43t-43-17q-26 0-43 17t-17 43q0 26 17 43t43 17ZM480-160q9 0 14.5-5t5.5-13q0-14-15-33t-15-57q0-42 29-67t71-25h70q66 0 113-38.5T800-518q0-121-92.5-201.5T488-800q-136 0-232 93t-96 227q0 133 93.5 226.5T480-160Z"/></svg>';function $f(){let o=()=>((1+Math.random())*65536|0).toString(16).substring(1);return`${o()+o()}-${o()}-${o()}-${o()}-${o()}${o()}${o()}`}function os(){return((1+Math.random())*65536|0).toString(16).substring(1)}var Pf=["#000000","#ffffff","#BFEDD2","#FBEEB8","#F8CAC6","#ECCAFA","#C2E0F4","#2DC26B","#F1C40F","#E03E2D","#B96AD9","#3598DB","#169179","#E67E23","#BA372A","#843FA1","#236FA1","#ECF0F1","#CED4D9","#95A5A6","#7E8C8D","#34495E"],Bf="bs-lexical-custom-colors",on=class extends Me{constructor(e){super(),this.callback=e}buildDOM(){let e=os(),n=[...Pf,...this.getCustomColorChoices()].map(d=>b("div",{class:"editor-color-select-option",style:`background-color: ${d}`,"data-color":d,"aria-label":d})),r=b("div",{class:"editor-color-select-option","data-color":"",title:this.getContext().translate("Remove color")},[]);r.innerHTML=kf,n.push(r);let i=b("label",{class:"editor-color-select-option",for:`color-select-${e}`,"data-color":"",title:this.getContext().translate("Custom color")},[]);i.innerHTML=If,n.push(i);let s=b("input",{type:"color",hidden:"true",id:`color-select-${e}`});n.push(s),s.addEventListener("change",d=>{s.value&&(this.storeCustomColorChoice(s.value),this.setColor(s.value),this.rebuildDOM())});let l=[];for(let d=0;d<n.length;d+=5){let m=n.slice(d,d+5);l.push(b("div",{class:"editor-color-select-row"},m))}let a=b("div",{class:"editor-color-select"},l);return a.addEventListener("click",this.onClick.bind(this)),a}storeCustomColorChoice(e){if(Pf.includes(e))return;let t=this.getCustomColorChoices();t.includes(e)||(t.push(e),window.localStorage.setItem(Bf,JSON.stringify(t)))}getCustomColorChoices(){return JSON.parse(window.localStorage.getItem(Bf)||"[]")}onClick(e){let t=e.target.closest("[data-color]");if(!t)return;let n=t.dataset.color;this.setColor(n)}setColor(e){this.callback(e,this.getContext())}};var ns=class extends Me{buildDOM(){let t=[],n=[];for(let s=1;s<11;s++){let l=[];for(let a=1;a<11;a++){let d=b("div",{class:"editor-table-creator-cell","data-rows":String(s),"data-columns":String(a)});l.push(d),n.push(d)}t.push(b("div",{class:"editor-table-creator-row"},l))}let r=b("div",{class:"editor-table-creator-display"},["0 x 0"]),i=b("div",{class:"editor-table-creator-grid"},t);return i.addEventListener("mousemove",s=>{let l=s.target.closest(".editor-table-creator-cell");if(l){let a=Number(l.dataset.rows||0),d=Number(l.dataset.columns||0);this.updateGridSelection(a,d,n,r)}}),i.addEventListener("click",s=>{let l=s.target.closest(".editor-table-creator-cell");l&&this.onCellClick(l)}),i.addEventListener("mouseleave",s=>{this.updateGridSelection(0,0,n,r)}),b("div",{class:"editor-table-creator"},[i,r])}updateGridSelection(e,t,n,r){for(let i of n){let s=Number(i.dataset.rows)<=e&&Number(i.dataset.columns)<=t;i.classList.toggle("active",s)}r.textContent=`${e} x ${t}`}onCellClick(e){let t=Number(e.dataset.rows||0),n=Number(e.dataset.columns||0);if(t<1||n<1)return;let r=Math.min(Math.round(840/n),240),i=Array(n).fill(r+"px");this.getContext().editor.update(()=>{let s=jl(t,n,!1);s.setColWidths(i),Qo(s)})}};var Kr=class extends w{constructor(e,t){super(e),this.style=t}getColorBar(){let e=this.getDOMElement().querySelector("svg .editor-icon-color-bar");if(!e)throw new Error(`Could not find expected color bar in the icon for this ${this.definition.label} button`);return e}updateState(e){if(super.updateState(e),_(e.selection)){let t=Bl(e.selection,this.style);this.getColorBar().setAttribute("fill",t)}}};var Ff='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M240-400q-33 0-56.5-23.5T160-480q0-33 23.5-56.5T240-560q33 0 56.5 23.5T320-480q0 33-23.5 56.5T240-400Zm240 0q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm240 0q-33 0-56.5-23.5T640-480q0-33 23.5-56.5T720-560q33 0 56.5 23.5T800-480q0 33-23.5 56.5T720-400Z"/></svg>';var nt=class extends te{constructor(e,t){super(t),this.size=e,this.content=t,this.overflowButton=new Ee({button:{label:"More",icon:Ff}},[]),this.addChildren(this.overflowButton)}buildDOM(){let e=this.content.length>this.size?this.size-1:this.size,t=this.content.slice(0,e),n=this.content.slice(e),r=t.map(i=>i.getDOMElement());return n.length>0&&(this.removeChildren(...n),this.overflowButton.insertItems(...n),r.push(this.overflowButton.getDOMElement())),b("div",{class:"editor-overflow-container"},r)}};var xa='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M120-200v-560q0-33 23.5-56.5T200-840h560q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200q-33 0-56.5-23.5T120-200Zm80-400h560v-160H200v160Zm213 200h134v-120H413v120Zm0 200h134v-120H413v120ZM200-400h133v-120H200v120Zm427 0h133v-120H627v120ZM200-200h133v-120H200v120Zm427 0h133v-120H627v120Z"/></svg>';var rs='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M5 21a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v14c0 1.1-.9 2-2 2zm0-2h14V5H5v14z"/><path d="m13.711 15.423-1.71-1.712-1.712 1.712c-1.14 1.14-2.852-.57-1.71-1.712l1.71-1.71-1.71-1.712c-1.143-1.142.568-2.853 1.71-1.71L12 10.288l1.711-1.71c1.141-1.142 2.852.57 1.712 1.71L13.71 12l1.626 1.626c1.345 1.345-.76 2.663-1.626 1.797z" style="fill-rule:nonzero;stroke-width:1.20992"/></svg>';var Hf='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14c1.1 0 2 .9 2 2zm-2 0V5h-4v2.2h-2V5h-2v2.2H9V5H5v14h4v-2.1h2V19h2v-2.1h2V19Z"/><path d="M14.829 10.585 13.415 12l1.414 1.414c.943.943-.472 2.357-1.414 1.414L12 13.414l-1.414 1.414c-.944.944-2.358-.47-1.414-1.414L10.586 12l-1.414-1.415c-.943-.942.471-2.357 1.414-1.414L12 10.585l1.344-1.343c1.111-1.112 2.2.627 1.485 1.343z" style="fill-rule:nonzero"/></svg>';var Kf='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M5 21a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v14c0 1.1-.9 2-2 2zm0-2h14v-4h-2.2v-2H19v-2h-2.2V9H19V5H5v4h2.1v2H5v2h2.1v2H5Z"/><path d="M13.415 14.829 12 13.415l-1.414 1.414c-.943.943-2.357-.472-1.414-1.414L10.586 12l-1.414-1.414c-.944-.944.47-2.358 1.414-1.414L12 10.586l1.415-1.414c.942-.943 2.357.471 1.414 1.414L13.415 12l1.343 1.344c1.112 1.111-.627 2.2-1.343 1.485z" style="fill-rule:nonzero"/></svg>';var Uf='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16 5h-5v14h5c1.235 0 1.234 2 0 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11c1.229 0 1.236 2 0 2zm-7 6V5H5v6zm0 8v-6H5v6zm11.076-6h-2v2c0 1.333-2 1.333-2 0v-2h-2c-1.335 0-1.335-2 0-2h2V9c0-1.333 2-1.333 2 0v2h1.9c1.572 0 1.113 2 .1 2z"/></svg>';var zf='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8 19h5V5H8C6.764 5 6.766 3 8 3h11a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H8c-1.229 0-1.236-2 0-2zm7-6v6h4v-6zm0-8v6h4V5ZM3.924 11h2V9c0-1.333 2-1.333 2 0v2h2c1.335 0 1.335 2 0 2h-2v2c0 1.333-2 1.333-2 0v-2h-1.9c-1.572 0-1.113-2-.1-2z"/></svg>';var Wf='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M5 8v5h14V8c0-1.235 2-1.234 2 0v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8C3 6.77 5 6.764 5 8zm6 7H5v4h6zm8 0h-6v4h6zM13 3.924v2h2c1.333 0 1.333 2 0 2h-2v2c0 1.335-2 1.335-2 0v-2H9c-1.333 0-1.333-2 0-2h2v-1.9c0-1.572 2-1.113 2-.1z"/></svg>';var qf='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 16v-5H5v5c0 1.235-2 1.234-2 0V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v11c0 1.229-2 1.236-2 0zm-6-7h6V5h-6zM5 9h6V5H5Zm6 11.076v-2H9c-1.333 0-1.333-2 0-2h2v-2c0-1.335 2-1.335 2 0v2h2c1.333 0 1.333 2 0 2h-2v1.9c0 1.572-2 1.113-2 .1z"/></svg>';var It=class extends Me{constructor(e){super(),this.definition=e}setValue(e){let t=this.getDOMElement().querySelector("input,select,textarea");this.definition.type==="checkbox"?t.checked=!!e:t.value=e,t.dispatchEvent(new Event("change"))}getName(){return this.definition.name}buildDOM(){let e=`editor-form-field-${this.definition.name}-${Date.now()}`,t;if(this.definition.type==="select"){let n=this.definition.valuesByLabel,i=Object.keys(n).map(s=>b("option",{value:n[s]},[this.trans(s)]));t=b("select",{id:e,name:this.definition.name,class:"editor-form-field-input"},i)}else this.definition.type==="textarea"?t=b("textarea",{id:e,name:this.definition.name,class:"editor-form-field-input"}):this.definition.type==="checkbox"?t=b("input",{id:e,name:this.definition.name,type:"checkbox",class:"editor-form-field-input-checkbox",value:"true"}):t=b("input",{id:e,name:this.definition.name,class:"editor-form-field-input"});return b("div",{class:"editor-form-field-wrapper"},[b("label",{class:"editor-form-field-label",for:e},[this.trans(this.definition.label)]),t])}},is=class extends te{constructor(t){let n=t.fields.map(r=>Na(r)?r.build():new It(r));super(n);this.onCancel=null;this.onSuccessfulSubmit=null;this.definition=t}setValues(t){for(let n of Object.keys(t)){let r=this.getFieldByName(n);r&&r.setValue(t[n])}}setOnCancel(t){this.onCancel=t}setOnSuccessfulSubmit(t){this.onSuccessfulSubmit=t}getFieldByName(t){let n=r=>{for(let i of r){if(i instanceof It&&i.getName()===t)return i;if(i instanceof te){let s=n(i.getChildren());if(s)return s}}return null};return n(this.getChildren())}buildDOM(){let t=b("button",{type:"button",class:"editor-form-action-secondary"},[this.trans("Cancel")]),n=b("form",{},[...this.children.map(r=>r.getDOMElement()),b("div",{class:"editor-form-actions"},[t,b("button",{type:"submit",class:"editor-form-action-primary"},[this.trans(this.definition.submitText)])])]);return n.addEventListener("submit",async r=>{r.preventDefault();let i=new FormData(n);await this.definition.action(i,this.getContext())&&this.onSuccessfulSubmit&&this.onSuccessfulSubmit()}),t.addEventListener("click",r=>{this.onCancel&&this.onCancel()}),n}},Ea=class extends te{constructor(e){let t=e.contents.map(n=>Na(n)?n.build():new It(n));super(t),this.definition=e,this.fields=t,this.id=$f()}getLabel(){return this.getContext().translate(this.definition.label)}getId(){return this.id}buildDOM(){return b("div",{class:"editor-form-tab-content",role:"tabpanel",id:`editor-tabpanel-${this.id}`,"aria-labelledby":`editor-tab-${this.id}`},this.fields.map(e=>e.getDOMElement()))}},nn=class extends te{constructor(t){let n=t.map(r=>new Ea(r));super(n);this.definitions=[];this.tabs=[];this.definitions=t,this.tabs=n}buildDOM(){let t=[],n=[],r=i=>{for(let s=0;s<t.length;s++)t[s].setAttribute("aria-selected",s===i?"true":"false");for(let s=0;s<n.length;s++)n[s].hidden=s!==i};for(let i of this.tabs){let s=b("button",{class:"editor-form-tab-control",type:"button",role:"tab",id:`editor-tab-${i.getId()}`,"aria-controls":`editor-tabpanel-${i.getId()}`},[i.getLabel()]);n.push(i.getDOMElement()),t.push(s),s.addEventListener("click",l=>{r(t.indexOf(s))})}return r(0),b("div",{class:"editor-form-tab-container"},[b("div",{class:"editor-form-tab-controls"},t),b("div",{class:"editor-form-tab-contents"},n)])}};var Yf=`<svg version="1.1" viewBox="0 -960 960 960" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
 <defs>
  <pattern id="pattern2" x="0.40000001" patternTransform="scale(200)" preserveAspectRatio="xMidYMid" xlink:href="#Checkerboard"/>
  <pattern id="Checkerboard" width="2" height="2" fill="#b6b6b6" patternTransform="translate(0) scale(10)" patternUnits="userSpaceOnUse" preserveAspectRatio="xMidYMid">
   <rect width="1" height="1"/>
   <rect x="1" y="1" width="1" height="1"/>
  </pattern>
 </defs>
 <rect class="editor-icon-color-display" x="103.53" y="-856.47" width="752.94" height="752.94" rx="47.059" ry="47.059" fill="url(#pattern2)" stroke="#666" stroke-linecap="square" stroke-linejoin="round" stroke-width="47.059"/>
</svg>
`;var Ta=class extends te{constructor(e){super([]),this.input=e,this.pickerButton=new Ee({button:{icon:Yf,label:"Select color"}},[new on(this.onColorSelect.bind(this))]),this.addChildren(this.pickerButton,this.input)}buildDOM(){let e=this.input.getDOMElement();e.append(this.pickerButton.getDOMElement()),e.classList.add("editor-color-field-container");let t=e.querySelector("input");return t.addEventListener("change",()=>{this.setIconColor(t.value)}),e}onColorSelect(e,t){this.input.setValue(e)}setIconColor(e){let t=this.getDOMElement().querySelector("svg .editor-icon-color-display");t&&t.setAttribute("fill",e||"url(#pattern2)")}};function rn(o){return{build(){return new Ta(new It(o))}}}var Ca={label:"Border style",name:"border_style",type:"select",valuesByLabel:{"Select...":"",Solid:"solid",Dotted:"dotted",Dashed:"dashed",Double:"double",Groove:"groove",Ridge:"ridge",Inset:"inset",Outset:"outset",None:"none",Hidden:"hidden"}},_a={label:"Border color",name:"border_color",type:"text"},ba={label:"Background color",name:"background_color",type:"text"},Zf={label:"Alignment",name:"align",type:"select",valuesByLabel:{None:"",Left:"left",Center:"center",Right:"right"}};function Vf(o,e){let t=o.getStyles(),n=e.manager.createModal("cell_properties");return n.show({width:Ef(e.editor,o),height:t.get("height")||"",type:o.getTag(),h_align:o.getAlignment(),v_align:t.get("vertical-align")||"",border_width:t.get("border-width")||"",border_style:t.get("border-style")||"",border_color:t.get("border-color")||"",background_color:t.get("background-color")||""}),n}var Xf={submitText:"Save",async action(o,e){return e.editor.update(()=>{let t=en(T());for(let n of t){let r=o.get("width")?.toString()||"";xf(n,r),n.updateTag(o.get("type")?.toString()||""),n.setAlignment(o.get("h_align")?.toString()||"");let i=n.getStyles();i.set("height",ft(o.get("height")?.toString()||"")),i.set("vertical-align",o.get("v_align")?.toString()||""),i.set("border-width",ft(o.get("border_width")?.toString()||"")),i.set("border-style",o.get("border_style")?.toString()||""),i.set("border-color",o.get("border_color")?.toString()||""),i.set("background-color",o.get("background_color")?.toString()||""),n.setStyles(i)}}),!0},fields:[{build(){let o=[{label:"Width",name:"width",type:"text"},{label:"Height",name:"height",type:"text"},{label:"Cell type",name:"type",type:"select",valuesByLabel:{Cell:"td","Header cell":"th"}},{...Zf,label:"Horizontal align",name:"h_align"},{label:"Vertical align",name:"v_align",type:"select",valuesByLabel:{None:"",Top:"top",Middle:"middle",Bottom:"bottom"}}],e=[{label:"Border width",name:"border_width",type:"text"},Ca,rn(_a),rn(ba)];return new nn([{label:"General",contents:o},{label:"Advanced",contents:e}])}}]};function Gf(o,e){let t=o.getStyles(),n=e.manager.createModal("row_properties");return n.show({height:t.get("height")||"",border_style:t.get("border-style")||"",border_color:t.get("border-color")||"",background_color:t.get("background-color")||""}),n}var jf={submitText:"Save",async action(o,e){return e.editor.update(()=>{let t=to(T());for(let n of t){let r=n.getStyles();r.set("height",ft(o.get("height")?.toString()||"")),r.set("border-style",o.get("border_style")?.toString()||""),r.set("border-color",o.get("border_color")?.toString()||""),r.set("background-color",o.get("background_color")?.toString()||""),n.setStyles(r)}}),!0},fields:[{label:"Height",name:"height",type:"text"},Ca,rn(_a),rn(ba)]};function Jf(o,e){let t=o.getStyles(),n=e.manager.createModal("table_properties");return n.show({width:t.get("width")||"",height:t.get("height")||"",cell_spacing:t.get("cell-spacing")||"",cell_padding:bf(o),border_width:t.get("border-width")||"",border_style:t.get("border-style")||"",border_color:t.get("border-color")||"",background_color:t.get("background-color")||"",caption:ha(o)?"true":"",align:o.getAlignment()}),n}var Qf={submitText:"Save",async action(o,e){return e.editor.update(()=>{let t=xt(T());if(!t)return;let n=t.getStyles();n.set("width",ft(o.get("width")?.toString()||"")),n.set("height",ft(o.get("height")?.toString()||"")),n.set("cell-spacing",ft(o.get("cell_spacing")?.toString()||"")),n.set("border-width",ft(o.get("border_width")?.toString()||"")),n.set("border-style",o.get("border_style")?.toString()||""),n.set("border-color",o.get("border_color")?.toString()||""),n.set("background-color",o.get("background_color")?.toString()||""),t.setStyles(n),t.setAlignment(o.get("align"));let r=o.get("cell_padding")?.toString()||"";if(r){let l=ft(r);fa(t,a=>{let d=a.getStyles();d.set("padding",l),a.setStyles(d)})}let i=!!o.get("caption")?.toString(),s=ha(t);if(i&&!s)Df(t,e.translate("Caption"));else if(!i&&s)for(let l of t.getChildren())ga(l)&&l.remove()}),!0},fields:[{build(){let o=[{label:"Width",name:"width",type:"text"},{label:"Height",name:"height",type:"text"},{label:"Cell spacing",name:"cell_spacing",type:"text"},{label:"Cell padding",name:"cell_padding",type:"text"},{label:"Border width",name:"border_width",type:"text"},{label:"Show caption",name:"caption",type:"checkbox"},Zf],e=[Ca,rn(_a),rn(ba)];return new nn([{label:"General",contents:o},{label:"Advanced",contents:e}])}}]};function em(o){let e=E(o)?o.getChildren():[];return{node:o.exportJSON(),children:e.map(t=>em(t))}}function tm(o,{node:e,children:t}){let n=o._nodes.get(e.type)?.klass.importJSON(e);if(!n)return null;let r=t.map(i=>tm(o,i));for(let i of r)i&&E(n)&&n.append(i);return n}var Ur=class{constructor(){this.store=[]}set(...e){this.store.splice(0,this.store.length);for(let t of e)this.store.push(em(t))}get(e){return this.store.map(t=>tm(e,t)).filter(t=>t!==null)}size(){return this.store.length}};var zr=new Ur;function ya(){return zr.size()===0}function om(o){let e=null;for(let t of o){let n=t.getChildren().filter(i=>v(i)),r=0;for(let i of n)if(r+=i.getColSpan()||1,i.getRowSpan()>1)throw Error("Cannot copy rows with merged cells");if(e===null)e=r;else if(e!==r)throw Error("Cannot copy rows with inconsistent sizes")}}function nm(o,e){let t=new kt(e).columnCount;for(let n of o){let r=n.getChildren().filter(s=>v(s)),i=0;for(let s of r)i+=s.getColSpan()||1;if(i>t)throw Error("Cannot paste rows that are wider than target table");for(;i<t;)n.append($e()),i++}}function rm(){let o=to(T());om(o),zr.set(...o);for(let e of o)e.remove()}function im(){let o=to(T());om(o),zr.set(...o)}function sm(o){let e=T(),t=to(e),n=xt(e),r=t[t.length-1];if(r&&n){let i=zr.get(o);nm(i,n);for(let s of i)r.insertBefore(s)}}function lm(o){let e=T(),t=to(e),n=xt(e),r=t[t.length-1];if(r&&n){let i=zr.get(o).reverse();nm(i,n);for(let s of i)r.insertAfter(s)}}var ss=[];function am(o){let e=o.map(t=>{let n=new Ur;return n.set(...t),n});ss.splice(0,ss.length,...e)}function Sa(){return ss.length===0}function dm(o){if(z(o)){let i=o.getShape();return{from:i.fromX,to:i.toX}}let e=X(o,v),t=xt(o);if(!v(e)||!t)return null;let r=new kt(t).getRangeForCell(e);return r?{from:r.fromX,to:r.toX}:null}function cm(o,e){let t=new kt(e),n=[];for(let r=o.from;r<=o.to;r++){let i=t.getCellsInColumn(r);n.push(i)}return n}function um(o){let e=null;for(let t of o){let n=0;for(let r of t)if(n+=r.getRowSpan()||1,r.getColSpan()>1)throw Error("Cannot copy columns with merged cells");if(e===null)e=n;else if(e!==n)throw Error("Cannot copy columns with inconsistent sizes")}}function fm(){let o=T(),e=dm(o),t=xt(o);if(!e||!t)return;let n=t.getColWidths(),r=cm(e,t);um(r),am(r);for(let s of r)for(let l of s)l.remove();let i=[...n].splice(e.from,e.to-e.from+1);t.setColWidths(i)}function mm(){let o=T(),e=dm(o),t=xt(o);if(!e||!t)return;let n=cm(e,t);um(n),am(n)}function Zx(o,e){let t=new kt(e).rowCount;for(let n of o){let r=0;for(let i of n)r+=i.getRowSpan()||1;if(r>t)throw Error("Cannot paste columns that are taller than target table");for(;r<t;)n.push($e()),r++}}function pm(o,e){let t=T(),n=xt(t),r=en(t),i=r[e?0:r.length-1];if(!n||!i)return;let s=ss.map(u=>u.get(o));e||s.reverse(),Zx(s,n);let l=new kt(n),a=l.getRangeForCell(i);if(!a)return;let d=e?a.fromX:a.toX,m=n.getColWidths();for(let u=0;u<l.rowCount;u++){let p=l.getCellAtPosition(d,u);for(let g of s){let h=g[u];e?p.insertBefore(h):p.insertAfter(h)}}let f=m[d],c=s.map(u=>f);m.splice(e?d:d+1,0,...c)}function gm(o){pm(o,!0)}function hm(o){pm(o,!1)}var he=()=>!1,_e=o=>!ae(o,v),Nm={label:"Table",icon:xa},La={label:"Table properties",icon:xa,action(o){o.editor.getEditorState().read(()=>{let e=xt(T());K(e)&&Jf(e,o)})},isActive:he,isDisabled:_e},xm={label:"Clear table formatting",format:"long",action(o){o.editor.update(()=>{let e=X(T(),v);if(!v(e))return;let t=At(e,K);K(t)&&_f(t)})},isActive:he,isDisabled:_e},Em={label:"Resize to contents",format:"long",action(o){o.editor.update(()=>{let e=X(T(),v);if(!v(e))return;let t=At(e,K);K(t)&&Cf(t)})},isActive:he,isDisabled:_e},Ma={label:"Delete table",icon:rs,action(o){o.editor.update(()=>{let e=X(T(),K);e&&e.remove()})},isActive(){return!1}},Tm={...Ma,format:"long",isDisabled(o){return!ae(o,K)}},wa={label:"Insert row before",icon:Wf,action(o){o.editor.update(()=>{Hi(!1)})},isActive:he,isDisabled:_e},va={label:"Insert row after",icon:qf,action(o){o.editor.update(()=>{Hi(!0)})},isActive:he,isDisabled:_e},Da={label:"Delete row",icon:Kf,action(o){o.editor.update(()=>{Jl()})},isActive:he,isDisabled:_e},Cm={label:"Row properties",format:"long",action(o){o.editor.getEditorState().read(()=>{let e=to(T());Q(e[0])&&Gf(e[0],o)})},isActive:he,isDisabled:_e},_m={label:"Cut row",format:"long",action(o){o.editor.update(()=>{try{rm()}catch(e){o.error(e)}})},isActive:he,isDisabled:_e},bm={label:"Copy row",format:"long",action(o){o.editor.getEditorState().read(()=>{try{im()}catch(e){o.error(e)}})},isActive:he,isDisabled:_e},ym={label:"Paste row before",format:"long",action(o){o.editor.update(()=>{try{sm(o.editor)}catch(e){o.error(e)}})},isActive:he,isDisabled:o=>_e(o)||ya()},Sm={label:"Paste row after",format:"long",action(o){o.editor.update(()=>{try{lm(o.editor)}catch(e){o.error(e)}})},isActive:he,isDisabled:o=>_e(o)||ya()},Lm={label:"Cut column",format:"long",action(o){o.editor.update(()=>{try{fm()}catch(e){o.error(e)}})},isActive:he,isDisabled:_e},Mm={label:"Copy column",format:"long",action(o){o.editor.getEditorState().read(()=>{try{mm()}catch(e){o.error(e)}})},isActive:he,isDisabled:_e},wm={label:"Paste column before",format:"long",action(o){o.editor.update(()=>{try{gm(o.editor)}catch(e){o.error(e)}})},isActive:he,isDisabled:o=>_e(o)||Sa()},vm={label:"Paste column after",format:"long",action(o){o.editor.update(()=>{try{hm(o.editor)}catch(e){o.error(e)}})},isActive:he,isDisabled:o=>_e(o)||Sa()},Oa={label:"Insert column before",icon:zf,action(o){o.editor.update(()=>{Ki(!1)})},isActive(){return!1}},Aa={label:"Insert column after",icon:Uf,action(o){o.editor.update(()=>{Ki(!0)})},isActive(){return!1}},Ra={label:"Delete column",icon:Hf,action(o){o.editor.update(()=>{Ql()})},isActive(){return!1}},Dm={label:"Cell properties",format:"long",action(o){o.editor.getEditorState().read(()=>{let e=X(T(),v);v(e)&&Vf(e,o)})},isActive:he,isDisabled:_e},Om={label:"Merge cells",format:"long",action(o){o.editor.update(()=>{let e=T();z(e)&&Tf(e)})},isActive:he,isDisabled(o){return!z(o)}},Am={label:"Split cell",format:"long",action(o){o.editor.update(()=>{ta()})},isActive:he,isDisabled(o){let e=X(o,v);return e?!(e.getRowSpan()>1||e.getColSpan()>1):!0}};var Rm='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M280-200v-80h284q63 0 109.5-40T720-420q0-60-46.5-100T564-560H312l104 104-56 56-200-200 200-200 56 56-104 104h252q97 0 166.5 63T800-420q0 94-69.5 157T564-200H280Z"/></svg>';var km='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" ><path d="M396-200q-97 0-166.5-63T160-420q0-94 69.5-157T396-640h252L544-744l56-56 200 200-200 200-56-56 104-104H396q-63 0-109.5 40T240-420q0 60 46.5 100T396-280h284v80H396Z"/></svg>';var Im='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="m384-336 56-58-86-86 86-86-56-58-144 144 144 144Zm192 0 144-144-144-144-56 58 86 86-86 86 56 58ZM200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h168q13-36 43.5-58t68.5-22q38 0 68.5 22t43.5 58h168q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200Zm0-80h560v-560H200v560Zm280-590q13 0 21.5-8.5T510-820q0-13-8.5-21.5T480-850q-13 0-21.5 8.5T450-820q0 13 8.5 21.5T480-790ZM200-200v-560 560Z"/></svg>';var $m='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M120-120v-200h80v120h120v80H120Zm520 0v-80h120v-120h80v200H640ZM120-640v-200h200v80H200v120h-80Zm640 0v-120H640v-80h200v200h-80Z"/></svg>';var Pm='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M478-240q21 0 35.5-14.5T528-290q0-21-14.5-35.5T478-340q-21 0-35.5 14.5T428-290q0 21 14.5 35.5T478-240Zm-36-154h74q0-33 7.5-52t42.5-52q26-26 41-49.5t15-56.5q0-56-41-86t-97-30q-57 0-92.5 30T342-618l66 26q5-18 22.5-39t53.5-21q32 0 48 17.5t16 38.5q0 20-12 37.5T506-526q-44 39-54 59t-10 73Zm38 314q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z"/></svg>';function Gn(o,e){o.update(()=>{let t=F();for(let r of t.getChildren())r.remove(!0);let n=yo(o,e);t.append(...n)})}function Bm(o,e){o.update(()=>{let t=F(),n=yo(o,e);t.append(...n)})}function Fm(o,e){o.update(()=>{let t=F(),n=yo(o,e),r=t.getChildren()[0];for(let i=n.length-1;i>=0;i--)r?r.insertBefore(n[i]):t.append(n[i]),r=n[i]})}function Hm(o,e){o.update(()=>{let t=T(),n=yo(o,e),r=t?.getNodes()[0],i=r?.getParents()||[];if(i[i.length-1]&&r)for(let l=n.length-1;l>=0;l--)r.insertAfter(n[l])})}function ls(o){return new Promise((e,t)=>{o.getEditorState().read(()=>{let n=Ri(o);e(n)})})}function Km(o){o.focus(()=>{},{defaultSelection:"rootStart"})}var Um={label:"Undo",icon:Rm,action(o){o.editor.dispatchCommand(io,void 0),o.manager.triggerFutureStateRefresh()},isActive(o){return!1},setup(o,e){e.toggleDisabled(!0),o.editor.registerCommand(uo,t=>(e.toggleDisabled(!t),!1),mt)}},zm={label:"Redo",icon:km,action(o){o.editor.dispatchCommand(so,void 0),o.manager.triggerFutureStateRefresh()},isActive(o){return!1},setup(o,e){e.toggleDisabled(!0),o.editor.registerCommand(co,t=>(e.toggleDisabled(!t),!1),mt)}},Wm={label:"Source code",icon:Im,async action(o){let e=o.manager.createModal("source"),t=await ls(o.editor);e.show({source:t})},isActive(){return!1}},qm={label:"Fullscreen",icon:$m,async action(o,e){let t=o.containerDOM.classList.contains("fullscreen");o.containerDOM.classList.toggle("fullscreen",!t),o.containerDOM.closest("body").classList.toggle("editor-is-fullscreen",!t),e.setActiveState(!t)},isActive(o,e){return e.containerDOM.classList.contains("fullscreen")}},Ym={label:"About the editor",icon:Pm,async action(o,e){o.manager.createModal("about").show({})},isActive(o,e){return!1}};var Qx=(o,e)=>Zn(o)&&o.getTag()===e;function as(o,e){o.update(()=>{Kn(t=>Qx(t,e),()=>qn(e))})}function Wr(o){o.update(()=>{Kn(dt,I)})}function qr(o){o.update(()=>{Kn(ji,Gi)})}function Yr(o,e){o.getEditorState().read(()=>{let t=T();ae(t,r=>U(r)&&r.getListType()===e)?Xl(o):Vl(o,e)})}function Zr(o){o.getEditorState().read(()=>{let e=T(),t=le(o),n=X(t,Xi);n===null?o.update(()=>{let r=Vi();r.setCode(e?.getTextContent()||"");let i=Rt(e),s=i[0],l=i.slice(1);s?(s.replace(r),l.forEach(a=>a.remove())):Qo(r,!0),Hr(o,r),ot(r)}):Hr(o,n)})}function Zm(o){o.update(()=>{let e=T(),t=Rt(e),n=!1;for(let i of t)Ul(i)||(i.replace($n("info"),!0),n=!0);if(n)return;let r=["info","warning","danger","success"];for(let i of t)if(Ul(i)){let s=i.getCategory(),a=(r.indexOf(s)+1)%r.length,d=r[a];i.setCategory(d)}})}function ds(o,e){o.update(()=>{let t=T(),n=X(t,Ot);if(Ot(n)?(n.setURL(e.url),n.setTarget(e.target),n.setTitle(e.title)):(n=ht(e.url,{title:e.title,target:e.target}),Oe([n])),Ot(n)){for(let r of n.getChildren())r.remove(!0);n.append(q(e.text))}})}function cs(o,e){return{label:e,action(t){t.editor.update(()=>{Kn(n=>zl(n,o),()=>$n(o))})},isActive(t){return ae(t,n=>zl(n,o))}}}var Vm=cs("info","Info"),Xm=cs("danger","Danger"),Gm=cs("warning","Warning"),jm=cs("success","Success"),eE=(o,e)=>Zn(o)&&o.getTag()===e;function us(o,e){return{label:e,action(t){as(t.editor,o)},isActive(t){return ae(t,n=>eE(n,o))}}}var Jm=us("h2","Large Header"),Qm=us("h3","Medium Header"),ep=us("h4","Small Header"),tp=us("h5","Tiny Header"),op={label:"Blockquote",action(o){qr(o.editor)},isActive(o){return ae(o,ji)}},np={label:"Paragraph",action(o){Wr(o.editor)},isActive(o){return ae(o,dt)}};var rp='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M272-200v-560h221q65 0 120 40t55 111q0 51-23 78.5T602-491q25 11 55.5 41t30.5 90q0 89-65 124.5T501-200H272Zm121-112h104q48 0 58.5-24.5T566-372q0-11-10.5-35.5T494-432H393v120Zm0-228h93q33 0 48-17t15-38q0-24-17-39t-44-15h-95v109Z"/></svg>';var ip='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M200-200v-100h160l120-360H320v-100h400v100H580L460-300h140v100H200Z"/></svg>';var sp='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M200-120v-80h560v80H200Zm280-160q-101 0-157-63t-56-167v-330h103v336q0 56 28 91t82 35q54 0 82-35t28-91v-336h103v330q0 104-56 167t-157 63Z"/></svg>';var lp=`<svg version="1.1" viewBox="0 -960 960 960" xmlns="http://www.w3.org/2000/svg"><path class="editor-icon-color-bar" d="m80-3e-6v-160h800v160z"/><path d="m220-280 210-560h100l210 560h-96l-50-144h-226l-52 144zm176-224h168l-82-232h-4z"/></svg>
`;var ap='<svg version="1.1" viewBox="0 -960 960 960" xmlns="http://www.w3.org/2000/svg"><path class="editor-icon-color-bar" d="m80-2e-6v-160h800v160z"/><path d="m584-480-104-104-160 160 103 104zm-47-160 103 103 160-159-104-104zm-84-29 216 216-189 190c-16 16-34.833 24-56.5 24s-40.5-8-56.5-24l-27 23h-200l126-125c-16-16-24.333-35.167-25-57.5s7-41.5 23-57.5zm0 0 187-187c16-16 34.833-24 56.5-24s40.5 8 56.5 24l104 103c16 16 24 34.833 24 56.5s-8 40.5-24 56.5l-188 187z"/></svg>';var dp='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M80-400v-80h800v80H80Zm340-160v-120H200v-120h560v120H540v120H420Zm0 400v-160h120v160H420Z"/></svg>';var cp='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M760-600v-80q0-17 11.5-28.5T800-720h80v-40H760v-40h120q17 0 28.5 11.5T920-760v40q0 17-11.5 28.5T880-680h-80v40h120v40H760ZM235-160l185-291-172-269h106l124 200h4l123-200h107L539-451l186 291H618L482-377h-4L342-160H235Z"/></svg>';var up='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M760-160v-80q0-17 11.5-28.5T800-280h80v-40H760v-40h120q17 0 28.5 11.5T920-320v40q0 17-11.5 28.5T880-240h-80v40h120v40H760Zm-525-80 185-291-172-269h106l124 200h4l123-200h107L539-531l186 291H618L482-457h-4L342-240H235Z"/></svg>';var fp='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M320-240 80-480l240-240 57 57-184 184 183 183-56 56Zm320 0-57-57 184-184-183-183 56-56 240 240-240 240Z"/></svg>';var mp='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="m528-546-93-93-121-121h486v120H568l-40 94ZM792-56 460-388l-80 188H249l119-280L56-792l56-56 736 736-56 56Z"/></svg>';function sn(o,e,t){return{label:o,icon:t,action(n){n.editor.dispatchCommand(Ne,e)},isActive(n){return af(n,e)}}}var pp=sn("Bold","bold",rp),gp=sn("Italic","italic",ip),hp=sn("Underline","underline",sp),Np={label:"Text color",icon:lp},xp={label:"Background color",icon:ap};function Ep(o,e,t){o.editor.update(()=>{let n=T();n&&Pl(n,{[e]:t||null})})}var Tp=(o,e)=>Ep(e,"color",o),Cp=(o,e)=>Ep(e,"color",o),_p=sn("Strikethrough","strikethrough",dp),bp=sn("Superscript","superscript",cp),yp=sn("Subscript","subscript",up),Sp=sn("Inline code","code",fp),Lp={label:"Clear formatting",icon:mp,action(o){o.editor.update(()=>{let e=T();for(let t of e?.getNodes()||[])y(t)&&(t.setFormat(0),t.setStyle(""))})},isActive(){return!1}};var Mp='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M120-120v-80h720v80H120Zm0-160v-80h480v80H120Zm0-160v-80h720v80H120Zm0-160v-80h480v80H120Zm0-160v-80h720v80H120Z"/></svg>';var wp='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M120-120v-80h720v80H120Zm160-160v-80h400v80H280ZM120-440v-80h720v80H120Zm160-160v-80h400v80H280ZM120-760v-80h720v80H120Z"/></svg>';var vp='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M120-760v-80h720v80H120Zm240 160v-80h480v80H360ZM120-440v-80h720v80H120Zm240 160v-80h480v80H360ZM120-120v-80h720v80H120Z"/></svg>';var Dp='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M120-120v-80h720v80H120Zm0-160v-80h720v80H120Zm0-160v-80h720v80H120Zm0-160v-80h720v80H120Zm0-160v-80h720v80H120Z"/></svg>';var Op='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M440-800v400q0 17-11.5 28.5T400-360q-17 0-28.5-11.5T360-400v-160q-66 0-113-47t-47-113q0-66 47-113t113-47h280q17 0 28.5 11.5T680-840q0 17-11.5 28.5T640-800h-40v400q0 17-11.5 28.5T560-360q-17 0-28.5-11.5T520-400v-400h-80Zm-80 160v-160q-33 0-56.5 23.5T280-720q0 33 23.5 56.5T360-640Zm0-80Zm328 520H160q-17 0-28.5-11.5T120-240q0-17 11.5-28.5T160-280h528l-36-36q-11-11-11-28t11-28q11-11 28-11t28 11l104 104q12 12 12 28t-12 28L708-108q-11 11-28 11t-28-11q-11-11-11-28t11-28l36-36Z"/></svg>';var Ap='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M440-800v400q0 17-11.5 28.5T400-360q-17 0-28.5-11.5T360-400v-160q-66 0-113-47t-47-113q0-66 47-113t113-47h280q17 0 28.5 11.5T680-840q0 17-11.5 28.5T640-800h-40v400q0 17-11.5 28.5T560-360q-17 0-28.5-11.5T520-400v-400h-80ZM272-200l36 36q11 11 11 28t-11 28q-11 11-28 11t-28-11L148-212q-12-12-12-28t12-28l104-104q11-11 28-11t28 11q11 11 11 28t-11 28l-36 36h528q17 0 28.5 11.5T840-240q0 17-11.5 28.5T800-200H272Zm88-440v-160q-33 0-56.5 23.5T280-720q0 33 23.5 56.5T360-640Zm0-80Z"/></svg>';function fs(o,e){let t=le(o.editor),n=t?.getNodes()||[];if(n.length===1&&E(n[0])&&n[0].isInline()&&Br(n[0])){n[0].setAlignment(e),ot(n[0]),o.manager.triggerFutureStateRefresh();return}let i=Rt(t).filter(a=>Br(a)),l=i.every(a=>a.getAlignment()===e)?"":e;for(let a of i)a.setAlignment(l);o.manager.triggerFutureStateRefresh()}function Rp(o,e){let t=le(o.editor),n=Rt(t);for(let r of n)r.setDirection(e);o.manager.triggerFutureStateRefresh()}var kp={label:"Align left",icon:Mp,action(o){o.editor.update(()=>fs(o,"left"))},isActive(o){return Fr(o,"left")}},Ip={label:"Align center",icon:wp,action(o){o.editor.update(()=>fs(o,"center"))},isActive(o){return Fr(o,"center")}},$p={label:"Align right",icon:vp,action(o){o.editor.update(()=>fs(o,"right"))},isActive(o){return Fr(o,"right")}},Pp={label:"Justify",icon:Dp,action(o){o.editor.update(()=>fs(o,"justify"))},isActive(o){return Fr(o,"justify")}},Bp={label:"Left to right",icon:Op,action(o){o.editor.update(()=>Rp(o,"ltr"))},isActive(o){return da(o,"ltr")}},Fp={label:"Right to left",icon:Ap,action(o){o.editor.update(()=>Rp(o,"rtl"))},isActive(o){return da(o,"rtl")}};var Hp='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M360-200v-80h480v80H360Zm0-240v-80h480v80H360Zm0-240v-80h480v80H360ZM200-160q-33 0-56.5-23.5T120-240q0-33 23.5-56.5T200-320q33 0 56.5 23.5T280-240q0 33-23.5 56.5T200-160Zm0-240q-33 0-56.5-23.5T120-480q0-33 23.5-56.5T200-560q33 0 56.5 23.5T280-480q0 33-23.5 56.5T200-400Zm0-240q-33 0-56.5-23.5T120-720q0-33 23.5-56.5T200-800q33 0 56.5 23.5T280-720q0 33-23.5 56.5T200-640Z"/></svg>';var Kp='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M120-80v-60h100v-30h-60v-60h60v-30H120v-60h120q17 0 28.5 11.5T280-280v40q0 17-11.5 28.5T240-200q17 0 28.5 11.5T280-160v40q0 17-11.5 28.5T240-80H120Zm0-280v-110q0-17 11.5-28.5T160-510h60v-30H120v-60h120q17 0 28.5 11.5T280-560v70q0 17-11.5 28.5T240-450h-60v30h100v60H120Zm60-280v-180h-60v-60h120v240h-60Zm180 440v-80h480v80H360Zm0-240v-80h480v80H360Zm0-240v-80h480v80H360Z"/></svg>';var Up='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M222-200 80-342l56-56 85 85 170-170 56 57-225 226Zm0-320L80-662l56-56 85 85 170-170 56 57-225 226Zm298 240v-80h360v80H520Zm0-320v-80h360v80H520Z"/></svg>';var zp='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M120-120v-80h720v80H120Zm320-160v-80h400v80H440Zm0-160v-80h400v80H440Zm0-160v-80h400v80H440ZM120-760v-80h720v80H120Zm0 440v-320l160 160-160 160Z"/></svg>';var Wp='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M120-120v-80h720v80H120Zm320-160v-80h400v80H440Zm0-160v-80h400v80H440Zm0-160v-80h400v80H440ZM120-760v-80h720v80H120Zm160 440L120-480l160-160v320Z"/></svg>';function _E(o){let e=o.getParent();if(!U(e))return o;let t=o.getChildren().filter(d=>U(d))[0]||null,n=t?.getChildren()||[],r=e.getChildren(),i=r.findIndex(d=>d.getKey()===o.getKey()),s=i===0,l=Ie(),a=Ce(e.getListType());if(a.append(l),l.append(...o.getChildren()),s?o.append(a):(r[i-1].append(a),o.remove()),t){for(let d of n)l.insertAfter(d);t.remove()}return l}function bE(o){let e=o.getParent(),t=e?.getParent(),n=t?.getParent();if(!U(e)||!U(n)||!V(t))return o;let r=o.getNextSiblings();if(t.insertAfter(o),e.getChildren().length===0&&e.remove(),r.length>0){let i=Ce(e.getListType());i.append(...r),o.append(i)}return e.getChildrenSize()===0&&e.remove(),t.getChildren().length===0&&t.remove(),o}function yE(o){let e=o?.getNodes()||[],[t,n]=o?.getStartEndPoints()||[null,null],r=new Set;if(o&&t){o.isBackward()&&n&&([n,t]=[t,n]);let s=t.getNode().getParents(),l=!1;for(let a of s)V(a)&&(l?r.add(a.getKey()):l=!0)}let i=[];e:for(let s of e){if(V(s)){r.has(s.getKey())||i.push(s);continue}let l=s.getParents();for(let a of l)if(V(a)){r.has(a.getKey())||i.push(a);continue e}i.push(null)}return i}function SE(o){let e={};for(let n of o){if(n===null)continue;let r=n.getKey();typeof e[r]>"u"&&(e[r]=n)}let t=Object.values(e);return of(t)}function Vr(o,e){let t=T(),n=t?.getStartEndPoints(),r=yE(t);if(r.length>0&&!r.includes(null)){let l=[],a=SE(r);if(e>0)for(let d of a)l.push(_E(d));else if(e<0){for(let d of[...a].reverse())l.push(bE(d));l.reverse()}if(l.length===1&&n){let d=l[0],m=d.getChildren()[0];m||(m=q(""),d.append(m)),m.select(n[0].offset,n[1].offset)}else uf(l);return}let s=Rt(t);for(let l of s)if(nf(l)){let a=l.getInset(),d=Math.min(Math.max(a+e,0),500);l.setInset(d)}ff(o)}function ka(o,e,t){return{label:o,icon:t,action(n){Yr(n.editor,e)},isActive(n){return ae(n,r=>U(r)&&r.getListType()===e)}}}var qp=ka("Bullet list","bullet",Hp),Yp=ka("Numbered list","number",Kp),Zp=ka("Task list","check",Up),Vp={label:"Increase indent",icon:zp,action(o){o.editor.update(()=>{Vr(o.editor,40)})},isActive(){return!1}},Xp={label:"Decrease indent",icon:Wp,action(o){o.editor.update(()=>{Vr(o.editor,-40)})},isActive(){return!1}};var Gp='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M680-160v-120H560v-80h120v-120h80v120h120v80H760v120h-80ZM440-280H280q-83 0-141.5-58.5T80-480q0-83 58.5-141.5T280-680h160v80H280q-50 0-85 35t-35 85q0 50 35 85t85 35h160v80ZM320-440v-80h320v80H320Zm560-40h-80q0-50-35-85t-85-35H520v-80h160q83 0 141.5 58.5T880-480Z"/></svg>';var jp='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="m770-302-60-62q40-11 65-42.5t25-73.5q0-50-35-85t-85-35H520v-80h160q83 0 141.5 58.5T880-480q0 57-29.5 105T770-302ZM634-440l-80-80h86v80h-6ZM792-56 56-792l56-56 736 736-56 56ZM440-280H280q-83 0-141.5-58.5T80-480q0-69 42-123t108-71l74 74h-24q-50 0-85 35t-35 85q0 50 35 85t85 35h160v80ZM320-440v-80h65l79 80H320Z"/></svg>';var Jp='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h360v80H200v560h560v-360h80v360q0 33-23.5 56.5T760-120H200Zm480-480v-80h-80v-80h80v-80h80v80h80v80h-80v80h-80ZM240-280h480L570-480 450-320l-90-120-120 160Zm-40-480v560-560Z"/></svg>';var Qp='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M160-440v-80h640v80H160Z"/></svg>';var eg='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="m384-336 56-57-87-87 87-87-56-57-144 144 144 144Zm192 0 144-144-144-144-56 57 87 87-87 87 56 57ZM200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h560q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200Zm0-80h560v-560H200v560Zm0-560v560-560Z"/></svg>';var tg='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04a.996.996 0 0 0 0-1.41l-2.34-2.34a.996.996 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"/><path fill="none" d="M0 0h24v24H0z"/></svg>';var og='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M480-60q-63 0-106.5-43.5T330-210q0-52 31-91.5t79-53.5v-85H200v-160H100v-280h280v280H280v80h400v-85q-48-14-79-53.5T570-750q0-63 43.5-106.5T720-900q63 0 106.5 43.5T870-750q0 52-31 91.5T760-605v165H520v85q48 14 79 53.5t31 91.5q0 63-43.5 106.5T480-60Zm240-620q29 0 49.5-20.5T790-750q0-29-20.5-49.5T720-820q-29 0-49.5 20.5T650-750q0 29 20.5 49.5T720-680Zm-540 0h120v-120H180v120Zm300 540q29 0 49.5-20.5T550-210q0-29-20.5-49.5T480-280q-29 0-49.5 20.5T410-210q0 29 20.5 49.5T480-140ZM240-740Zm480-10ZM480-210Z"/></svg>';var ng='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h560q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200Zm0-80h560v-480H200v480Zm80-280v-80h400v80H280Zm0 160v-80h240v80H280Z"/></svg>';var rg=`<svg viewbox="0 0 24 24"><path d="M8.12 19.3c.39.39 1.02.39 1.41 0L12 16.83l2.47 2.47c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41l-3.17-3.17c-.39-.39-1.02-.39-1.41 0l-3.17 3.17c-.4.38-.4 1.02-.01 1.41zm7.76-14.6c-.39-.39-1.02-.39-1.41 0L12 7.17 9.53 4.7c-.39-.39-1.02-.39-1.41 0-.39.39-.39 1.03 0 1.42l3.17 3.17c.39.39 1.02.39 1.41 0l3.17-3.17c.4-.39.4-1.03.01-1.42z"/></svg>
`;var ig='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m21.41 11.41-8.83-8.83c-.37-.37-.88-.58-1.41-.58H4c-1.1 0-2 .9-2 2v7.17c0 .53.21 1.04.59 1.41l8.83 8.83c.78.78 2.05.78 2.83 0l7.17-7.17c.78-.78.78-2.04-.01-2.83M6.5 8C5.67 8 5 7.33 5 6.5S5.67 5 6.5 5 8 5.67 8 6.5 7.33 8 6.5 8"/></svg>';var sg='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="m380-300 280-180-280-180v360ZM200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h560q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200Zm0-80h560v-560H200v560Zm0-560v560-560Z"/></svg>';var jn=class extends Error{constructor(e,t){super(e.statusText),this.data=t,this.headers=e.headers,this.redirected=e.redirected,this.status=e.status,this.statusText=e.statusText,this.url=e.url,this.original=e}};function ms(o){return new Promise((e,t)=>{o.oncomplete=o.onsuccess=()=>e(o.result),o.onabort=o.onerror=()=>t(o.error)})}function PE(o,e){let t=indexedDB.open(o);t.onupgradeneeded=()=>t.result.createObjectStore(e);let n=ms(t);return(r,i)=>n.then(s=>i(s.transaction(e,r).objectStore(e)))}var Ia;function $a(){return Ia||(Ia=PE("keyval-store","keyval")),Ia}function Pa(o,e=$a()){return e("readonly",t=>ms(t.get(o)))}function Ba(o,e,t=$a()){return t("readwrite",n=>(n.put(e,o),ms(n.transaction)))}function Fa(o,e=$a()){return e("readwrite",t=>(t.delete(o),ms(t.transaction)))}var Tt=null,Ua,ps,Ha,Ka="last-drawing-save";function za(o){Tt?.contentWindow?.postMessage(JSON.stringify(o),Ua)}function FE(o){Ba(Ka,o.data),Ha&&Ha(o.data).then(()=>{Fa(Ka)})}function HE(o){za({action:"export",format:"xmlpng",xml:o.xml,spin:"Updating drawing"})}function KE(){ps&&ps().then(o=>{za({action:"load",autosave:1,xml:o})})}function UE(){let o={};Tt&&(window.$events.emitPublic(Tt,"editor-drawio::configure",{config:o}),za({action:"configure",config:o}))}function lg(){window.removeEventListener("message",ag),Tt&&document.body.removeChild(Tt)}function ag(o){if(!o.data||o.data.length<1||o.origin!==Ua)return;let e=JSON.parse(o.data);e.event==="init"?KE():e.event==="exit"?lg():e.event==="save"?HE(e):e.event==="export"?FE(e):e.event==="configure"&&UE()}async function zE(){let o=await Pa(Ka),e=document.getElementById("unsaved-drawing-dialog");e||console.error("Missing expected unsaved-drawing dialog"),o&&e&&await window.$components.firstOnElement(e,"confirm-dialog").show()&&(ps=async()=>o)}async function dg(o,e,t){ps=e,Ha=t,await zE(),Tt=document.createElement("iframe"),Tt.setAttribute("frameborder","0"),window.addEventListener("message",ag),Tt.setAttribute("src",o),Tt.setAttribute("class","fullscreen"),Tt.style.backgroundColor="#FFFFFF",document.body.appendChild(Tt),Ua=new URL(o).origin}async function cg(o,e){let t={image:o,uploaded_to:e};return(await window.$http.post(window.baseUrl("/images/drawio"),t)).data}function Wa(){lg()}async function ug(o){try{return`data:image/png;base64,${(await window.$http.get(window.baseUrl(`/images/drawio/base64/${o}`))).data.content}`}catch(e){throw e instanceof jn&&window.$events.showResponseError(e),Wa(),e}}function Xr(o){return o instanceof So}function qE(o,e){o.status===413?window.$events.emit("error",e.options.translations.serverUploadLimitText||""):window.$events.emit("error",e.options.translations.imageUploadErrorText||""),console.error(o)}async function YE(o,e){return await new Promise((n,r)=>{o.getEditorState().read(()=>{let{id:i}=e.getDrawingIdAndUrl();n(i)})})||""}async function ZE(o,e,t,n){if(Wa(),n){let r=window.baseUrl("/loading.gif");o.editor.update(()=>{e.setDrawingIdAndUrl("",r)})}try{let r=await cg(t,o.options.pageId);o.editor.update(()=>{e.setDrawingIdAndUrl(String(r.id),r.url)})}catch(r){throw r instanceof jn&&qE(r,o),n&&o.editor.update(()=>{e.remove()}),new Error(`Failed to save image with error: ${r}`)}}function Gr(o,e){let t=!1;dg(o.options.drawioUrl,async()=>{let n=await YE(o.editor,e);return t=!n,t?"":ug(n)},async n=>ZE(o,e,n,t))}function VE(o){window.$components.first("image-manager").show(t=>{o(t)},"drawio")}function fg(o){let e=le(o.editor);VE(t=>{o.editor.update(()=>{let n=zn(t.id,t.url),r=X(e,Xr);Xr(r)?r.replace(n):Oe([n])})})}function gs(o){window.$components.first("image-manager").show(t=>{o(t)},"gallery")}function mg(o){let e=o.thumbs?.display||o.url,t=ht(e,{target:"_blank"}),n=Bn(e,{alt:o.name});return t.append(n),t}async function pg(o,e){if(o===null||o.type.indexOf("image")!==0)throw new Error("Not an image file");let t=o.name||`image-${Date.now()}.png`,n=new FormData;return n.append("file",o,t),n.append("uploaded_to",e),(await window.$http.post("/images/gallery",n)).data}var jr=class extends te{constructor(e,t){super([e,t]),this.input=e,this.action=t}buildDOM(){return b("div",{class:"editor-action-input-container"},[this.input.getDOMElement(),this.action.getDOMElement()])}};var gg='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h200v80H200v560h560v-214l80 80v134q0 33-23.5 56.5T760-120H200Zm40-160 120-160 90 120 120-160 150 200H240Zm622-144L738-548q-21 14-45 21t-51 7q-74 0-126-52.5T464-700q0-75 52.5-127.5T644-880q75 0 127.5 52.5T824-700q0 27-8 52t-20 46l122 122-56 56ZM644-600q42 0 71-29t29-71q0-42-29-71t-71-29q-42 0-71 29t-29 71q0 42 29 71t71 29Z"/></svg>';var hg='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27A6.47 6.47 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"/><path fill="none" d="M0 0h24v24H0z"/></svg>';function hs(o,e){window.$components.first("entity-selector-popup").show(n=>o(n),{initialValue:e,searchEndpoint:"/search/entity-selector",entityTypes:"page,book,chapter,bookshelf",entityPermission:"view"})}var Ns=class extends te{constructor(t){super([t]);this.headerMap=new Map;this.input=t}buildDOM(){let t="editor-form-datalist-"+this.input.getName()+"-"+Date.now(),n=this.input.getDOMElement(),r=n.querySelector("input");r?.setAttribute("list",t),r?.setAttribute("autocomplete","off");let i=b("datalist",{id:t}),s=b("div",{class:"editor-link-field-container"},[n,i]);return r?.addEventListener("focusin",()=>{this.updateDataList(i)}),r?.addEventListener("input",()=>{let l=r.value,a=this.headerMap.get(l);a&&this.updateFormFromHeader(a)}),s}updateFormFromHeader(t){this.getHeaderIdAndText(t).then(({id:n,text:r})=>{let i=this.getContext().manager.getActiveModal("link");i&&i.getForm().setValues({url:`#${n}`,text:r,title:r})})}getHeaderIdAndText(t){return new Promise(n=>{this.getContext().editor.update(()=>{let r=t.getId();r||(r="header-"+os(),t.setId(r));let i=t.getTextContent();n({id:r,text:i})})})}updateDataList(t){this.getContext().editor.getEditorState().read(()=>{let n=la(Zn);this.headerMap.clear();let r=[];for(let i of n){let s="header-"+i.getKey();this.headerMap.set(s,i),r.push(b("option",{value:s,label:i.getTextContent().substring(0,54)}))}t.innerHTML="",t.append(...r)})}};function Ng(o,e){let t=e.manager.createModal("image"),n=o.getHeight(),r=o.getWidth(),i={src:o.getSrc(),alt:o.getAltText(),height:n===0?"":String(n),width:r===0?"":String(r)};t.show(i)}var xg={submitText:"Apply",async action(o,e){return e.editor.update(()=>{let t=le(e.editor),n=X(t,Nt);Nt(n)&&(n.setSrc(o.get("src")?.toString()||""),n.setAltText(o.get("alt")?.toString()||""),n.setWidth(Number(o.get("width")?.toString()||"0")),n.setHeight(Number(o.get("height")?.toString()||"0")))}),!0},fields:[{build(){return new jr(new It({label:"Source",name:"src",type:"text"}),new w({label:"Browse files",icon:gg,action(o){gs(e=>{let t=o.manager.getActiveModal("image");t&&t.getForm().setValues({src:e.thumbs?.display||e.url,alt:e.name})})}}))}},{label:"Alternative description",name:"alt",type:"text"},{label:"Width",name:"width",type:"text"},{label:"Height",name:"height",type:"text"}]};function xs(o,e){let t=e.manager.createModal("link");if(o){let n={url:o.getURL(),text:o.getTextContent(),title:o.getTitle()||"",target:o.getTarget()||""};e.editor.update(()=>{let r=Ho();r.add(o.getKey()),Y(r)}),t.show(n)}else e.editor.getEditorState().read(()=>{let i={text:T()?.getTextContent()||""};t.show(i)})}var Eg={submitText:"Apply",async action(o,e){return ds(e.editor,{url:o.get("url")?.toString()||"",title:o.get("title")?.toString()||"",target:o.get("target")?.toString()||"",text:o.get("text")?.toString()||""}),!0},fields:[{build(){return new jr(new Ns(new It({label:"URL",name:"url",type:"text"})),new w({label:"Browse links",icon:hg,action(o){hs(e=>{let t=o.manager.getActiveModal("link");t&&t.getForm().setValues({url:e.link,text:e.name,title:e.name})})}}))}},{label:"Text to display",name:"text",type:"text"},{label:"Title",name:"title",type:"text"},{label:"Open link in...",name:"target",type:"select",valuesByLabel:{"Current window":"","New window":"_blank"}}]};function Tg(o,e){let t=e.manager.createModal("media"),n={};if(o){let r=o.getAttributes();n={src:r.src||r.data||"",width:r.width,height:r.height,embed:""}}t.show(n)}var Cg={submitText:"Save",async action(o,e){let t=await new Promise((r,i)=>{e.editor.getEditorState().read(()=>{let s=X(T(),oo);r(s)})}),n=(o.get("embed")||"").toString().trim();return n?(e.editor.update(()=>{let r=wf(n);t&&r?t.replace(r):r&&Oe([r])}),!0):(e.editor.update(()=>{let r=(o.get("src")||"").toString().trim(),i=(o.get("height")||"").toString().trim(),s=(o.get("width")||"").toString().trim();if(t){t.setSrc(r),t.setWidthAndHeight(s,i);return}let l=vf(r);(s||i)&&l.setWidthAndHeight(s,i),Oe([l])}),!0)},fields:[{build(){return new nn([{label:"General",contents:[{label:"Source",name:"src",type:"text"},{label:"Width",name:"width",type:"text"},{label:"Height",name:"height",type:"text"}]},{label:"Embed",contents:[{label:"Paste your embed code below:",name:"embed",type:"textarea"}]}])}}]};function _g(o,e){let t=e.manager.createModal("details");o&&t.show({summary:o.getSummary()})}var bg={submitText:"Save",async action(o,e){return e.editor.update(()=>{let t=X(T(),ke),n=(o.get("summary")||"").toString().trim();ke(t)&&t.setSummary(n)}),!0},fields:[{label:"Toggle label",name:"summary",type:"text"}]};var qa={label:"Insert/edit link",icon:Gp,action(o){o.editor.getEditorState().read(()=>{let e=X(T(),Ot);xs(e,o)})},isActive(o){return ae(o,Ot)}},yg={label:"Remove link",icon:jp,action(o){o.editor.update(()=>{let e=le(o.editor),t=X(e,Ot);if(t){let n=t.getChildren().reverse();for(let r of n)t.insertAfter(r);t.remove(),n[n.length-1].selectStart(),o.manager.triggerFutureStateRefresh()}})},isActive(o){return!1}},Ya={label:"Insert/Edit Image",icon:Jp,action(o){o.editor.getEditorState().read(()=>{let e=le(o.editor),t=X(e,Nt);if(t){Ng(t,o);return}gs(n=>{o.editor.update(()=>{let r=mg(n);Oe([r])})})})},isActive(o){return ae(o,Nt)}},Sg={label:"Insert horizontal line",icon:Qp,action(o){o.editor.update(()=>{Qo(ma(),!1)})},isActive(o){return ae(o,yf)}},Za={label:"Insert code block",icon:eg,action(o){Zr(o.editor)},isActive(o){return ae(o,Xi)}},Lg=Object.assign({},Za,{label:"Edit code block",icon:tg}),Mg={label:"Insert/edit drawing",icon:og,action(o){o.editor.getEditorState().read(()=>{let e=le(o.editor),t=X(e,Xr);t===null?o.editor.update(()=>{let n=zn();Qo(n,!0),Gr(o,n),n.selectStart()}):Gr(o,t)})},isActive(o){return ae(o,Xr)}},wg={label:"Drawing manager",action(o){fg(o)},isActive(){return!1}},vg={label:"Insert/edit media",icon:sg,action(o){o.editor.getEditorState().read(()=>{let e=T(),t=X(e,oo);Tg(t,o)})},isActive(o){return ae(o,oo)}},Dg={label:"Insert collapsible block",icon:ng,action(o){o.editor.update(()=>{let e=T(),t=Wl(),r=(e?.getNodes()||[]).map(s=>s.getTopLevelElement()).filter(s=>s!==null),i=[...new Set(r)];i.length>0?i[0].insertAfter(t):F().append(t);for(let s of i)t.append(s)})},isActive(o){return ae(o,ke)}},Og={label:"Edit label",icon:ig,action(o){o.editor.getEditorState().read(()=>{let e=X(T(),ke);ke(e)&&_g(e,o)})},isActive(o){return!1}},Ag={label:"Toggle open/closed",icon:rg,action(o){o.editor.update(()=>{let e=X(T(),ke);ke(e)&&(e.setOpen(!e.getOpen()),o.manager.triggerLayoutUpdate())})},isActive(o){return!1}},Rg={label:"Unwrap",icon:rs,action(o){o.editor.update(()=>{let e=X(T(),ke);if(ke(e)){let t=e.getChildren();for(let n of t)e.insertBefore(n);e.remove(),o.manager.triggerLayoutUpdate()}})},isActive(o){return!1}};var kg=`<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m2 6.9159 10 10.168 10-10.168z" stroke-width="2.0168"/></svg>
`;var Es=class extends te{constructor(e,t){super([e]),this.button=e,this.dropdownButton=new Ee({button:{label:"Menu",icon:kg},showOnHover:!1,direction:"vertical",showAside:!1},t),this.addChildren(this.dropdownButton)}buildDOM(){return b("div",{class:"editor-button-with-menu-container"},[this.button.getDOMElement(),this.dropdownButton.getDOMElement()])}};var ln=class extends Me{buildDOM(){return b("div",{class:"editor-separator"})}};function Ig(o){let e=o.manager.getDefaultDirection()==="rtl";return new Ji("editor-toolbar-main",[new nt(2,[new w(Um),new w(zm)]),new es([new qe(b("h2"),Jm),new qe(b("h3"),Qm),new qe(b("h4"),ep),new qe(b("h5"),tp),new qe(b("blockquote"),op),new qe(b("p"),np),new Ee({button:{label:"Callouts",format:"long"},showOnHover:!0,direction:"vertical"},[new qe(b("p",{class:"callout info"}),Vm),new qe(b("p",{class:"callout success"}),jm),new qe(b("p",{class:"callout warning"}),Gm),new qe(b("p",{class:"callout danger"}),Xm)])]),new nt(6,[new w(pp),new w(gp),new w(hp),new Ee({button:new Kr(Np,"color")},[new on(Tp)]),new Ee({button:new Kr(xp,"background-color")},[new on(Cp)]),new w(_p),new w(bp),new w(yp),new w(Sp),new w(Lp)]),new nt(6,[new w(kp),new w(Ip),new w($p),new w(Pp),e?new w(Bp):null,e?new w(Fp):null].filter(t=>t!==null)),new nt(3,[new w(qp),new w(Yp),new w(Zp),new w(Xp),new w(Vp)]),new nt(4,[new w(qa),new Ee({button:Nm,direction:"vertical",showAside:!1},[new Ee({button:{label:"Insert",format:"long"},showOnHover:!0,showAside:!0},[new ns]),new ln,new Ee({button:{label:"Cell",format:"long"},direction:"vertical",showOnHover:!0},[new w(Dm),new w(Om),new w(Am)]),new Ee({button:{label:"Row",format:"long"},direction:"vertical",showOnHover:!0},[new w({...wa,format:"long"}),new w({...va,format:"long"}),new w({...Da,format:"long"}),new w(Cm),new ln,new w(_m),new w(bm),new w(ym),new w(Sm)]),new Ee({button:{label:"Column",format:"long"},direction:"vertical",showOnHover:!0},[new w({...Oa,format:"long"}),new w({...Aa,format:"long"}),new w({...Ra,format:"long"}),new ln,new w(Lm),new w(Mm),new w(wm),new w(vm)]),new ln,new w({...La,format:"long"}),new w(xm),new w(Em),new w(Tm)]),new w(Ya),new w(Sg),new w(Za),new Es(new w(Mg),[new w(wg)]),new w(vg),new w(Dg)]),new nt(3,[new w(Wm),new w(Ym),new w(qm)])])}function $g(){return[new w(Ya)]}function Pg(){return[new w(qa),new w(yg)]}function Bg(){return[new w(Lg)]}function Fg(){return[new nt(2,[new w(La),new w(Ma)]),new nt(3,[new w(wa),new w(va),new w(Da)]),new nt(3,[new w(Oa),new w(Aa),new w(Ra)])]}function Hg(){return[new w(Og),new w(Ag),new w(Rg)]}var Kg='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>';var Ts=class extends te{constructor(e,t){super([new is(e.form)]),this.definition=e,this.key=t}show(e){let t=this.getDOMElement();document.body.append(t);let n=this.getForm();n.setValues(e),n.setOnCancel(this.hide.bind(this)),n.setOnSuccessfulSubmit(this.hide.bind(this)),this.getContext().manager.setModalActive(this.key,this)}hide(){this.getDOMElement().remove(),this.getContext().manager.setModalInactive(this.key)}getForm(){return this.children[0]}buildDOM(){let e=b("button",{class:"editor-modal-close",type:"button",title:this.trans("Close")});e.innerHTML=Kg,e.addEventListener("click",this.hide.bind(this));let t=b("div",{class:"editor-modal editor-form-modal"},[b("div",{class:"editor-modal-header"},[b("div",{class:"editor-modal-title"},[this.trans(this.definition.title)]),e]),b("div",{class:"editor-modal-body"},[this.getForm().getDOMElement()])]),n=b("div",{class:"editor-modal-wrapper"},[t]);return n.addEventListener("click",r=>{r.target&&!t.contains(r.target)&&this.hide()}),n}};var Cs=class extends te{constructor(e,t){super(t),this.target=e}buildDOM(){return b("div",{class:"editor-context-toolbar"},this.getChildren().map(e=>e.getDOMElement()))}updatePosition(){let e=this.getContext().scrollDOM.getBoundingClientRect(),t=this.target.getBoundingClientRect(),n=this.getDOMElement(),r=n.getBoundingClientRect(),i=t.bottom>e.top&&t.top<e.bottom;if(n.hidden=!i,!i)return;let s=t.bottom+6+r.height>e.bottom;n.classList.toggle("is-above",s);let a=t.left+t.width/2-r.width/2;s?n.style.top=t.top-6-r.height+"px":n.style.top=t.bottom+6+"px",n.style.left=a+"px"}insert(e){this.addChildren(...e),this.getDOMElement().append(...e.map(n=>n.getDOMElement()))}empty(){let e=this.getChildren();for(let t of e)t.getDOMElement().remove();this.removeChildren(...e)}destroy(){this.empty(),this.getDOMElement().remove()}};var _s=class{constructor(){this.modalDefinitionsByKey={};this.activeModalsByKey={};this.decoratorConstructorsByType={};this.decoratorInstancesByNodeKey={};this.context=null;this.toolbar=null;this.contextToolbarDefinitionsByKey={};this.activeContextToolbars=[];this.selectionChangeHandlers=new Set}setContext(e){this.context=e,this.setupEventListeners(e),this.setupEditor(e.editor)}getContext(){if(this.context===null)throw new Error("Context attempted to be used without being set");return this.context}triggerStateUpdateForElement(e){e.updateState({selection:null,editor:this.getContext().editor})}registerModal(e,t){this.modalDefinitionsByKey[e]=t}createModal(e){let t=this.modalDefinitionsByKey[e];if(!t)throw new Error(`Attempted to show modal of key [${e}] but no modal registered for that key`);let n=new Ts(t,e);return n.setContext(this.getContext()),n}setModalActive(e,t){this.activeModalsByKey[e]=t}setModalInactive(e){delete this.activeModalsByKey[e]}getActiveModal(e){return this.activeModalsByKey[e]}registerDecoratorType(e,t){this.decoratorConstructorsByType[e]=t}getDecorator(e,t){if(this.decoratorInstancesByNodeKey[t])return this.decoratorInstancesByNodeKey[t];let n=this.decoratorConstructorsByType[e];if(!n)throw new Error(`Attempted to use decorator of type [${e}] but not decorator registered for that type`);let r=new n(t);return this.decoratorInstancesByNodeKey[t]=r,r}getDecoratorByNodeKey(e){return this.decoratorInstancesByNodeKey[e]||null}setToolbar(e){this.toolbar&&this.toolbar.getDOMElement().remove(),this.toolbar=e,e.setContext(this.getContext()),this.getContext().containerDOM.prepend(e.getDOMElement())}registerContextToolbar(e,t){this.contextToolbarDefinitionsByKey[e]=t}triggerStateUpdate(e){sf(e.editor,e.selection),this.toolbar?.updateState(e),this.updateContextToolbars(e);for(let t of this.activeContextToolbars)t.updateState(e);this.triggerSelectionChange(e.selection)}triggerStateRefresh(){let e=this.getContext().editor,t={editor:e,selection:le(e)};this.triggerStateUpdate(t),this.updateContextToolbars(t)}triggerFutureStateRefresh(){requestAnimationFrame(()=>{this.getContext().editor.getEditorState().read(()=>{this.triggerStateRefresh()})})}triggerSelectionChange(e){if(e)for(let t of this.selectionChangeHandlers)t(e)}onSelectionChange(e){this.selectionChangeHandlers.add(e)}offSelectionChange(e){this.selectionChangeHandlers.delete(e)}triggerLayoutUpdate(){window.requestAnimationFrame(()=>{for(let e of this.activeContextToolbars)e.updatePosition()})}getDefaultDirection(){return this.getContext().options.textDirection==="rtl"?"rtl":"ltr"}updateContextToolbars(e){for(let s=this.activeContextToolbars.length-1;s>=0;s--)this.activeContextToolbars[s].destroy(),this.activeContextToolbars.splice(s,1);let t=(e.selection?.getNodes()||[])[0]||null;if(!t)return;let n=e.editor.getElementByKey(t.getKey());if(!n)return;let r=Object.keys(this.contextToolbarDefinitionsByKey),i=new Map;for(let s of r){let l=this.contextToolbarDefinitionsByKey[s],a=n.closest(l.selector)||n.querySelector(l.selector);if(a){let d=l.displayTargetLocator?l.displayTargetLocator(a):a;i.has(d)||i.set(d,[]),i.get(d).push(...l.content)}}for(let[s,l]of i){let a=new Cs(s,l);a.setContext(this.getContext()),this.activeContextToolbars.push(a),this.getContext().containerDOM.append(a.getDOMElement()),a.updatePosition()}}setupEditor(e){let t=n=>{e.getEditorState().read(()=>{let r=Object.keys(n);for(let i of r){let s=e.getElementByKey(i);if(!s)continue;let l=n[i],a=this.getDecorator(l.type,i);a.setNode(l.getNode());let d=a.render(this.getContext(),s);d&&s.append(d)}})};e.registerDecoratorListener(t),e.registerUpdateListener(({editorState:n,prevEditorState:r})=>{!r._selection?.is(n._selection)&&e.update(()=>{let s=T();this.triggerStateUpdate({editor:e,selection:s})})})}setupEventListeners(e){let t=this.triggerLayoutUpdate.bind(this);window.addEventListener("scroll",t,{capture:!0,passive:!0}),window.addEventListener("resize",t,{passive:!0})}};var Jn=class{constructor(e){this.node=null;this.onDestroyCallbacks=[];this.context=e}getNode(){if(!this.node)throw new Error("Attempted to get use node without it being set");return this.node}setNode(e){this.node=e}onDestroy(e){this.onDestroyCallbacks.push(e)}destroy(e){for(let t of this.onDestroyCallbacks)t()}};var bs=class extends Jn{constructor(){super(...arguments);this.completedSetup=!1;this.latestCode="";this.latestLanguage="";this.editor=null}setup(t,n){let r=this.getNode(),i=n.querySelector("pre");if(!i)return;i&&(i.hidden=!0),this.latestCode=r.__code,this.latestLanguage=r.__language;let l=this.latestCode.split(`
`).length*19.2+18+24;n.style.height=`${l}px`;let a=Date.now();n.addEventListener("click",f=>{requestAnimationFrame(()=>{t.editor.update(()=>{ot(this.getNode())})})}),n.addEventListener("dblclick",f=>{t.editor.getEditorState().read(()=>{Hr(t.editor,this.getNode())})});let d=f=>{n.classList.toggle("selected",Zi(f,r))};t.manager.onSelectionChange(d),this.onDestroy(()=>{t.manager.offSelectionChange(d)});let m=f=>{this.editor=f.wysiwygView(n,document,this.latestCode,this.latestLanguage),setTimeout(()=>{n.style.height=""},12)};window.importVersioned("code").then(f=>{let c=Date.now()-a<20?20:0;setTimeout(()=>m(f),c)}),this.completedSetup=!0}update(){let t=this.getNode(),n=t.getCode(),r=t.getLanguage();this.latestCode===n&&this.latestLanguage===r||(this.latestLanguage=r,this.latestCode=n,this.editor&&(this.editor.setContent(n),this.editor.setMode(r,n)))}render(t,n){this.completedSetup?this.update():this.setup(t,n)}};var ys=class extends Jn{constructor(){super(...arguments);this.completedSetup=!1}setup(t,n){let r=this.getNode();n.classList.add("editor-diagram"),n.addEventListener("click",s=>{t.editor.update(()=>{ot(this.getNode())})}),n.addEventListener("dblclick",s=>{t.editor.getEditorState().read(()=>{Gr(t,this.getNode())})});let i=s=>{n.classList.toggle("selected",Zi(s,r))};t.manager.onSelectionChange(i),this.onDestroy(()=>{t.manager.offSelectionChange(i)}),this.completedSetup=!0}update(){}render(t,n){this.completedSetup?this.update():this.setup(t,n)}};var Ss=class extends Me{constructor(t){super();this.url="";this.url=t}buildDOM(){let t=b("div",{class:"editor-external-content"});return window.$http.get(this.url).then(n=>{typeof n.data=="string"&&(t.innerHTML=n.data)}),t}};var Ug={submitText:"Save",async action(o,e){return Gn(e.editor,o.get("source")?.toString()||""),!0},fields:[{label:"Source",name:"source",type:"textarea"}]},zg={submitText:"Close",async action(){return!0},fields:[{build(){return new Ss("/help/wysiwyg")}}]};var Va={link:{title:"Insert/Edit Link",form:Eg},image:{title:"Insert/Edit Image",form:xg},media:{title:"Insert/Edit Media",form:Cg},source:{title:"Source code",form:Ug},cell_properties:{title:"Cell Properties",form:Xf},row_properties:{title:"Row Properties",form:jf},table_properties:{title:"Table Properties",form:Qf},details:{title:"Edit collapsible block",form:bg},about:{title:"About the WYSIWYG Editor",form:zg}};function Wg(o,e,t,n,r){let i=new _s,s={editor:n,containerDOM:o,editorDOM:e,scrollDOM:t,manager:i,translate(l){return r.translations[l]||l},error(l){let a=l instanceof Error?l.message:l;window.$events.error(a)},options:r};i.setContext(s),i.setToolbar(Ig(s));for(let l of Object.keys(Va))i.registerModal(l,Va[l]);return i.registerContextToolbar("image",{selector:"img:not([drawio-diagram] img)",content:$g()}),i.registerContextToolbar("link",{selector:"a",content:Pg(),displayTargetLocator(l){return l.querySelector("img")||l}}),i.registerContextToolbar("code",{selector:".editor-code-block-wrap",content:Bg()}),i.registerContextToolbar("table",{selector:"td,th",content:Fg(),displayTargetLocator(l){return l.closest("table")}}),i.registerContextToolbar("details",{selector:"details",content:Hg()}),i.registerDecoratorType("code",bs),i.registerDecoratorType("diagram",ys),s}var Qn=class{constructor(e,t,n){this.startX=0;this.startY=0;this.target=null;this.container=e,this.dragTargetSelector=t,this.options=n,this.onMouseDown=this.onMouseDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.container.addEventListener("mousedown",this.onMouseDown)}teardown(){this.container.removeEventListener("mousedown",this.onMouseDown),this.container.removeEventListener("mouseup",this.onMouseUp),this.container.removeEventListener("mousemove",this.onMouseMove)}onMouseDown(e){this.target=e.target.closest(this.dragTargetSelector),this.target&&(this.startX=e.screenX,this.startY=e.screenY,window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("mouseup",this.onMouseUp),this.options.down&&this.options.down(e,this.target))}onMouseMove(e){this.options.move&&this.target&&this.options.move(e,this.target,{x:e.screenX-this.startX,y:e.screenY-this.startY})}onMouseUp(e){window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("mouseup",this.onMouseUp),this.options.up&&this.target&&this.options.up(e,this.target,{x:e.screenX-this.startX,y:e.screenY-this.startY})}};var Xa=class{constructor(e,t){this.markerDom=null;this.mouseTracker=null;this.dragging=!1;this.targetCell=null;this.xMarkerAtStart=!1;this.yMarkerAtStart=!1;this.editor=e,this.editScrollContainer=t,this.setupListeners()}teardown(){this.editScrollContainer.removeEventListener("mousemove",this.onCellMouseMove),window.removeEventListener("scroll",this.onScrollOrResize,{capture:!0}),window.removeEventListener("resize",this.onScrollOrResize),this.mouseTracker&&this.mouseTracker.teardown()}setupListeners(){this.onCellMouseMove=this.onCellMouseMove.bind(this),this.onScrollOrResize=this.onScrollOrResize.bind(this),this.editScrollContainer.addEventListener("mousemove",this.onCellMouseMove),window.addEventListener("scroll",this.onScrollOrResize,{capture:!0,passive:!0}),window.addEventListener("resize",this.onScrollOrResize,{passive:!0})}onScrollOrResize(){this.updateCurrentMarkerTargetPosition()}onCellMouseMove(e){let t=e.target.closest("td,th");if(!t||this.dragging)return;let n=t.getBoundingClientRect(),r=n.left+n.width/2,i=n.top+n.height/2;this.targetCell=t,this.xMarkerAtStart=e.clientX<=r,this.yMarkerAtStart=e.clientY<=i;let s=this.xMarkerAtStart?n.left:n.right,l=this.yMarkerAtStart?n.top:n.bottom;this.updateMarkersTo(t,s,l)}updateMarkersTo(e,t,n){let r=this.getMarkers(),s=e.closest("table").getBoundingClientRect(),l=this.editScrollContainer.getBoundingClientRect(),a=Math.max(s.top,l.top),m=Math.min(s.bottom,l.bottom)-a;r.x.style.left=t+"px",r.x.style.top=a+"px",r.x.style.height=m+"px",r.y.style.top=n+"px",r.y.style.left=s.left+"px",r.y.style.width=s.width+"px",r.y.hidden=n<l.top||n>l.bottom,r.x.hidden=s.top>l.bottom||s.bottom<l.top}updateCurrentMarkerTargetPosition(){if(!this.targetCell)return;let e=this.targetCell.getBoundingClientRect(),t=this.xMarkerAtStart?e.left:e.right,n=this.yMarkerAtStart?e.top:e.bottom;this.updateMarkersTo(this.targetCell,t,n)}getMarkers(){if(!this.markerDom){this.markerDom={x:b("div",{class:"editor-table-marker editor-table-marker-column"}),y:b("div",{class:"editor-table-marker editor-table-marker-row"})};let e=b("div",{class:"editor-table-marker-wrap"},[this.markerDom.x,this.markerDom.y]);this.editScrollContainer.after(e),this.watchMarkerMouseDrags(e)}return this.markerDom}watchMarkerMouseDrags(e){let t=this,n=0,r="left";this.mouseTracker=new Qn(e,".editor-table-marker",{down(i,s){s.classList.add("active"),t.dragging=!0,r=s.classList.contains("editor-table-marker-column")?"left":"top",n=Number(s.style[r].replace("px",""))},move(i,s,l){s.style[r]=n+l[r==="left"?"x":"y"]+"px"},up(i,s,l){s.classList.remove("active"),s.style.left="0",s.style.top="0",t.dragging=!1;let a=t.targetCell?.closest("table");if(r==="left"&&t.targetCell&&a){let d=t.getTargetCellColumnIndex(),m=l.x;t.xMarkerAtStart&&d>0?d-=1:t.xMarkerAtStart&&d===0&&(m=-m),t.editor.update(()=>{let f=ee(a);if(f instanceof Et){let c=hf(t.editor,f,d),u=Math.max(c+m,10);ua(f,d,u)}})}if(r==="top"&&t.targetCell){let d=t.targetCell;t.editor.update(()=>{let f=ee(d)?.getParent(),c=f?.getIndexWithinParent()||0,u=l.y;t.yMarkerAtStart&&c>0?c-=1:t.yMarkerAtStart&&c===0&&(u=-u);let p=f?.getParent()?.getChildren()[c];if(p instanceof eo){let g=p.getHeight()||0,h=Math.max(g+u,10);p.setHeight(h)}})}}})}getTargetCellColumnIndex(){let e=this.targetCell;if(e===null)return-1;let t=0,n=e.parentElement;for(let r of n?.children||[]){let i=Number(r.getAttribute("colspan"));if((Number.isNaN(i)||i<1)&&(i=1),t+=i,r===e)return t-1}return-1}};function qg(o,e){let t=new Xa(o,e);return()=>{t.teardown()}}function Ls(o){return o.html||""}function Yg(o){window.$events.listen("editor::replace",t=>{let n=Ls(t);Gn(o,n)}),window.$events.listen("editor::append",t=>{let n=Ls(t);Bm(o,n)}),window.$events.listen("editor::prepend",t=>{let n=Ls(t);Fm(o,n)}),window.$events.listen("editor::insert",t=>{let n=Ls(t);Hm(o,n)}),window.$events.listen("editor::focus",()=>{Km(o)});let e=!0;o.registerUpdateListener(({dirtyElements:t,dirtyLeaves:n,editorState:r,prevEditorState:i})=>{(t.size>0||n.size>0)&&(e?e=!1:window.$events.emit("editor-html-change",""))})}var Ms=class{constructor(e){this.data=e}hasItems(){return!!this.data&&!!this.data.types&&this.data.types.length>0}containsTabularData(){let e=this.data.getData("text/rtf");return!!e&&e.includes("\\trowd")}getImages(){return this.getFiles().filter(e=>e.type.includes("image"))}getFiles(){let{files:e}=this.data;return[...e]}};function QE(o,e){let t=o.clientX,n=o.clientY;return document.elementFromPoint(t,n)?tf(e,o.clientX,o.clientY):null}function Zg(o,e,t){let n=QE(e,t);n&&ot(n),aa(o,!0),(!B(n)||!n?.getTextContent())&&n?.remove()}async function eT(o,e,t){let i=((await window.$http.get(`/templates/${e}`)).data||{html:""}).html||"";o.update(()=>{let s=yo(o,i);Zg(s,t,o)})}function Vg(o,e){let t=new Ms(o),n=!1;if(!t.hasItems()||t.containsTabularData())return n;let r=t.getImages();return r.length>0&&(n=!0),e.editor.update(async()=>{for(let i of r){let s=window.baseUrl("/loading.gif"),l=Bn(s),a=I();a.append(l),Oe([a]);try{let d=await pg(i,e.options.pageId),m=d.name.replace(/"/g,"");e.editor.update(()=>{let f=Bn(d.thumbs?.display||"",{alt:m}),c=ht(d.url,{target:"_blank"});c.append(f),l.replace(c)})}catch(d){e.editor.update(()=>{l.remove(!1)}),window.$events.error(d?.data?.message||e.options.translations.imageUploadErrorText),console.error(d)}}}),n}function tT(o){let e=o.editor;return t=>{let n=t.dataTransfer?.getData("bookstack/template")||"";if(n)return eT(e,n,t),t.preventDefault(),t.stopPropagation(),!0;let r=t.dataTransfer?.getData("text/html")||"";return r?(e.update(()=>{let i=yo(e,r);Zg(i,t,e)}),t.preventDefault(),t.stopPropagation(),!0):t.dataTransfer&&Vg(t.dataTransfer,o)?(t.preventDefault(),t.stopPropagation(),!0):!1}}function oT(o){return e=>{if(!e.clipboardData)return!1;let t=Vg(e.clipboardData,o);return t&&e.preventDefault(),t}}function Xg(o){let e=tT(o),t=oT(o),n=o.editor.registerCommand(Oo,e,We),r=o.editor.registerCommand(ro,t,We);return o.scrollDOM.addEventListener("drop",e),()=>{n(),r(),o.scrollDOM.removeEventListener("drop",e)}}var Ga=class{constructor(e,t){this.editor=e,this.editorContainer=t,this.setupListeners()}setupListeners(){this.handleClick=this.handleClick.bind(this),this.editorContainer.addEventListener("click",this.handleClick)}handleClick(e){let t=e.target;t instanceof HTMLElement&&t.nodeName==="LI"&&t.classList.contains("task-list-item")&&(this.handleTaskListItemClick(t,e),e.preventDefault())}handleTaskListItemClick(e,t){let n=e.getBoundingClientRect();t.clientX<=n.right&&t.clientX>=n.left&&t.clientY>=n.top&&t.clientY<=n.bottom||this.editor.update(()=>{let i=ee(e);V(i)&&i.setChecked(!i.getChecked())})}teardown(){this.editorContainer.removeEventListener("click",this.handleClick)}};function Gg(o,e){let t=new Ga(o,e);return()=>{t.teardown()}}var ja=class{constructor(e){this.tableSelections=new Map;this.unregisterMutationListener=()=>{};this.editor=e,this.init()}init(){this.unregisterMutationListener=this.editor.registerMutationListener(Et,e=>{for(let[t,n]of e)if(n==="created")this.editor.getEditorState().read(()=>{let r=J(t);K(r)&&this.initializeTableNode(r)});else if(n==="destroyed"){let r=this.tableSelections.get(t);r!==void 0&&(r.removeListeners(),this.tableSelections.delete(t))}})}initializeTableNode(e){let t=e.getKey(),n=this.editor.getElementByKey(t);if(n&&!this.tableSelections.has(t)){let r=ia(e,n,this.editor,!1);this.tableSelections.set(t,r)}}teardown(){this.unregisterMutationListener();for(let[,e]of this.tableSelections)e.removeListeners()}};function jg(o){let e=new ja(o);return()=>{e.teardown()}}function ws(o,e){return as(o,e),!0}function no(o){return e=>(o(e),!0)}function Jg(o){return o.dispatchCommand(Ne,"code"),!0}var Qg={"meta+s":()=>(window.$events.emit("editor-save-draft"),!0),"meta+enter":()=>(window.$events.emit("editor-save-page"),!0),"meta+1":o=>ws(o,"h1"),"meta+2":o=>ws(o,"h2"),"meta+3":o=>ws(o,"h3"),"meta+4":o=>ws(o,"h4"),"meta+5":no(Wr),"meta+d":no(Wr),"meta+6":no(qr),"meta+q":no(qr),"meta+7":no(Zr),"meta+e":no(Zr),"meta+8":Jg,"meta+shift+e":Jg,"meta+9":no(Zm),"meta+o":no(o=>Yr(o,"number")),"meta+p":no(o=>Yr(o,"bullet")),"meta+k":(o,e)=>(o.getEditorState().read(()=>{let t=X(T(),Ot);xs(t,e)}),!0),"meta+shift+k":(o,e)=>(hs(t=>{ds(o,{text:t.name,title:t.link,target:"",url:t.link})}),!0)};function nT(o){return e=>{let t=rT(e);Qg[t]&&Qg[t](o.editor,o)&&(e.stopPropagation(),e.preventDefault())}}function rT(o){return[(eh()?o.metaKey:o.ctrlKey)?"meta":"",o.shiftKey?"shift":"",o.key].filter(Boolean).join("+").toLowerCase()}function eh(){return window.navigator.userAgent.includes("Mac OS X")}function iT(o){o.registerCommand(Be,e=>eh()?e?.metaKey||!1:e?.ctrlKey||!1,We)}function th(o){let e=nT(o);return iT(o.editor),o.editor.registerRootListener((t,n)=>{t?.addEventListener("keydown",e),n?.removeEventListener("keydown",e)})}function sT(o){return Nt(o)||oo(o)}var Ja=class{constructor(e){this.dom=null;this.mouseTracker=null;this.activeSelection="";this.context=e,this.scrollContainer=e.scrollDOM,this.onSelectionChange=this.onSelectionChange.bind(this),e.manager.onSelectionChange(this.onSelectionChange)}onSelectionChange(e){let t=e?.getNodes()||[];if(this.activeSelection&&this.hide(),t.length===1&&sT(t[0])){let n=t[0],r=n.getKey(),i=this.context.editor.getElementByKey(r);i&&i.nodeName==="SPAN"&&(i=i.firstElementChild),i&&this.showForNode(n,i)}}teardown(){this.context.manager.offSelectionChange(this.onSelectionChange),this.hide()}showForNode(e,t){this.dom=this.buildDOM();let n=b("span",{class:"editor-node-resizer-ghost"});Nt(e)&&(n=b("img",{src:t.getAttribute("src"),class:"editor-node-resizer-ghost"})),this.dom.append(n),this.context.scrollDOM.append(this.dom),this.updateDOMPosition(t),this.mouseTracker=this.setupTracker(this.dom,e,t),this.activeSelection=e.getKey()}updateDOMPosition(e){if(!this.dom)return;let t=this.scrollContainer.getBoundingClientRect(),n=e.getBoundingClientRect(),r=n.top-(t.top-this.scrollContainer.scrollTop),i=n.left-t.left;this.dom.style.top=`${r}px`,this.dom.style.left=`${i}px`,this.dom.style.width=n.width+"px",this.dom.style.height=n.height+"px"}updateDOMSize(e,t){this.dom&&(this.dom.style.width=e+"px",this.dom.style.height=t+"px")}hide(){this.mouseTracker?.teardown(),this.dom?.remove(),this.activeSelection=""}buildDOM(){let t=["nw","ne","se","sw"].map(n=>b("div",{class:`editor-node-resizer-handle ${n}`}));return b("div",{class:"editor-node-resizer"},t)}setupTracker(e,t,n){let r=0,i=0,s=0,l=!1,a=this,d=!1,m=!1,f=c=>{let u=c.x;d&&(u=0-u);let p=c.y;m&&(p=0-p);let g=Math.sqrt(Math.pow(Math.abs(u),2)+Math.pow(Math.abs(p),2)),C=u+p>0?g:0-g,N=Math.max(5,Math.round(r+C)),L=Math.round(N*s);return{width:N,height:L}};return new Qn(e,".editor-node-resizer-handle",{down(c,u){a.dom?.classList.add("active"),a.context.editor.getEditorState().read(()=>{let p=n.getBoundingClientRect();r=t.getWidth()||p.width,i=t.getHeight()||p.height,t.getHeight()&&(l=!0),s=i/r}),d=u.classList.contains("nw")||u.classList.contains("sw"),m=u.classList.contains("nw")||u.classList.contains("ne")},move(c,u,p){let g=f(p);a.updateDOMSize(g.width,g.height)},up(c,u,p){let g=f(p);a.context.editor.update(()=>{t.setWidth(g.width),t.setHeight(l?g.height:0),a.context.manager.triggerLayoutUpdate(),requestAnimationFrame(()=>{a.updateDOMPosition(n)})}),a.dom?.classList.remove("active")}})}};function oh(o){let e=new Ja(o);return()=>{e.teardown()}}function Qa(o){if(o.length===1){let e=o[0];if(B(e)||Nt(e)||oo(e))return!0}return!1}function nh(o){let e=le(o)?.getNodes()||[];Qa(e)&&o.update(()=>{e[0].remove()})}function lT(o,e){let t=le(o)?.getNodes()||[];if(Qa(t)){let n=t[0],r=Jo(n)||n;if(r)return requestAnimationFrame(()=>{o.update(()=>{let i=I();r.insertAfter(i),i.select()})}),e?.preventDefault(),!0}return!1}function rh(o,e,t=!0){let n=le(o)?.getNodes()||[];if(!Qa(n))return!1;e?.preventDefault();let r=n[0],i=Jo(r)||r,s=t?i.getNextSibling():i.getPreviousSibling();return o.update(()=>{s||(s=I(),t?i.insertAfter(s):i.insertBefore(s)),s.selectStart()}),!0}function aT(o,e){let t=ih(o);return t===null||t.detailsSibling?!1:(o.update(()=>{let n=I();t.parentDetails.insertAfter(n),n.select()}),e?.preventDefault(),!0)}function dT(o,e){let t=ih(o);if(t===null||t.parentBlock.getTextContent()!=="")return!1;e?.preventDefault();let n=t.parentDetails.getNextSibling();return o.update(()=>{if(n)n.selectStart();else{let r=I();t.parentDetails.insertAfter(r),r.select()}t.parentBlock.remove()}),!0}function ih(o){let t=le(o)?.getNodes()[0];if(!t)return null;let n=Jo(t),r=At(t,ke);if(!ke(r)||n===null||n.getKey()!==r.getLastChild()?.getKey())return null;let i=r.getNextSibling();return{parentDetails:r,parentBlock:n,detailsSibling:i}}function cT(o){if(o.length!==1)return!1;let e=o[0];return V(e)||V(e.getParent())}function uT(o,e){let t=e?.shiftKey?-40:40,r=T()?.getNodes()||[];return r.length>1||cT(r)?(o.update(()=>{Vr(o,t)}),e?.preventDefault(),!0):!1}function sh(o){let e=o.editor.registerCommand(Ht,()=>(nh(o.editor),!1),mt),t=o.editor.registerCommand(Kt,()=>(nh(o.editor),!1),mt),n=o.editor.registerCommand(Be,l=>lT(o.editor,l)||dT(o.editor,l),mt),r=o.editor.registerCommand(Do,l=>uT(o.editor,l),mt),i=o.editor.registerCommand(Bt,l=>rh(o.editor,l,!1),mt),s=o.editor.registerCommand(Ft,l=>aT(o.editor,l)||rh(o.editor,l,!0),mt);return()=>{e(),t(),n(),r(),i(),s()}}function fT(o){return o.toLowerCase().startsWith("http")?/(http|https):\/\/(\S+)\.\S+$/.test(o):!1}function mT(o,e,t){let n=e.getStartEndPoints();if(!n)return;let r=n[0].offset,i=o.getTextContent(),a=i.slice(0,r).lastIndexOf(" ")+1,d=i.slice(a,r);fT(d)&&t.update(()=>{let m=ht(d);m.append(new je(d));let f=o.splitText(a,r),c=a>0?1:0,u=f[c];u&&u.replace(m)})}function lh(o){let e=r=>{let i=T(),s=lf(i);return s&&i&&mT(s,i,o),!1},t=o.registerCommand(or,e,Li),n=o.registerCommand(Be,e,Li);return()=>{t(),n()}}function wP(o,e,t={}){let n={namespace:"BookStackPageEditor",nodes:Of(),onError:console.error,theme:{text:{bold:"editor-theme-bold",code:"editor-theme-code",italic:"editor-theme-italic",strikethrough:"editor-theme-strikethrough",subscript:"editor-theme-subscript",superscript:"editor-theme-superscript",underline:"editor-theme-underline",underlineStrikethrough:"editor-theme-underline-strikethrough"}}},r=b("div",{contenteditable:"true",class:"editor-content-area page-content"}),i=b("div",{class:"editor-content-wrap"},[r]);o.append(i),o.classList.add("editor-container"),o.setAttribute("dir",t.textDirection),t.darkMode&&o.classList.add("editor-dark");let s=kl(n);s.setRootElement(r);let l=Wg(o,r,i,s,t);jt(Pu(s),_u(s,bu(),300),th(l),sh(l),qg(s,i),jg(s),Gg(s,r),Xg(l),oh(l),lh(s)),Yg(s),Gn(s,e);let a=document.getElementById("lexical-debug");return a&&(a.hidden=!0,s.registerUpdateListener(({dirtyElements:d,dirtyLeaves:m,editorState:f,prevEditorState:c})=>{a.textContent=JSON.stringify(f.toJSON(),null,2)})),window.debugEditorState=()=>{console.log(s.getEditorState().toJSON())},Af(l),new ed(s)}var ed=class{constructor(e){this.editor=e}async getContentAsHtml(){return await ls(this.editor)}};export{ed as SimpleWysiwygEditorInterface,wP as createPageEditorInstance};
//# sourceMappingURL=wysiwyg.js.map
